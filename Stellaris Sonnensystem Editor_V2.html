<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stellaris Solar System Editor V10 - Modifier System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Exo+2:wght@300;400;500;600&display=swap');
        
        :root {
            --stellaris-blue: #00d4ff;
            --stellaris-gold: #ffd700;
            --stellaris-purple: #9966ff;
            --stellaris-dark: #0a0e1a;
            --stellaris-darker: #050811;
            --stellaris-panel: #1a2332;
            --stellaris-border: #2a3847;
            --stellaris-accent: #00a8cc;
            --stellaris-green: #48bb78;
        }

        body {
            font-family: 'Exo 2', 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--stellaris-darker) 0%, var(--stellaris-dark) 50%, #0f1419 100%);
            color: #e2e8f0;
            min-height: 100vh;
            background-attachment: fixed;
        }

        .stellaris-header {
            background: linear-gradient(90deg, var(--stellaris-blue) 0%, var(--stellaris-purple) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 2rem;
            text-shadow: 0 0 20px rgba(0, 212, 255, 0.3);
        }

        .stellaris-panel {
            background: linear-gradient(145deg, var(--stellaris-panel) 0%, rgba(26, 35, 50, 0.8) 100%);
            border: 1px solid var(--stellaris-border);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .stellaris-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--stellaris-blue), var(--stellaris-purple), var(--stellaris-gold));
        }

        .stellaris-input {
            background: linear-gradient(145deg, #2a3847 0%, #1e2936 100%);
            border: 1px solid var(--stellaris-border);
            color: #e2e8f0;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            width: 100%;
            font-family: 'Exo 2', sans-serif;
            transition: all 0.3s ease;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .stellaris-input:focus {
            outline: none;
            border-color: var(--stellaris-blue);
            box-shadow: 
                inset 0 2px 4px rgba(0, 0, 0, 0.2),
                0 0 0 3px rgba(0, 212, 255, 0.2);
        }

        .stellaris-input option {
            background-color: #2a3847;
            color: #e2e8f0;
            padding: 8px 12px;
        }

        .stellaris-input optgroup {
            background-color: #1e2936;
            color: #cbd5e0;
            font-weight: bold;
            font-style: normal;
        }

        .stellaris-btn {
            background: linear-gradient(145deg, var(--stellaris-blue) 0%, var(--stellaris-accent) 100%);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            font-family: 'Exo 2', sans-serif;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 15px rgba(0, 212, 255, 0.3);
        }

        .stellaris-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 212, 255, 0.4);
        }

        .stellaris-btn-secondary {
            background: linear-gradient(145deg, #4a5568 0%, #2d3748 100%);
            box-shadow: 0 4px 15px rgba(74, 85, 104, 0.3);
        }

        .stellaris-btn-danger {
            background: linear-gradient(145deg, #e53e3e 0%, #c53030 100%);
            box-shadow: 0 4px 15px rgba(229, 62, 62, 0.3);
        }

        .stellaris-btn-success {
            background: linear-gradient(145deg, var(--stellaris-green) 0%, #38a169 100%);
            box-shadow: 0 4px 15px rgba(72, 187, 120, 0.3);
        }

        /* CSS f√ºr das neue Nachbarsystem-Layout */
        .neighbor-grid-container {
            display: grid;
            /* Linke Spalte fix, rechte Spalte flexibel */
            grid-template-columns: 320px 1fr; 
            gap: 1.5rem;
            min-height: 400px; /* Stellt sicher, dass das Layout nicht zusammenf√§llt */
        }

        .neighbor-list-column {
            border-right: 1px solid var(--stellaris-border);
            padding-right: 1.5rem;
        }

        .neighbor-list-item {
            background: linear-gradient(145deg, rgba(74, 85, 104, 0.4) 0%, rgba(45, 55, 72, 0.6) 100%);
            border: 1px solid var(--stellaris-border);
            border-radius: 6px;
            padding: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
            border-left: 4px solid transparent; /* F√ºr den "selected" Indikator */
        }

        .neighbor-list-item:hover {
            border-color: var(--stellaris-accent);
        }

        .neighbor-list-item.selected {
            background: linear-gradient(145deg, rgba(0, 212, 255, 0.15) 0%, rgba(153, 102, 255, 0.15) 100%);
            border-left-color: var(--stellaris-blue);
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.2);
        }

        .celestial-item {
            background: linear-gradient(145deg, rgba(74, 85, 104, 0.6) 0%, rgba(45, 55, 72, 0.8) 100%);
            border: 1px solid var(--stellaris-border);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .celestial-item:hover {
            background: linear-gradient(145deg, rgba(0, 212, 255, 0.1) 0%, rgba(153, 102, 255, 0.1) 100%);
            border-color: var(--stellaris-blue);
            transform: translateX(4px);
        }

        .celestial-item.selected {
            background: linear-gradient(145deg, rgba(0, 212, 255, 0.2) 0%, rgba(153, 102, 255, 0.2) 100%);
            border-color: var(--stellaris-blue);
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.3);
        }

        .celestial-item.new-orbit {
            border-left: 4px solid var(--stellaris-gold);
        }

        .celestial-item.same-orbit {
            border-left: 4px solid rgba(255, 255, 255, 0.3);
        }

        .stellaris-visualizer {
            background: radial-gradient(circle at center, #0a0e1a 0%, #000 70%);
            border: 2px solid var(--stellaris-border);
            border-radius: 12px;
            height: 850px;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 0 50px rgba(0, 0, 0, 0.8);
        }

        .section-title {
            font-family: 'Orbitron', monospace;
            font-weight: 600;
            font-size: 1.5rem;
            color: var(--stellaris-blue);
            margin-bottom: 1rem;
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.3);
        }

        .label {
            font-weight: 500;
            color: #cbd5e0;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stellaris-export-area {
            background: linear-gradient(145deg, #1a1f2e 0%, #0f1419 100%);
            border: 1px solid var(--stellaris-border);
            border-radius: 8px;
            padding: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            line-height: 1.4;
            color: #e2e8f0;
            resize: none;
            min-height: 300px;
        }

        .modifier-panel {
            background: linear-gradient(145deg, rgba(72, 187, 120, 0.1) 0%, rgba(56, 161, 105, 0.1) 100%);
            border: 1px solid rgba(72, 187, 120, 0.3);
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 1rem;
        }

        .modifier-item {
            background: linear-gradient(145deg, rgba(72, 187, 120, 0.1) 0%, rgba(56, 161, 105, 0.1) 100%);
            border: 1px solid rgba(72, 187, 120, 0.3);
            border-radius: 6px;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .orbit-indicator {
            position: absolute;
            border: 1px dashed rgba(0, 212, 255, 0.3);
            border-radius: 50%;
            pointer-events: none;
        }

        .stellaris-star {
            background: radial-gradient(circle, #ffeb3b 0%, #ff9800 100%);
            box-shadow: 
                0 0 30px #ffeb3b,
                0 0 60px rgba(255, 235, 59, 0.5),
                0 0 90px rgba(255, 152, 0, 0.3);
            animation: starGlow 3s ease-in-out infinite alternate;
        }

        @keyframes starGlow {
            0% { box-shadow: 0 0 30px #ffeb3b, 0 0 60px rgba(255, 235, 59, 0.5); }
            100% { box-shadow: 0 0 40px #ffeb3b, 0 0 80px rgba(255, 235, 59, 0.7); }
        }

        .planet, .moon {
            border-radius: 50%;
            position: absolute;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.7rem;
            font-weight: 600;
            color: white;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.8);
            border: 2px solid rgba(255, 255, 255, 0.3);
            box-shadow: 
                0 2px 10px rgba(0, 0, 0, 0.5),
                inset 0 0 10px rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .planet:hover, .moon:hover {
            transform: scale(1.1);
            box-shadow: 
                0 4px 20px rgba(0, 212, 255, 0.5),
                inset 0 0 15px rgba(255, 255, 255, 0.2);
        }

        .asteroid-belt {
            position: absolute;
            border: 2px dotted rgba(139, 69, 19, 0.6);
            border-radius: 50%;
            pointer-events: none;
        }

        .orbit-number {
            position: absolute;
            color: rgba(0, 212, 255, 0.7);
            font-size: 0.8rem;
            font-weight: bold;
            background: rgba(0, 0, 0, 0.5);
            padding: 2px 6px;
            border-radius: 4px;
        }

        .orbit-distance-info {
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 4px;
            padding: 0.5rem;
            margin-top: 0.5rem;
            font-size: 0.8rem;
        }

        .grid { display: grid; gap: 1.5rem; }
        .grid-cols-1 { grid-template-columns: 1fr; }
        .grid-cols-2 { grid-template-columns: repeat(2, 1fr); }
        .grid-cols-3 { grid-template-columns: repeat(3, 1fr); }

        @media (min-width: 768px) {
            .md\:grid-cols-2 { grid-template-columns: repeat(2, 1fr); }
            .md\:grid-cols-3 { grid-template-columns: repeat(3, 1fr); }
        }

        @media (min-width: 1024px) {
            .lg\:grid-cols-3 { grid-template-columns: repeat(3, 1fr); }
            .lg\:col-span-2 { grid-column: span 2; }
        }

        .hidden { display: none; }
        .ml-6 { margin-left: 1.5rem; }
        .ml-2 { margin-left: 0.5rem; }
        .mt-4 { margin-top: 1rem; }
        .mt-6 { margin-top: 1.5rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-8 { margin-bottom: 2rem; }
        .py-8 { padding-top: 2rem; padding-bottom: 2rem; }
        .px-2 { padding-left: 0.5rem; padding-right: 0.5rem; }
        .py-1 { padding-top: 0.25rem; padding-bottom: 0.25rem; }
        .text-sm { font-size: 0.875rem; }
        .max-h-96 { max-height: 24rem; }
        .overflow-y-auto { overflow-y: auto; }
        .cursor-not-allowed { cursor: not-allowed; }
        .container { max-width: 1400px; margin: 0 auto; padding: 2rem; }
        .variation-card {
            transition: all 0.3s ease;
            position: relative;
        }
        
        .variation-card.enabled .stellaris-panel {
            background: linear-gradient(145deg, rgba(72, 187, 120, 0.15), rgba(56, 161, 105, 0.15));
            border: 2px solid rgba(72, 187, 120, 0.5);
            box-shadow: 0 0 15px rgba(72, 187, 120, 0.3);
        }
        
        .variation-card:not(.enabled) .stellaris-panel {
            opacity: 0.6;
        }
        
        .variation-card code {
            background: rgba(0, 0, 0, 0.4);
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            color: #ffd700;
        }
        
        .flag-item {
            background: linear-gradient(145deg, rgba(0, 212, 255, 0.1), rgba(153, 102, 255, 0.1));
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 6px;
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
        }
        
        .flag-item:hover {
            border-color: var(--stellaris-blue);
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.3);
        }
        
        .variation-changes {
            background: rgba(0, 0, 0, 0.2);
            border-left: 3px solid var(--stellaris-blue);
            padding: 0.5rem;
            margin-top: 0.5rem;
            font-size: 0.8rem;
        }
    </style>
</head>
<body>
    <div class="container py-8">
        <h1 class="stellaris-header">Stellaris Solar System Editor V10</h1>
        <div class="text-center mb-6">
            <span class="text-yellow-400 font-semibold">Enhanced Version mit korrektem Modifier-System f√ºr Planetary Diversity</span>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <!-- System Details Panel -->
            <div class="stellaris-panel md:col-span-3">
                <h2 class="section-title">Systemdetails</h2>
                
                <!-- Import Section -->
                <div class="mb-6 p-4 bg-gradient-to-r from-purple-900/30 to-blue-900/30 rounded-lg border border-purple-500/30">
                    <h3 class="text-lg font-medium mb-3 text-purple-400">üìÇ System Import/Export</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="label">Bestehendes System laden (.txt)</label>
                            <input type="file" id="importFile" class="stellaris-input" accept=".txt" style="padding: 0.5rem;">
                        </div>
                        <div class="flex items-end">
                            <button id="importBtn" class="stellaris-btn stellaris-btn-secondary">System importieren</button>
                            <button id="clearSystemBtn" class="stellaris-btn stellaris-btn-danger ml-2">System leeren</button>
                            <button onclick="showSystemTypeDialog()" class="stellaris-btn ml-2" title="Neues System mit korrektem Naming erstellen">
                                üåü Neues System
                            </button>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2">
                    <div>
                        <label class="label">Systemname (Interner Bezeichner)</label>
                        <input type="text" id="systemName" class="stellaris-input" placeholder="z.B. akon_system_initializer">
                    </div>
                    <div>
                        <label class="label">Anzeigename des Systems</label>
                        <input type="text" id="systemDisplayName" class="stellaris-input" placeholder="z.B. Akon">
                    </div>
                    <div>
                        <label class="label">Sternenklasse</label>
                        <select id="systemClass" class="stellaris-input">
                            <optgroup label="‚≠ê Hauptreihen-Sterne">
                                <option value="sc_o">O-Klasse Stern (Blauer √úberriese)</option>
                                <option value="sc_b">B-Klasse Stern (Hei√üer Riese)</option>
                                <option value="sc_a">A-Klasse Stern (Wei√üer Stern)</option>
                                <option value="sc_f">F-Klasse Stern (Gelblich-wei√üer Stern)</option>
                                <option value="sc_g" selected>G-Klasse Stern (Gelber Zwerg - Sol)</option>
                                <option value="sc_k">K-Klasse Stern (Oranger Zwerg)</option>
                                <option value="sc_m">M-Klasse Stern (Roter Zwerg)</option>
                                <option value="sc_t">T-Klasse Stern (Brauner Zwerg)</option>
                            </optgroup>
                            <optgroup label="üî¥ Riesen & Spezial-Sterne">
                                <option value="sc_m_giant">Roter Riese (M-Riese)</option>
                                <option value="sc_toxoid_star">Toxoider Stern (Toxoids DLC)</option>
                                <option value="sc_rift_star">Rift-Stern (Astral Planes DLC)</option>
                            </optgroup>
                            <optgroup label="‚ö´ Kompakte Objekte">
                                <option value="sc_black_hole">Schwarzes Loch</option>
                                <option value="sc_neutron_star">Neutronenstern</option>
                                <option value="sc_pulsar">Pulsar</option>
                            </optgroup>
                            <optgroup label="üåå Multi-Stern-Systeme">
                                <option value="sc_binary">Bin√§r-System (Zuf√§llig)</option>
                                <option value="sc_trinary">Trin√§r-System (Zuf√§llig)</option>
                            </optgroup>
                        </select>
                    </div>
                    <div>
                        <label class="label">Verwendung</label>
                        <select id="systemUsage" class="stellaris-input">
                            <option value="empire_init">Imperiumsstart (Zuf√§llig)</option>
                            <option value="custom_empire" selected>Benutzerdefiniertes Imperium (W√§hlbar)</option>
                            <option value="misc_system_init">Verschiedenes System (Zuf√§llig)</option>
                            <option value="">Keine (Nur durch Ereignis)</option>
                        </select>
                    </div>
                </div>

                <!--System Flags Block-->
                <div class="mt-6 p-4 bg-gradient-to-r from-blue-900/30 to-purple-900/30 rounded-lg border border-blue-500/30">
                    <h3 class="text-lg font-medium mb-4 text-blue-400">üè¥ System Flags</h3>
                    
                    <div class="mb-3 p-2 bg-blue-900/20 rounded border border-blue-500/30">
                        <p class="text-blue-200 text-xs">
                            <strong>Flags</strong> werden f√ºr Event-Trigger, Origin-Checks und Story-Integration verwendet.<br>
                            Beispiele: <code>empire_home_system</code>, <code>sol_system</code>, <code>special_project</code>
                        </p>
                    </div>
                    
                    <div id="systemFlagsList" class="space-y-2 mb-4 max-h-40 overflow-y-auto">
                        <p class="text-gray-400 text-sm">Keine System-Flags gesetzt</p>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="md:col-span-2">
                            <label class="label">Neues Flag</label>
                            <input type="text" id="newSystemFlag" class="stellaris-input" 
                                   placeholder="z.B. empire_home_system">
                        </div>
                        <div class="flex items-end">
                            <button id="addSystemFlagBtn" class="stellaris-btn stellaris-btn-secondary w-full">
                                Flag hinzuf√ºgen
                            </button>
                        </div>
                    </div>
                    
                    <!-- Quick Add Common Flags -->
                    <div class="mt-3">
                        <label class="label text-xs">H√§ufige Flags:</label>
                        <div class="flex flex-wrap gap-2 mt-1">
                            <button onclick="quickAddSystemFlag('empire_home_system')" 
                                    class="text-xs px-2 py-1 bg-blue-600 rounded hover:bg-blue-700">
                                empire_home_system
                            </button>
                            <button onclick="quickAddSystemFlag('sol_system')" 
                                    class="text-xs px-2 py-1 bg-blue-600 rounded hover:bg-blue-700">
                                sol_system
                            </button>
                            <button onclick="quickAddSystemFlag('suppress_archaeological_sites')" 
                                    class="text-xs px-2 py-1 bg-blue-600 rounded hover:bg-blue-700">
                                suppress_sites
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Visualizer Panel -->
                <div class="stellaris-panel md:col-span-3" style="height: 1000px;">
                    <h2 class="section-title">System-Visualisierung</h2>
                    <div id="visualizer" class="stellaris-visualizer">
                        <!-- Celestial bodies will be rendered here -->
                    </div>
                    <div class="mt-4">
                        <button id="zoomInBtn" class="stellaris-btn stellaris-btn-secondary text-sm px-2 py-1">Zoom +</button>
                        <button id="zoomOutBtn" class="stellaris-btn stellaris-btn-secondary text-sm px-2 py-1 ml-2">Zoom -</button>
                        <button id="resetViewBtn" class="stellaris-btn stellaris-btn-secondary text-sm px-2 py-1 ml-2">Reset</button>
                    </div>
                </div>
            </div>

                <div class="mt-6">
                    <button id="addPlanetBtn" class="stellaris-btn">Planet hinzuf√ºgen</button>
                    <button id="moveUpBtn" class="stellaris-btn stellaris-btn-secondary ml-2" disabled>‚Üë Nach oben</button>
                    <button id="moveDownBtn" class="stellaris-btn stellaris-btn-secondary ml-2" disabled>‚Üì Nach unten</button>
                </div>

                
                
                <!-- Asteroid Belt Configuration -->
                <div class="mt-6 p-4 bg-gray-800 rounded-lg">
                    <h3 class="text-lg font-medium mb-4 text-yellow-400">Asteroideng√ºrtel (Multiple m√∂glich)</h3>
                    <div id="asteroidBeltList" class="space-y-2 mb-4">
                        <p class="text-gray-400 text-sm">Keine Asteroideng√ºrtel definiert</p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="label">Typ</label>
                            <select id="newAsteroidBeltType" class="stellaris-input">
                                <option value="rocky_asteroid_belt">Rocky Asteroid Belt</option>
                                <option value="icy_asteroid_belt">Icy Asteroid Belt</option>
                                <option value="crystalline_asteroid_belt">Crystalline Asteroid Belt</option>
                            </select>
                        </div>
                        <div>
                            <label class="label">Radius</label>
                            <input type="number" id="newAsteroidBeltRadius" class="stellaris-input" value="575" min="100" max="1000">
                        </div>
                        <div class="flex items-end">
                            <button id="addAsteroidBeltBtn" class="stellaris-btn stellaris-btn-secondary">G√ºrtel hinzuf√ºgen</button>
                        </div>
                    </div>
                </div>
                
                <!-- Orbit Distance Info -->
                <div class="orbit-distance-info mt-4">
                    <strong>üí° Stellaris Kumulative Orbit-Mechanik:</strong><br>
                    üìè <strong>Kumulative Addition:</strong> orbit_distance wird zur Gesamtdistanz addiert<br>
                    üü° <strong>Planet 1:</strong> orbit_distance = 25 ‚Üí Umlaufbahn bei 25<br>
                    üü° <strong>Planet 2:</strong> orbit_distance = 30 ‚Üí Umlaufbahn bei 25+30 = 55<br>
                    ‚ö™ <strong>Planet 3:</strong> orbit_distance = 0 ‚Üí Gleiche Umlaufbahn bei 55
                </div>
            </div>

            

        <div class="grid grid-cols-1 lg:grid-cols-3 mb-8">
            <!-- Planet List -->
            <div class="stellaris-panel">
                <h2 class="section-title">Planeten (Reihenfolge)</h2>
                <div id="planetList" class="max-height overflow-y-auto>
                    <p class="text-gray-400">F√ºgen Sie Planeten hinzu, um mit dem Systembau zu beginnen.</p>
                </div>
            </div>

            <!-- Celestial Body Details Panel -->
            <div class="stellaris-panel lg:col-span-2">
                <h2 class="section-title">Planet-Details</h2>
                <div id="celestialDetails" class="hidden">
                    <div class="grid grid-cols-1 md:grid-cols-2">
                        <div>
                            <label class="label">Typ</label>
                            <input type="text" id="celestialType" class="stellaris-input cursor-not-allowed" readonly>
                        </div>
                        <div>
                            <label class="label">Position in System</label>
                            <input type="text" id="celestialPosition" class="stellaris-input cursor-not-allowed" readonly>
                        </div>
                        <div>
                            <label class="label">Name (Interner Bezeichner)</label>
                            <input type="text" id="celestialName" class="stellaris-input" placeholder="z.B. akon">
                        </div>
                        <div>
                            <label class="label">Anzeigename</label>
                            <input type="text" id="celestialDisplayName" class="stellaris-input" placeholder="z.B. Akon">
                        </div>
                        <div>
                            <label class="label">Basis-Planetenklasse</label>
                            <select id="celestialClass" class="stellaris-input">
                                <optgroup label="Sterne">
                                    <option value="pc_b_star">B-Klasse Stern</option>
                                    <option value="pc_a_star">A-Klasse Stern</option>
                                    <option value="pc_f_star">F-Klasse Stern</option>
                                    <option value="pc_g_star">G-Klasse Stern</option>
                                    <option value="pc_k_star">K-Klasse Stern</option>
                                    <option value="pc_m_star">M-Klasse Stern</option>
                                    <option value="pc_black_hole">Schwarzes Loch</option>
                                    <option value="pc_neutron_star">Neutronenstern</option>
                                    <option value="pc_pulsar">Pulsar</option>
                                    <option value="pc_brown_dwarf">Brauner Zwerg</option>
                                </optgroup>
                                <optgroup label="Bewohnbare Welten (Vanilla)">
                                    <option value="pc_continental">Kontinental</option>
                                    <option value="pc_ocean">Ozean</option>
                                    <option value="pc_tropical">Tropisch</option>
                                    <option value="pc_arid">Arid</option>
                                    <option value="pc_desert">W√ºste</option>
                                    <option value="pc_savannah">Savanne</option>
                                    <option value="pc_arctic">Arktisch</option>
                                    <option value="pc_tundra">Tundra</option>
                                    <option value="pc_alpine">Alpin</option>
                                    <option value="pc_gaia">Gaia</option>
                                </optgroup>
                                <optgroup label="Unbewohnbare Welten">
                                    <option value="pc_barren" selected>Karg</option>
                                    <option value="pc_barren_cold">Karg (Kalt)</option>
                                    <option value="pc_frozen">Gefroren</option>
                                    <option value="pc_molten">Geschmolzen</option>
                                    <option value="pc_toxic">Toxisch</option>
                                    <option value="pc_gas_giant">Gasriese</option>
                                    <option value="pc_nuked">Verstrahlt</option>
                                    <option value="pc_asteroid">Asteroid</option>
                                </optgroup>
                                <optgroup label="Spezielle Welten">
                                    <option value="pc_relic">Relikt-Welt</option>
                                    <option value="pc_habitat">Habitat</option>
                                    <option value="pc_ecumenopolis">√ñkumenopolis</option>
                                    <option value="pc_machine">Maschinenwelt</option>
                                    <option value="pc_hive">Schwarmwelt</option>
                                    <option value="pc_shielded">Abgeschirmt</option>
                                </optgroup>
                                <optgroup label="üåå Gigastructural Engineers">
                                    <option value="pc_birch">Birch World</option>
                                    <option value="pc_alderson">Alderson Disk</option>
                                    <option value="pc_gas_giant_habitable">Habitable Gas Giant</option>
                                    <option value="pc_stellar_systemcraft">Stellar Systemcraft</option>
                                    <option value="pc_nicoll_dyson_beam">Nicoll-Dyson Beam Target</option>
                                    <option value="pc_penrose_sphere_habitable">Penrose Sphere Habitat</option>
                                    <option value="pc_virtual_reality">Virtual Reality World</option>
                                    <option value="pc_pouchkinn_planet">Pouchkinn Planet</option>
                                    <option value="pc_gigastructural_shielded">Gigastructural Shielded World</option>
                                    <option value="pc_quasi_stellar_obliterator">Quasi-Stellar Obliterator</option>
                                    <option value="pc_neutronium_gigaforge">Neutronium Gigaforge</option>
                                </optgroup>
                                <optgroup label="‚ú® PD: Uncommon Worlds">
                                    <option value="pc_superhabitable">Superhabitable</option>
                                    <option value="pc_tidally_locked">Tidally Locked</option>
                                    <option value="pc_mantle">Mantle World</option>
                                    <option value="pc_karst">Karst World</option>
                                    <option value="pc_crystal">Crystal World</option>
                                    <option value="pc_frozen_desert">Frozen Desert</option>
                                    <option value="pc_ash">Ash World</option>
                                    <option value="pc_marginal">Marginal World</option>
                                    <option value="pc_sandsea">Sand Sea World</option>
                                    <option value="pc_technoorganic">Techno-organic World</option>
                                    <option value="pd_wet_cave_world">Wet Cave World</option>
                                    <option value="pd_dry_cave_world">Dry Cave World</option>
                                    <option value="pd_cold_cave_world">Cold Cave World</option>
                                    <option value="pd_wet_superhabitable_world">Wet Superhabitable</option>
                                    <option value="pd_dry_superhabitable_world">Dry Superhabitable</option>
                                    <option value="pd_cold_superhabitable_world">Cold Superhabitable</option>
                                    <option value="pd_wet_tidally_locked_world">Wet Tidally Locked</option>
                                    <option value="pd_dry_tidally_locked_world">Dry Tidally Locked</option>
                                    <option value="pd_cold_tidally_locked_world">Cold Tidally Locked</option>
                                </optgroup>
                                <optgroup label="ü™® PD: Enhanced Uninhabitable">
                                    <option value="pc_barren_cold">Karg (Kalt)</option>
                                    <option value="pc_hothouse">Treibhaus</option>
                                    <option value="pc_hot_gas_giant">Hei√üer Gasriese</option>
                                    <option value="pc_cold_gas_giant">Kalter Gasriese</option>
                                    <option value="pc_dwarf_gas_giant">Zwerg-Gasriese</option>
                                    <option value="pc_shattered">Zerst√∂rt</option>
                                    <option value="pc_subglacial">Subglazial</option>
                                    <option value="pc_storm">Sturm-Welt</option>
                                </optgroup>
                        </select>
                        </div>
                        <div>
                            <label class="label">Gr√∂√üe (1-50)</label>
                            <input type="number" id="celestialSize" class="stellaris-input" min="1" max="50" value="16">
                        </div>
                        <div>
                            <label class="label">Orbit Distance</label>
                            <input type="number" id="celestialOrbitDistance" class="stellaris-input" min="0" value="0">
                            <small class="text-gray-400 text-xs">0 = Gleiche Umlaufbahn wie vorheriger Planet</small>
                        </div>
                        <div>
                            <label class="label">Orbit Angle (Typ)</label>
                            <select id="orbitAngleType" class="stellaris-input">
                                <option value="fixed">Fester Winkel (manuell)</option>
                                <option value="range" selected>Winkelbereich (zuf√§llig)</option>
                                <option value="shared_180">Shared Orbit: 180¬∞ (2 Objekte)</option>
                                <option value="shared_120">Shared Orbit: 120¬∞ (3 Objekte)</option>
                                <option value="shared_90">Shared Orbit: 90¬∞ (4 Objekte)</option>
                                <option value="shared_60">Shared Orbit: 60¬∞ (6 Objekte)</option>
                            </select>
                            <small class="text-gray-400 text-xs mt-1 block">Shared Orbit: Mehrere Objekte auf gleicher Umlaufbahn gleichm√§√üig verteilen</small>
                        </div>
                        <div class="orbit-angle-controls">
                            <div id="fixedAngleControl" class="hidden">
                                <label class="label">Winkel (0-360¬∞)</label>
                                <input type="number" id="celestialOrbitAngle" class="stellaris-input" min="0" max="360" value="0">
                            </div>
                            <div id="rangeAngleControl">
                                <label class="label">Winkelbereich</label>
                                <div class="grid grid-cols-2 gap-2">
                                    <input type="number" id="celestialOrbitAngleMin" class="stellaris-input" min="0" max="360" value="90" placeholder="Min">
                                    <input type="number" id="celestialOrbitAngleMax" class="stellaris-input" min="0" max="360" value="270" placeholder="Max">
                                </div>
                            </div>
                        </div>
                        <div>
                            <label class="label">Change Orbit (f√ºr nachfolgende Planeten)</label>
                            <input type="number" id="celestialChangeOrbit" class="stellaris-input" min="0" value="0">
                            <small class="text-gray-400 text-xs">0 = Keine √Ñnderung</small>
                        </div>
                        <div class="md:col-span-2">
                            <div class="grid grid-cols-2 gap-4">
                                <label class="label">
                                    <input type="checkbox" id="celestialHasRing" class="mr-2">
                                    Hat Ringsystem
                                </label>
                                <label class="label">
                                    <input type="checkbox" id="celestialIsStartingPlanet" class="mr-2">
                                    Startplanet (Empire)
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="mt-4 p-4 bg-gradient-to-r from-purple-900/30 to-blue-900/30 rounded-lg border border-purple-500/30">
                        <h3 class="text-lg font-medium mb-4 text-purple-400">üè¥ Planet Flags & Erweitert</h3>
                        
                        <div id="planetFlagsList" class="space-y-2 mb-4 max-h-32 overflow-y-auto">
                            <p class="text-gray-400 text-sm">Keine Planet-Flags gesetzt</p>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                            <div class="md:col-span-2">
                                <label class="label">Neues Planet Flag</label>
                                <input type="text" id="newPlanetFlag" class="stellaris-input" 
                                       placeholder="z.B. planet_earth">
                            </div>
                            <div class="flex items-end">
                                <button id="addPlanetFlagBtn" class="stellaris-btn stellaris-btn-secondary w-full">
                                    Flag hinzuf√ºgen
                                </button>
                            </div>
                        </div>
                        
                        <!-- Advanced Options -->
                        <div class="border-t border-purple-500/30 pt-4">
                            <h4 class="text-sm font-medium mb-3 text-purple-300">Erweiterte Optionen</h4>
                            
                            <div class="space-y-2">
                                <label class="label flex items-center">
                                    <input type="checkbox" id="celestialPreventAnomaly" class="mr-2">
                                    <span>Prevent Anomaly</span>
                                    <span class="ml-2 text-xs text-gray-400">(verhindert zuf√§llige Anomalien)</span>
                                </label>
                                
                                <div>
                                    <label class="label">Entity Override (visuelles Modell)</label>
                                    <select id="celestialEntity" class="stellaris-input">
                                        <option value="">Standard (automatisch)</option>
                                        <optgroup label="Spezielle Earth Entities">
                                            <option value="continental_planet_earth_entity">Earth (Continental)</option>
                                            <option value="barren_planet_mars_entity">Mars (Barren)</option>
                                            <option value="cold_barren_planet_luna_entity">Luna (Barren Cold)</option>
                                        </optgroup>
                                        <optgroup label="Gas Giants">
                                            <option value="gas_giant_jupiter_entity">Jupiter</option>
                                            <option value="gas_giant_05_entity">Saturn Style</option>
                                            <option value="gas_giant_uranus_entity">Uranus</option>
                                            <option value="gas_giant_neptune_entity">Neptune</option>
                                        </optgroup>
                                        <optgroup label="Molten/Toxic">
                                            <option value="molten_planet_mercury_entity">Mercury (Molten)</option>
                                            <option value="toxic_planet_venus_entity">Venus (Toxic)</option>
                                        </optgroup>
                                    </select>
                                    <small class="text-gray-400 text-xs">√úberschreibt Standard-Planetenmodell mit spezifischem Entity</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Modifier System -->
                    <div class="modifier-panel">
                        <h3 class="text-lg font-medium mb-4 text-green-400">üåø Intelligentes Planet-Modifier System</h3>
                        <div class="mb-3 p-2 bg-blue-900/20 rounded border border-blue-500/30">
                            <p class="text-blue-200 text-xs">
                                <strong>Planetary Diversity:</strong> Zeigt nur kompatible Modifier f√ºr gew√§hlte Basis-Planetenklasse<br>
                                <strong>Andere:</strong> Standard-Modifier funktionieren mit allen Klassen
                            </p>
                        </div>
                        <div id="modifierList" class="space-y-2 mb-4">
                            <p class="text-gray-400 text-sm">Keine Modifier ausgew√§hlt</p>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="label">Modifier Kategorie</label>
                                <select id="modifierCategory" class="stellaris-input">
                                    <option value="">-- Kategorie w√§hlen --</option>
                                    <option value="planetary_diversity">Planetary Diversity</option>
                                    <option value="environmental">Umwelt-Modifier</option>
                                    <option value="resource">Ressourcen-Modifier</option>
                                    <option value="special">Spezial-Modifier</option>
                                </select>
                            </div>
                            <div>
                                <label class="label">Modifier</label>
                                <select id="modifierType" class="stellaris-input" disabled>
                                    <option value="">-- Erst Kategorie w√§hlen --</option>
                                </select>
                            </div>
                            <div class="flex items-end">
                                <button id="addModifierBtn" class="stellaris-btn stellaris-btn-success" disabled>Modifier hinzuf√ºgen</button>
                            </div>
                        </div>
                    </div>

                    <div class="mt-6">
                        <button id="addMoonBtn" class="stellaris-btn stellaris-btn-secondary">Mond hinzuf√ºgen</button>
                        <button id="deleteCelestialBtn" class="stellaris-btn stellaris-btn-danger ml-2">L√∂schen</button>
                    </div>
                </div>
                <p id="noCelestialSelected" class="text-gray-400">W√§hlen Sie einen Planeten aus der Liste, um seine Details zu bearbeiten.</p>
            </div>

            <!-- Neighbor Systems Configuration -->
                <div class="md:col-span-3 mt-8">
                    <h3 class="text-lg font-medium mb-4 text-indigo-400">üåå Nachbarsysteme</h3>

                    <!-- Neighbor Systems List -->
                    <div id="neighborSystemsList" class="space-y-2 mb-4 max-h-64 overflow-y-auto">
                        <p class="text-gray-400 text-sm">Keine Nachbarsysteme definiert</p>
                    </div>

                    <!-- Add Neighbor System -->
                    <div class="lg:col-span-2 space-y-6">
                        <h4 class="text-sm font-medium mb-3 text-blue-300">Neues Nachbarsystem hinzuf√ºgen</h4>
                        
                        <!-- Modus-Auswahl -->
                        <div class="mb-4">
                            <label class="label">Modus</label>
                            <select id="neighborMode" class="stellaris-input" onchange="toggleNeighborCustomFields()">
                                <option value="reference">Referenz zu existierendem System</option>
                                <option value="custom">Benutzerdefiniert (neues System)</option>
                            </select>
                        </div>
                        
                        <!-- ‚úÖ KORRIGIERT: Hyperlane Jumps statt Distance -->
                        <div class="mb-4">
                            <label class="label">Hyperlane Entfernung (Jumps)</label>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="text-xs text-gray-400">Min</label>
                                    <input type="number" id="neighborHyperlaneMin" class="stellaris-input" value="1" min="1" max="10">
                                </div>
                                <div>
                                    <label class="text-xs text-gray-400">Max</label>
                                    <input type="number" id="neighborHyperlaneMax" class="stellaris-input" value="3" min="1" max="10">
                                </div>
                            </div>
                            <p class="text-xs text-gray-400 mt-1">
                                üí° Tipp: 1-3 Jumps = Nahes Nachbarsystem, 4-6 = Weiter entfernt
                            </p>
                        </div>
                        
                        <!-- Trigger (Optional) -->
                        <div class="mb-4">
                            <label class="label">Trigger (Optional)</label>
                            <input type="text" id="neighborTrigger" class="stellaris-input" 
                                   placeholder="z.B. num_guaranteed_colonies >= 1">
                            <p class="text-xs text-gray-400 mt-1">
                                üí° Leer lassen f√ºr immer aktives Nachbarsystem
                            </p>
                        </div>
                        
                        <!-- Referenz-Modus Felder -->
                        <div id="referenceNeighborFields">
                            <div class="mb-4">
                                <label class="label">System-Referenz</label>
                                <input type="text" id="newNeighborReference" class="stellaris-input" 
                                       placeholder="z.B. sol_neighbor_t1, neighbor_t1_first_colony">
                                <p class="text-xs text-gray-400 mt-1">
                                    üí° Vanilla-Systeme: sol_neighbor_t1, neighbor_t1_first_colony, neighbor_t2
                                </p>
                            </div>
                        </div>
                        
                        <!-- Custom-Modus Felder -->
                        <div id="customNeighborFields" class="hidden">
                            <h4 class="text-sm font-medium mb-3 text-purple-300 border-t border-purple-500/30 pt-4">
                                Benutzerdefiniertes Nachbarsystem
                            </h4>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="label">Systemname</label>
                                    <input type="text" id="customNeighborName" class="stellaris-input" 
                                           placeholder="z.B. Alpha Proxima">
                                </div>
                                <div>
                                    <label class="label">Sternenklasse</label>
                                    <select id="customNeighborStarClass" class="stellaris-input">
                                        <optgroup label="‚≠ê Hauptreihe">
                                            <option value="sc_o">O-Klasse (Blauer √úberriese)</option>
                                            <option value="sc_b">B-Klasse (Hei√üer Riese)</option>
                                            <option value="sc_a">A-Klasse (Wei√üer Stern)</option>
                                            <option value="sc_f">F-Klasse (Gelblich-wei√ü)</option>
                                            <option value="sc_g" selected>G-Klasse (Gelber Zwerg)</option>
                                            <option value="sc_k">K-Klasse (Oranger Zwerg)</option>
                                            <option value="sc_m">M-Klasse (Roter Zwerg)</option>
                                            <option value="sc_t">T-Klasse (Brauner Zwerg)</option>
                                        </optgroup>
                                        <optgroup label="üî¥ Riesen">
                                            <option value="sc_m_giant">M-Riese (Roter Riese)</option>
                                            <option value="sc_toxoid_star">Toxoider Stern</option>
                                            <option value="sc_rift_star">Rift-Stern</option>
                                        </optgroup>
                                        <optgroup label="‚ö´ Kompakt">
                                            <option value="sc_black_hole">Schwarzes Loch</option>
                                            <option value="sc_neutron_star">Neutronenstern</option>
                                            <option value="sc_pulsar">Pulsar</option>
                                        </optgroup>
                                    </select>
                                </div>
                            </div>
                            
                            <!-- ‚úÖ NEU: Asteroideng√ºrtel -->
                            <div class="mb-4 p-3 bg-gray-800/50 rounded border border-yellow-500/30">
                                <div class="flex justify-between items-center mb-2">
                                    <label class="label mb-0">Asteroideng√ºrtel</label>
                                    <button onclick="addNeighborAsteroidBelt()" 
                                            class="stellaris-btn stellaris-btn-secondary text-xs px-2 py-1">
                                        + G√ºrtel hinzuf√ºgen
                                    </button>
                                </div>
                                <div id="customNeighborAsteroidsList" class="space-y-1 mt-2">
                                    <p class="text-gray-400 text-xs">Keine G√ºrtel definiert</p>
                                </div>
                            </div>
                            
                            <!-- ‚úÖ ERWEITERT: Planeten mit Mond-Support -->
                            <div class="p-3 bg-gray-800/50 rounded border border-green-500/30">
                                <div class="flex justify-between items-center mb-2">
                                    <label class="label mb-0">Planeten im Nachbarsystem</label>
                                    <div class="flex gap-2">
                                        <button onclick="addNeighborPlanetDraft('single')" 
                                                class="stellaris-btn stellaris-btn-secondary text-xs px-2 py-1">
                                            + Planet
                                        </button>
                                        <button onclick="addNeighborPlanetDraft('asteroid_group')" 
                                                class="stellaris-btn stellaris-btn-secondary text-xs px-2 py-1">
                                            + Asteroiden
                                        </button>
                                    </div>
                                </div>
                                <div id="customNeighborPlanetsList" class="space-y-2 mt-2 max-h-64 overflow-y-auto">
                                    <p class="text-gray-400 text-xs">Keine Planeten definiert</p>
                                </div>
                            </div>
                        </div>
                        
                        <button id="addNeighborBtn" class="stellaris-btn stellaris-btn-secondary w-full mt-4">
                            Nachbarsystem hinzuf√ºgen
                        </button>
                    </div>
                </div>
        </div>

        <div class="stellaris-panel md:col-span-3 mt-8">
            <h2 class="section-title">üåç System-Variationen (Origin Support)</h2>
            
            <div class="mb-6 p-4 bg-gradient-to-r from-green-900/30 to-blue-900/30 rounded-lg border border-green-500/30">
                <div class="flex items-start gap-3">
                    <span class="text-3xl">üí°</span>
                    <div>
                        <p class="text-green-200 font-semibold mb-2">Was sind System-Variationen?</p>
                        <p class="text-green-200 text-sm">
                            Viele Stellaris Origins verwenden <strong>modifizierte Versionen</strong> desselben Sonnensystems. 
                            Zum Beispiel hat das Sol-System 7 verschiedene Varianten f√ºr Origins wie "Commonwealth", "Lost Colony", 
                            "Knights of the Toxic God", etc.<br><br>
                            Aktiviere die gew√ºnschten Varianten unten - beim Export werden automatisch alle aktivierten Versionen 
                            als separate System-Initializers generiert!
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- ========== NEU: FILTER-PANEL F√úR V9 ========== -->
            <div class="mb-6 p-4 bg-gradient-to-r from-purple-900/30 to-blue-900/30 rounded-lg border border-purple-500/30">
                <h3 class="text-lg font-semibold mb-4 text-purple-300">üîç Filter & Suche</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <!-- DLC Filter -->
                    <div>
                        <label class="label text-sm">DLCs (nur Systeme mit diesen DLCs zeigen)</label>
                        <div id="dlcFilters" class="space-y-2 max-h-40 overflow-y-auto bg-gray-800 p-3 rounded">
                            <!-- Wird mit JavaScript gef√ºllt -->
                        </div>
                    </div>
                    
                    <!-- System Type Filter -->
                    <div>
                        <label class="label text-sm">System-Typ</label>
                        <select id="typeFilter" class="stellaris-input">
                            <option value="all">Alle Typen</option>
                            <option value="single">Einzelstern</option>
                            <option value="binary">Doppelstern</option>
                            <option value="trinary">Dreifachstern</option>
                        </select>
                    </div>
                    
                    <!-- Features Filter -->
                    <div>
                        <label class="label text-sm">Features</label>
                        <div class="space-y-2">
                            <label class="flex items-center gap-2 text-sm cursor-pointer">
                                <input type="checkbox" value="megastructures" class="feature-filter">
                                <span>üèóÔ∏è Megastrukturen</span>
                            </label>
                            <label class="flex items-center gap-2 text-sm cursor-pointer">
                                <input type="checkbox" value="guardians" class="feature-filter">
                                <span>üêâ Guardians</span>
                            </label>
                            <label class="flex items-center gap-2 text-sm cursor-pointer">
                                <input type="checkbox" value="habitats" class="feature-filter">
                                <span>üõ∏ Habitats</span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- Reset Filter Button -->
                <div class="mt-4 flex justify-end">
                    <button id="resetFiltersBtn" class="stellaris-btn stellaris-btn-secondary text-sm px-4 py-2">
                        üîÑ Filter zur√ºcksetzen
                    </button>
                </div>
            </div>
            <!-- ========== ENDE FILTER-PANEL ========== -->
        </div>

        <!-- Variation Cards Grid -->
        <div id="variationsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
                <!-- Wird dynamisch mit JavaScript gef√ºllt -->
            </div>
            
            <!-- Status Footer -->
            <div class="mt-6 p-4 bg-gradient-to-r from-blue-900/30 to-purple-900/30 rounded-lg border border-blue-500/30">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-blue-200 font-semibold">Export Status</p>
                        <p class="text-blue-300 text-sm mt-1">
                            <span id="variationCount">1</span> System-Initializer(s) werden beim Export generiert
                        </p>
                    </div>
                    <button id="previewVariationsBtn" class="stellaris-btn stellaris-btn-secondary">
                        Vorschau aller Varianten
                    </button>
                </div>
            </div>
        </div>

        <!-- ========== ORIGIN MECHANICS PANEL V2 - MULTI-SELECTION ========== -->
        <div class="stellaris-panel md:col-span-3 mt-8">
            <h2 class="section-title">üéØ Origin-Mechaniken (Optional - Multi-Selection)</h2>
            
            <div class="mb-6 p-4 bg-gradient-to-r from-amber-900/30 to-orange-900/30 rounded-lg border border-amber-500/30">
                <div class="flex items-start gap-3">
                    <span class="text-3xl">‚ú®</span>
                    <div>
                        <p class="text-amber-200 font-semibold mb-2">Wie funktioniert Multi-Selection?</p>
                        <p class="text-amber-200 text-sm">
                            W√§hle <strong>mehrere Origins</strong> aus, um verschiedene Varianten deines Systems zu erstellen!<br><br>
                            <strong>Beispiel:</strong> Du erstellst "Alpha Centauri" als Blank System und aktivierst 3 Origins 
                            (Void Dwellers, Life Seeded, Mechanist) ‚Üí Der Export generiert 3 separate System-Initializers:
                            <ul class="list-disc list-inside mt-2 space-y-1">
                                <li><code>alpha_centauri_void_dwellers</code> - mit Habitaten</li>
                                <li><code>alpha_centauri_life_seeded</code> - mit Gaia-Welt</li>
                                <li><code>alpha_centauri_mechanist</code> - mit Robot-Integration</li>
                            </ul>
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- Filter Section -->
            <div class="mb-6 p-4 bg-gradient-to-r from-purple-900/30 to-blue-900/30 rounded-lg border border-purple-500/30">
                <h3 class="text-lg font-semibold mb-4 text-purple-300">üîç Filter</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- DLC Filter -->
                    <div>
                        <label class="label text-sm">DLCs</label>
                        <div id="originDlcFilters" class="space-y-2 max-h-32 overflow-y-auto bg-gray-800 p-3 rounded">
                            <!-- Wird mit JavaScript gef√ºllt -->
                        </div>
                    </div>
                    
                    <!-- Category Filter -->
                    <div>
                        <label class="label text-sm">Kategorie</label>
                        <select id="originCategoryFilter" class="stellaris-input">
                            <option value="all">Alle Kategorien</option>
                            <option value="habitat_space">Habitat & Space-Based</option>
                            <option value="planet_mods">Planet Modifiers</option>
                            <option value="civ_mods">Civilization Modifiers</option>
                            <option value="story_special">Story & Special</option>
                        </select>
                    </div>
                </div>
                
                <!-- Quick Actions -->
                <div class="mt-4 flex gap-2">
                    <button id="selectAllOriginsBtn" class="stellaris-btn stellaris-btn-secondary text-sm px-4 py-2">
                        ‚úÖ Alle ausw√§hlen
                    </button>
                    <button id="deselectAllOriginsBtn" class="stellaris-btn stellaris-btn-secondary text-sm px-4 py-2">
                        ‚ùå Alle abw√§hlen
                    </button>
                    <button id="resetOriginFiltersBtn" class="stellaris-btn stellaris-btn-secondary text-sm px-4 py-2">
                        üîÑ Filter zur√ºcksetzen
                    </button>
                </div>
            </div>
            
            <!-- Origin Cards Grid -->
            <div id="originCardsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
                <!-- Wird dynamisch mit JavaScript gef√ºllt -->
            </div>
            
            <!-- Status Footer -->
            <div class="mt-6 p-4 bg-gradient-to-r from-blue-900/30 to-purple-900/30 rounded-lg border border-blue-500/30">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-blue-200 font-semibold">Export Status</p>
                        <p class="text-blue-300 text-sm mt-1">
                            <span id="originVariantCount">0</span> Origin-Variante(n) werden zus√§tzlich generiert
                        </p>
                        <p class="text-gray-400 text-xs mt-1">
                            Gesamtanzahl Initializers = (System-Variationen √ó Origin-Varianten)
                        </p>
                    </div>
                    <button id="previewOriginVariantsBtn" class="stellaris-btn stellaris-btn-secondary">
                        üëÅÔ∏è Vorschau aller Origin-Varianten
                    </button>
                </div>
            </div>
        </div>

        <!-- Export Section -->
        <div class="stellaris-panel">
            <h2 class="section-title">Export</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <h3 class="text-xl font-medium mb-4 text-green-400">Generierter Stellaris Code (.txt)</h3>
                    <textarea id="exportTxt" class="stellaris-export-area w-full" rows="40" readonly></textarea>
                    <button id="downloadTxtBtn" class="stellaris-btn mt-4 w-full">Als .txt herunterladen</button>
                </div>
                <div>
                    <h3 class="text-xl font-medium mb-4 text-green-400">Generierte Lokalisierung (.yml)</h3>
                    <textarea id="exportYml" class="stellaris-export-area w-full" rows="40" readonly></textarea>
                    <button id="downloadYmlBtn" class="stellaris-btn mt-4 w-full">Als .yml herunterladen</button>
                </div>
            </div>
            
            <!-- ========== NEU: BATCH-EXPORT SECTION ========== -->
            <div class="mt-6 p-4 bg-gradient-to-r from-yellow-900/30 to-orange-900/30 rounded-lg border border-yellow-500/30">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-lg font-semibold text-yellow-300">üì¶ Batch-Export</h3>
                        <p class="text-yellow-200 text-sm mt-1">
                            Exportiere mehrere System-Varianten auf einmal in eine einzige Datei
                        </p>
                    </div>
                    <button id="batchExportBtn" class="stellaris-btn stellaris-btn-secondary">
                        üì¶ Systeme ausw√§hlen & exportieren
                    </button>
                </div>
            </div>
            <!-- ========== ENDE BATCH-EXPORT ========== -->
            
            <div class="mt-6 p-4 bg-gradient-to-r from-green-900/30 to-blue-900/30 rounded-lg border border-green-500/30">
                <p class="font-semibold text-green-300 mb-2">üéØ V7 Features - System-Variationen & Erweiterte Kompatibilit√§t:</p>
                <ul class="list-disc list-inside space-y-1 text-sm">
                    <li><strong>üåç System-Variationen:</strong> Automatische Origin-Varianten mit einem Klick</li>
                    <li><strong>üè¥ Flags System:</strong> System- und Planet-Flags f√ºr Event-Integration</li>
                    <li><strong>üö´ Prevent Anomaly:</strong> Verhindere zuf√§llige Anomalien auf Planeten</li>
                    <li><strong>üé® Entity Override:</strong> Benutzerdefinierte Planeten-Visualisierungen</li>
                    <li><strong>üì¶ Multi-Variant Export:</strong> Alle Varianten in einer Datei oder separat</li>
                    <li><strong>‚úÖ Vanilla-Kompatibilit√§t:</strong> 100% kompatibel mit allen Stellaris Origins</li>
                    <li><strong>üîÑ V6 Features:</strong> Alle bisherigen Features vollst√§ndig erhalten</li>
                </ul>
                <div class="mt-4 p-3 bg-blue-900/20 rounded border border-blue-500/30">
                    <p class="text-blue-200 text-sm">
                        <strong>üí° Neu in V7:</strong> Erstelle komplexe Origin-Systeme wie "Knights of the Toxic God" 
                        oder "Fear of the Dark" mit automatischen Planet-Modifikationen und Flags!
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        /*
        ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
        ‚ïë     STELLARIS SOLAR SYSTEM EDITOR V10 - CODE STRUKTUR                ‚ïë
        ‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
        ‚ïë                                                                      ‚ïë
        ‚ïë  INHALTSVERZEICHNIS (Suche mit Strg+F nach [SECTION-XX])           ‚ïë
        ‚ïë                                                                      ‚ïë
        ‚ïë  [SECTION-01] Datenmodelle & Konfiguration                          ‚ïë
        ‚ïë  [SECTION-02] Modifier & Planetenklassen Datenbank                  ‚ïë
        ‚ïë  [SECTION-03] System-Variationen (Origins)                          ‚ïë
        ‚ïë  [SECTION-04] DOM Element Referenzen                                ‚ïë
        ‚ïë  [SECTION-05] Modifier System Funktionen                            ‚ïë
        ‚ïë  [SECTION-06] Flag Management (System & Planeten)                   ‚ïë
        ‚ïë  [SECTION-07] System-Variationen Funktionen                         ‚ïë
        ‚ïë  [SECTION-08] Planet Management Funktionen                          ‚ïë
        ‚ïë  [SECTION-09] Nachbarsystem Management                              ‚ïë
        ‚ïë  [SECTION-10] Asteroideng√ºrtel Management                           ‚ïë
        ‚ïë  [SECTION-11] Import/Export Funktionen                              ‚ïë
        ‚ïë  [SECTION-12] Code-Generierung (Stellaris .txt)                     ‚ïë
        ‚ïë  [SECTION-13] UI Update Funktionen                                  ‚ïë
        ‚ïë  [SECTION-14] Visualisierung (Canvas)                               ‚ïë
        ‚ïë  [SECTION-15] Helper Funktionen (Icons, Farben, etc.)               ‚ïë
        ‚ïë  [SECTION-16] Event Listener Initialisierung                        ‚ïë
        ‚ïë  [SECTION-17] Globale Funktionen & Initialization                   ‚ïë
        ‚ïë                                                                      ‚ïë
        ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
        */

        // ============================================================
        // [SECTION-01] DATENMODELLE & KONFIGURATION
        // ============================================================
        // HIER: Hauptdatenstruktur des Sonnensystems
        // √ÑNDERN: Wenn du neue Eigenschaften zum System hinzuf√ºgen willst
        
        let solarSystem = {
            name: 'my_custom_system',
            displayName: 'Mein Sonnensystem',
            class: 'sc_g',
            usage: 'custom_empire',
            neighborSystems: [], // Array of neighbor systems
            asteroidBelts: [], // Array of multiple asteroid belts
            planets: [], // Sequential array of planets
            flags: [],
            usageOdds: null,
            maxInstances: null
        };

        let selectedPlanet = null;
        let nextCelestialId = 1;
        let visualizerScale = 0.3;

        // ============================================================
        // [SECTION-02] MODIFIER & PLANETENKLASSEN DATENBANK
        // ============================================================
        // HIER: Alle verf√ºgbaren Modifiers f√ºr Planeten
        // √ÑNDERN: Um neue Planetary Diversity Modifier hinzuzuf√ºgen
        // TIPP: F√ºge neue Modifier nach dem gleichen Muster hinzu

        // V7 ADDITION - System Variations Database

        // Intelligent Planet-Class-Based Modifier Database
        const MODIFIERS = {
            planetary_diversity: {
                name: "Planetary Diversity",
                modifiers: {
                    // Continental-based modifiers
                    pc_continental: {
                        "pd_retinal_world_effect": { name: "Retinal World", description: "Augen-√§hnliche Strukturen" },
                        "pd_lake_world_effect": { name: "Lake World", description: "Viele Seen und Wasserk√∂rper" },
                        "pd_tepid_world_effect": { name: "Tepid World", description: "Lauwarmes Klima" },
                        "pd_mushroom_world_effect": { name: "Mushroom World", description: "Dominiert von Pilzen" },
                        "pd_temperate_world_effect": { name: "Temperate World", description: "Gem√§√üigtes Klima" },
                        "pd_sakura_world_effect": { name: "Sakura World", description: "Kirschbl√ºten-Landschaften" },
                        "pd_moss_world_effect": { name: "Moss World", description: "Moos-bedeckt" },
                        "pd_marsh_world_effect": { name: "Marsh World", description: "Sumpfgebiete" },
                        "pd_forest_world_effect": { name: "Forest World", description: "Dichte W√§lder" },
                        "pd_megaflora_world_effect": { name: "Megaflora World", description: "Riesenpflanzen" },
                        "pd_petrified_world_effect": { name: "Petrified World", description: "Versteinerte Landschaften" }
                    },
                    // Ocean-based modifiers
                    pc_ocean: {
                        "pd_cascadian_world_effect": { name: "Cascadian World", description: "Wasserf√§lle und Kaskaden" },
                        "pd_swamp_world_effect": { name: "Swamp World", description: "Sumpfige Gebiete" },
                        "pd_crag_world_effect": { name: "Crag World", description: "Schroffe K√ºsten" },
                        "pd_fog_world_effect": { name: "Fog World", description: "Permanenter Nebel" },
                        "pd_kelp_world_effect": { name: "Kelp World", description: "Ausgedehnte Algenw√§lder" },
                        "pd_algae_world_effect": { name: "Algae World", description: "Algen-dominiert" },
                        "pd_columnar_world_effect": { name: "Columnar World", description: "S√§ulenf√∂rmige Strukturen" },
                        "pd_tidepool_world_effect": { name: "Tidepool World", description: "Gezeitent√ºmpel" },
                        "pd_reef_world_effect": { name: "Reef World", description: "Korallenriff-Strukturen" },
                        "pd_archipelago_world_effect": { name: "Archipelago World", description: "Inselgruppen" }
                    },
                    // Tropical-based modifiers
                    pc_tropical: {
                        "pd_atoll_world_effect": { name: "Atoll World", description: "Ringf√∂rmige Inseln" },
                        "pd_tepui_world_effect": { name: "Tepui World", description: "Tafelberge im Dschungel" },
                        "pd_mangrove_world_effect": { name: "Mangrove World", description: "Mangrovenw√§lder" },
                        "pd_cenote_world_effect": { name: "Cenote World", description: "Unterirdische Seen" },
                        "pd_fungal_world_effect": { name: "Fungal World", description: "Pilz-√ñkosysteme" },
                        "pd_aerial_world_effect": { name: "Aerial World", description: "Luftige Baumkronen" },
                        "pd_lilypad_world_effect": { name: "Lilypad World", description: "Riesige Seerosen" },
                        "pd_obsidian_world_effect": { name: "Obsidian World", description: "Vulkanisches Glas" },
                        "pd_geothermal_world_effect": { name: "Geothermal World", description: "Hei√üe Quellen" },
                        "pd_biolumen_world_effect": { name: "Bioluminescent World", description: "Leuchtende Organismen" }
                    },
                    // Desert-based modifiers
                    pc_desert: {
                        "pd_dune_world_effect": { name: "Dune World", description: "Wanderd√ºnen" },
                        "pd_oasis_world_effect": { name: "Oasis World", description: "Oasen in W√ºsten" },
                        "pd_outback_world_effect": { name: "Outback World", description: "Trockenes Buschland" },
                        "pd_coastal_world_effect": { name: "Coastal World", description: "W√ºstenk√ºsten" },
                        "pd_fungi_world_effect": { name: "Fungi World", description: "W√ºstenpilze" },
                        "pd_ironsand_world_effect": { name: "Ironsand World", description: "Eisenhaltiger Sand" },
                        "pd_cactus_world_effect": { name: "Cactus World", description: "Riesenkakteen" },
                        "pd_salt_world_effect": { name: "Salt World", description: "Salzw√ºsten" },
                        "pd_aquifer_world_effect": { name: "Aquifer World", description: "Unterirdisches Wasser" }
                    },
                    // Arid-based modifiers
                    pc_arid: {
                        "pd_mesa_world_effect": { name: "Mesa World", description: "Tafelberge und Plateaus" },
                        "pd_fog_desert_world_effect": { name: "Fog Desert World", description: "Nebelw√ºste" },
                        "pd_mediterranean_world_effect": { name: "Mediterranean World", description: "Mediterranes Klima" },
                        "pd_badlands_world_effect": { name: "Badlands World", description: "Zerkl√ºftete Landschaften" },
                        "pd_succulent_world_effect": { name: "Succulent World", description: "Sukkulenten-dominiert" },
                        "pd_striped_world_effect": { name: "Striped World", description: "Gestreifte Landschaften" },
                        "pd_amethyst_world_effect": { name: "Amethyst World", description: "Amethyst-Formationen" },
                        "pd_coral_world_effect": { name: "Coral World", description: "Fossile Korallenriffe" },
                        "pd_primal_world_effect": { name: "Primal World", description: "Urzeitliche Landschaften" }
                    },
                    // Savannah-based modifiers
                    pc_savannah: {
                        "pd_steppe_world_effect": { name: "Steppe World", description: "Weite Graslandschaften" },
                        "pd_prairie_world_effect": { name: "Prairie World", description: "Pr√§rie-√ñkosystem" },
                        "pd_veld_world_effect": { name: "Veld World", description: "Afrikanische Savanne" },
                        "pd_semi_arid_world_effect": { name: "Semi-Arid World", description: "Halbtrockenes Klima" },
                        "pd_aspen_world_effect": { name: "Aspen World", description: "Zitterpappel-W√§lder" },
                        "pd_sandstone_world_effect": { name: "Sandstone World", description: "Sandstein-Formationen" },
                        "pd_turquoise_world_effect": { name: "Turquoise World", description: "T√ºrkisfarbene Landschaften" },
                        "pd_calcite_world_effect": { name: "Calcite World", description: "Kalzit-Kristalle" },
                        "pd_monsoon_world_effect": { name: "Monsoon World", description: "Monsun-Klima" },
                        "pd_supercontinent_world_effect": { name: "Supercontinent World", description: "Riesiger Kontinent" },
                        "pd_sinkhole_world_effect": { name: "Sinkhole World", description: "Dolinen und Senkl√∂cher" }
                    },
                    // Arctic-based modifiers
                    pc_arctic: {
                        "pd_cold_desert_world_effect": { name: "Cold Desert World", description: "Kalte W√ºste" },
                        "pd_glacial_world_effect": { name: "Glacial World", description: "Gletscher-bedeckt" },
                        "pd_antarctic_world_effect": { name: "Antarctic World", description: "Antarktische Bedingungen" },
                        "pd_aeolian_world_effect": { name: "Aeolian World", description: "Windgeformte Landschaften" },
                        "pd_ice_spike_world_effect": { name: "Ice Spike World", description: "Eisstachel-Formationen" },
                        "pd_crevasse_world_effect": { name: "Crevasse World", description: "Gletscherspalten" },
                        "pd_ice_dunes_world_effect": { name: "Ice Dunes World", description: "Eisd√ºnen" },
                        "pd_ferrospring_world_effect": { name: "Ferrospring World", description: "Eisenhaltige Quellen" },
                        "pd_storm_world_effect": { name: "Storm World", description: "Permanente St√ºrme" },
                        "pd_iceberg_world_effect": { name: "Iceberg World", description: "Schwimmende Eisberge" }
                    },
                    // Alpine-based modifiers
                    pc_alpine: {
                        "pd_boreal_world_effect": { name: "Boreal World", description: "Nordische W√§lder" },
                        "pd_snow_world_effect": { name: "Snow World", description: "Schnee-bedeckt" },
                        "pd_highland_world_effect": { name: "Highland World", description: "Hochlandschaften" },
                        "pd_dune_forest_world_effect": { name: "Dune Forest World", description: "Waldige D√ºnen" },
                        "pd_fjord_world_effect": { name: "Fjord World", description: "Tiefe Fjorde" },
                        "pd_blossom_world_effect": { name: "Blossom World", description: "Bl√ºtenpracht" },
                        "pd_taiga_world_effect": { name: "Taiga World", description: "Nadelwald-Taiga" },
                        "pd_craton_world_effect": { name: "Craton World", description: "Alte Kontinentalplatten" },
                        "pd_glaciovolcanic_world_effect": { name: "Glaciovolcanic World", description: "Eis und Vulkane" },
                        "pd_lanthanide_world_effect": { name: "Lanthanide World", description: "Seltene Erden" }
                    },
                    // Tundra-based modifiers
                    pc_tundra: {
                        "pd_bog_world_effect": { name: "Bog World", description: "Torfmoore" },
                        "pd_mycelium_world_effect": { name: "Mycelium World", description: "Pilzmyzel-Netzwerke" },
                        "pd_mud_world_effect": { name: "Mud World", description: "Schlammige Landschaften" },
                        "pd_basalt_world_effect": { name: "Basalt World", description: "Basalt-Formationen" },
                        "pd_tuya_world_effect": { name: "Tuya World", description: "Tafelberge aus Eis" },
                        "pd_cryovolcano_world_effect": { name: "Cryovolcano World", description: "Eisvulkane" },
                        "pd_treeline_world_effect": { name: "Treeline World", description: "Baumgrenze-√ñkosysteme" },
                        "pd_cryoflora_world_effect": { name: "Cryoflora World", description: "K√§lte-angepasste Pflanzen" },
                        "pd_lichen_world_effect": { name: "Lichen World", description: "Flechten-dominiert" }
                    }
                }
            },
            environmental: {
                name: "Umwelt-Modifier",
                modifiers: {
                    "pm_tidal_locked": { name: "Gezeitengebunden", description: "Immer dieselbe Seite zur Sonne" },
                    "pm_asteroid_impacts": { name: "Asteroideneinschl√§ge", description: "Regelm√§√üige Einschl√§ge" },
                    "pm_unstable_weather": { name: "Instabiles Wetter", description: "Extreme Wetterschwankungen" },
                    "pm_strong_magnetic_field": { name: "Starkes Magnetfeld", description: "Schutz vor Strahlung" },
                    "pm_weak_magnetic_field": { name: "Schwaches Magnetfeld", description: "Erh√∂hte Strahlung" },
                    "pm_low_gravity": { name: "Niedrige Schwerkraft", description: "Geringe Gravitationskraft" },
                    "pm_high_gravity": { name: "Hohe Schwerkraft", description: "Starke Gravitationskraft" }
                }
            },
            resource: {
                name: "Ressourcen-Modifier",
                modifiers: {
                    "pm_mineral_rich": { name: "Mineralienreich", description: "+2 Mineralien aus Bergbau-Jobs" },
                    "pm_mineral_poor": { name: "Mineralienarm", description: "-1 Mineralien aus Bergbau-Jobs" },
                    "pm_energy_rich": { name: "Energiereich", description: "+2 Energie aus Techniker-Jobs" },
                    "pm_energy_poor": { name: "Energiearm", description: "-1 Energie aus Techniker-Jobs" },
                    "pm_food_rich": { name: "Nahrungsreich", description: "+2 Nahrung aus Farmer-Jobs" },
                    "pm_food_poor": { name: "Nahrungsarm", description: "-1 Nahrung aus Farmer-Jobs" }
                }
            },
            special: {
                name: "Spezial-Modifier",
                modifiers: {
                    // Terraforming Kandidaten (Vanilla)
                    "terraforming_candidate": { name: "Terraforming-Kandidat", description: "Geeignet f√ºr Terraforming (pc_barren, pc_barren_cold)" },
                    "toxic_terraforming_candidate": { name: "Toxic Terraforming-Kandidat", description: "Geeignet f√ºr Toxic-Terraforming (pc_toxic)" },
                    "frozen_terraforming_candidate": { name: "Frozen Terraforming-Kandidat", description: "Geeignet f√ºr Frozen-Terraforming (pc_frozen)" },
                    
                    // Allgemeine Planet-Modifier
                    "pm_natural_beauty": { name: "Nat√ºrliche Sch√∂nheit", description: "+5% Gl√ºck" },
                    "pm_dangerous_wildlife": { name: "Gef√§hrliche Tierwelt", description: "+25% Armeeaufbaugeschwindigkeit" },
                    "pm_lush": { name: "√úppig", description: "+20% Bev√∂lkerungswachstum" },
                    "pm_bleak": { name: "Trostlos", description: "-10% Gl√ºck" },
                    "pm_irradiated": { name: "Verstrahlt", description: "-10% Gesundheit" },
                    "pm_titanic_life": { name: "Titanisches Leben", description: "+4 Gesellschaftsforschung aus Forscher-Jobs" },
                    "pm_storm_wracked": { name: "Sturmgeplagt", description: "-20% Produktivit√§t" },
                    
                    // Weitere Vanilla Planet-Modifier
                    "metal_planet": { name: "Metall-Planet", description: "Metallischer Planet mit besonderen Ressourcen" },
                    "previously_terraformed_planet": { name: "Zuvor Terraformiert", description: "Planet wurde bereits terraformiert" },
                    "collided_planet": { name: "Kollisions-Planet", description: "Planet mit Kollisions-Merkmalen" },
                    "wooden_planet": { name: "Holz-Planet", description: "Planet mit Holz-Eigenschaften" }
                }
            }
        };

        // Helper function to determine mod requirements and fallback classes
        function getModInfo(planetClass) {
            const gigastructuralPlanets = {
                'pc_birch': { fallback: 'pc_gaia', mod: 'gigastructures' },
                'pc_alderson': { fallback: 'pc_habitat', mod: 'gigastructures' },
                'pc_gas_giant_habitable': { fallback: 'pc_gas_giant', mod: 'gigastructures' },
                'pc_stellar_systemcraft': { fallback: 'pc_habitat', mod: 'gigastructures' },
                'pc_nicoll_dyson_beam': { fallback: 'pc_barren', mod: 'gigastructures' },
                'pc_penrose_sphere_habitable': { fallback: 'pc_habitat', mod: 'gigastructures' },
                'pc_virtual_reality': { fallback: 'pc_machine', mod: 'gigastructures' },
                'pc_pouchkinn_planet': { fallback: 'pc_gaia', mod: 'gigastructures' },
                'pc_gigastructural_shielded': { fallback: 'pc_shielded', mod: 'gigastructures' },
                'pc_quasi_stellar_obliterator': { fallback: 'pc_habitat', mod: 'gigastructures' },
                'pc_neutronium_gigaforge': { fallback: 'pc_habitat', mod: 'gigastructures' }
            };

            const planetaryDiversityPlanets = {
                // PD Enhanced Uninhabitable
                'pc_barren_cold': { fallback: 'pc_barren', mod: 'planetary_diversity' },
                'pc_hothouse': { fallback: 'pc_molten', mod: 'planetary_diversity' },
                'pc_hot_gas_giant': { fallback: 'pc_gas_giant', mod: 'planetary_diversity' },
                'pc_cold_gas_giant': { fallback: 'pc_gas_giant', mod: 'planetary_diversity' },
                'pc_dwarf_gas_giant': { fallback: 'pc_gas_giant', mod: 'planetary_diversity' },
                'pc_storm': { fallback: 'pc_gas_giant', mod: 'planetary_diversity' },
                'pc_shattered': { fallback: 'pc_barren', mod: 'planetary_diversity' },
                'pc_subglacial': { fallback: 'pc_frozen', mod: 'planetary_diversity' },
                
                // PD Uncommon Worlds
                'pc_mantle': { fallback: 'pc_molten', mod: 'planetary_diversity' },
                'pc_karst': { fallback: 'pc_continental', mod: 'planetary_diversity' },
                'pc_crystal': { fallback: 'pc_frozen', mod: 'planetary_diversity' },
                'pc_frozen_desert': { fallback: 'pc_arctic', mod: 'planetary_diversity' },
                'pc_ash': { fallback: 'pc_barren', mod: 'planetary_diversity' },
                'pc_marginal': { fallback: 'pc_barren', mod: 'planetary_diversity' },
                'pc_sandsea': { fallback: 'pc_desert', mod: 'planetary_diversity' },
                'pc_superhabitable': { fallback: 'pc_gaia', mod: 'planetary_diversity' },
                'pc_tidally_locked': { fallback: 'pc_barren', mod: 'planetary_diversity' },
                'pc_technoorganic': { fallback: 'pc_machine', mod: 'planetary_diversity' },

                // PD Gaia Worlds
                'pd_wet_gaia_world': { fallback: 'pc_gaia', mod: 'planetary_diversity' },
                'pd_dry_gaia_world': { fallback: 'pc_gaia', mod: 'planetary_diversity' },
                'pd_cold_gaia_world': { fallback: 'pc_gaia', mod: 'planetary_diversity' },
                
                // PD Cave/Superhabitable/Tidally Locked variants
                'pd_wet_cave_world': { fallback: 'pc_continental', mod: 'planetary_diversity' },
                'pd_dry_cave_world': { fallback: 'pc_desert', mod: 'planetary_diversity' },
                'pd_cold_cave_world': { fallback: 'pc_arctic', mod: 'planetary_diversity' },
                'pd_wet_superhabitable_world': { fallback: 'pc_gaia', mod: 'planetary_diversity' },
                'pd_dry_superhabitable_world': { fallback: 'pc_gaia', mod: 'planetary_diversity' },
                'pd_cold_superhabitable_world': { fallback: 'pc_gaia', mod: 'planetary_diversity' },
                'pd_wet_tidally_locked_world': { fallback: 'pc_continental', mod: 'planetary_diversity' },
                'pd_dry_tidally_locked_world': { fallback: 'pc_desert', mod: 'planetary_diversity' },
                'pd_cold_tidally_locked_world': { fallback: 'pc_arctic', mod: 'planetary_diversity' }
            };

            if (gigastructuralPlanets[planetClass]) {
                return gigastructuralPlanets[planetClass];
            }
            if (planetaryDiversityPlanets[planetClass]) {
                return planetaryDiversityPlanets[planetClass];
            }
            return null;
        }

        // ============================================================
        // [SECTION-03] SYSTEM-VARIATIONEN (ORIGINS) - V9 ERWEITERT
        // ============================================================
        // HIER: Alle System-Templates organisiert in Kategorien
        // NEU IN V9: 45+ Templates statt nur 8 Sol-Varianten
        // √ÑNDERN: Um neue Origins oder Kategorien hinzuzuf√ºgen

        const systemCategories = {
            origins: {
                name: "üìÅ Origins",
                expanded: true,
                subcategories: {
                    sol_variants: {
                        name: "üåç Sol Variants",
                        systems: ["sol", "sol_commonwealth", "sol_void_dwellers", "sol_unplugged", 
                                "sol_toxic", "sol_nuclear", "sol_lost_colony", "sol_pre_ftl", 
                                "sol_fear_of_dark", "sol_ai_controlled", "sol_mindwarden", "sol_geocentric"]
                    },
                    special_origins: {
                        name: "üí´ Special Origins",
                        systems: ["shattered_ring", "shattered_ring_habitable", "ocean_paradise", "life_seeded"]
                    }
                }
            },
            custom_starts: {
                name: "üìÅ Custom Empire Starts",
                expanded: false,
                subcategories: {
                    binary: {
                        name: "‚≠ê‚≠ê Binary Systems",
                        systems: ["binary_simple"]
                    },
                    trinary: {
                        name: "‚≠ê‚≠ê‚≠ê Trinary Systems",
                        systems: ["trinary_close", "trinary_hierarchical"]
                    }
                }
            },
            random_systems: {
                name: "üìÅ Random Systems",
                expanded: false,
                systems: ["random_binary_close", "random_binary_wide", "random_trinary_close", "random_trinary_hierarchical"]
            },
            unique_systems: {
                name: "üìÅ Unique Systems",
                expanded: false,
                subcategories: {
                    triple_planets: {
                        name: "üî∫ Triple Planets",
                        systems: ["tragula_cross", "trins_promise", "loh_system"]
                    },
                    ancient_battlefields: {
                        name: "‚öîÔ∏è Ancient Battlefields",
                        systems: ["fehnrax_stand", "zhanrox_rest", "afari_system"]
                    },
                    guardians: {
                        name: "üêâ Guardians",
                        systems: ["dragons_hoard", "living_planet"]
                    },
                    megastructures: {
                        name: "üèóÔ∏è Megastructures",
                        systems: ["ruined_dyson", "science_nexus", "mega_shipyard", "quantum_catapult", "orbital_ring"]
                    },
                    first_contact: {
                        name: "üëΩ First Contact",
                        systems: ["solarpunk_helito"]
                    }
                }
            },
            fallen_empires: {
                name: "üìÅ Fallen Empires",
                expanded: false,
                systems: ["fe_spiritualist_ringworld", "fe_machine_ringworld"]
            },
            marauders: {
                name: "üìÅ Marauders",
                expanded: false,
                systems: ["marauder_capital_1", "marauder_capital_2", "marauder_capital_3"]
            },
            hostile_systems: {
                name: "üìÅ Hostile Systems",
                expanded: false,
                systems: ["mining_drones", "space_amoeba", "crystalline_entities"]
            }
        };

        // Erweiterte System-Definitionen mit allen Templates
        const systemVariations = {
                        
            // ====================================================
            // BLANK CANVAS TEMPLATES - System-Type Selection
            // ====================================================
            
            blank_single: {
                name: "Blank Single Star System",
                enabled: true,
                displayName: "Leeres Einzelstern-System",
                icon: '‚≠ê',
                category: "blank_templates",
                description: "Leeres Single-Star System - Name frei w√§hlbar",
                dlc_requirements: [],
                isBlankTemplate: true,
                allowCustomNaming: true,
                flags: ["empire_home_system"],
                star: {
                    class: "sc_g",
                    size: 25,
                    orbit_distance: 0,
                    orbit_angle: 0,
                    has_ring: false,
                    flags: []
                },
                planets: []  // Nutzer f√ºgt Planeten hinzu
            },
            
            blank_binary_close: {
                name: "Blank Binary System (Close)",
                enabled: false,
                displayName: "Leeres Bin√§rsystem (Eng)",
                icon: '‚≠ê‚≠ê',
                category: "blank_templates",
                description: "Zwei eng umkreisende Sterne - Planeten umkreisen beide",
                dlc_requirements: [],
                isBlankTemplate: true,
                allowCustomNaming: true,
                flags: ["empire_home_system", "binary_system"],
                star_count: 2,
                class: "rl_binary_stars",
                stars: [
                    {
                        class: "sc_g",
                        size: 32,
                        orbit_distance: 25,
                        orbit_angle: 0,
                        has_ring: false,
                        flags: ["primary_star"]
                    },
                    {
                        class: "sc_m",
                        size: 20,
                        orbit_distance: 0,
                        orbit_angle: 180,
                        has_ring: false,
                        flags: ["secondary_star"]
                    }
                ],
                planets: [],
                orbit_config: {
                    mode: "circumbinary",
                    description: "Planeten umkreisen beide Sterne gemeinsam"
                }
            },
            
            blank_binary_wide: {
                name: "Blank Binary System (Wide)",
                enabled: false,
                displayName: "Leeres Bin√§rsystem (Weit)",
                icon: '‚≠ê  ‚≠ê',
                category: "blank_templates",
                description: "Weit getrennte Sterne - jeder hat eigene Planeten",
                dlc_requirements: [],
                isBlankTemplate: true,
                allowCustomNaming: true,
                flags: ["empire_home_system", "binary_system", "wide_binary"],
                star_count: 2,
                class: "rl_binary_stars",
                stars: [
                    {
                        class: "sc_g",
                        size: 30,
                        orbit_distance: 0,
                        orbit_angle: 0,
                        has_ring: false,
                        flags: ["primary_star"]
                    },
                    {
                        class: "sc_k",
                        size: 25,
                        orbit_distance: 240,
                        orbit_angle: 180,
                        has_ring: false,
                        flags: ["secondary_star"],
                        satellite_naming_policy: "upper_case_roman_numerals"
                    }
                ],
                planets: [],
                orbit_config: {
                    mode: "satellite",
                    description: "Planeten umkreisen einzelne Sterne"
                }
            },
            
            blank_trinary: {
                name: "Blank Trinary System",
                enabled: false,
                displayName: "Leeres Trin√§rsystem",
                icon: '‚≠ê‚≠ê‚≠ê',
                category: "blank_templates",
                description: "Drei Sterne in Formation - Planeten umkreisen alle",
                dlc_requirements: [],
                isBlankTemplate: true,
                allowCustomNaming: true,
                flags: ["empire_home_system", "trinary_system"],
                star_count: 3,
                class: "rl_trinary_stars",
                stars: [
                    {
                        class: "sc_g",
                        size: 30,
                        orbit_distance: 0,
                        orbit_angle: 0,
                        has_ring: false,
                        flags: ["primary_star"]
                    },
                    {
                        class: "sc_k",
                        size: 26,
                        orbit_distance: 20,
                        orbit_angle: 120,
                        has_ring: false,
                        flags: ["secondary_star"]
                    },
                    {
                        class: "sc_m",
                        size: 22,
                        orbit_distance: 20,
                        orbit_angle: 240,
                        has_ring: false,
                        flags: ["tertiary_star"]
                    }
                ],
                planets: [],
                orbit_config: {
                    mode: "circumbinary",
                    description: "Planeten umkreisen alle drei Sterne"
                }
            },
            
            // ========== SPECIAL ORIGINS ==========
            // ====================================================
            // SPECIAL PRE-CONFIGURED SYSTEMS
            // Diese Systeme sind komplett vorkonfiguriert
            // ====================================================
            
            shattered_ring: {
                name: "Shattered Ring Origin",
                enabled: false,
                displayName: "Shattered Ring",
                icon: 'üíç',
                category: "special_origins",
                description: "Zerbrochene Ringwelt - komplett vorkonfiguriert",
                dlc_requirements: ["Federations"],
                isSpecialSystem: true,
                allowCustomNaming: true,
                flags: ["empire_home_system", "shattered_ring_system"],
                star: {
                    class: "sc_g",
                    name: "Relic",
                    size: 25,
                    orbit_distance: 0,
                    orbit_angle: 0,
                    has_ring: false,
                    flags: ["shattered_ring_star"]
                },
                planets: [
                    {
                        class: "pc_shattered_ring_habitable",
                        name: "Segment I",
                        size: 25,
                        orbit_distance: 0,
                        orbit_angle: 0,
                        starting_planet: true,
                        has_ring: false,
                        flags: ["shattered_ring_habitable_segment", "colony_event", "ring_world_built"]
                    },
                    {
                        class: "pc_shattered_2",
                        name: "Segment II",
                        size: 25,
                        orbit_distance: 0,
                        orbit_angle: 120,
                        has_ring: false,
                        flags: ["ring_world_built"]
                    },
                    {
                        class: "pc_shattered",
                        name: "Segment III",
                        size: 25,
                        orbit_distance: 0,
                        orbit_angle: 240,
                        has_ring: false,
                        flags: ["ring_world_built"]
                    }
                ]
            },
            
            ocean_paradise: {
                name: "Ocean Paradise Origin",
                enabled: false,
                displayName: "Ocean Paradise",
                icon: 'üåä',
                category: "special_origins",
                description: "Perfekte Ozeanwelt mit Nebel - komplett vorkonfiguriert",
                dlc_requirements: ["Aquatics"],
                isSpecialSystem: true,
                allowCustomNaming: true,
                flags: ["empire_home_system", "ocean_paradise_nebula"],
                star: {
                    class: "sc_a",
                    name: "Paradise",
                    size: 28,
                    orbit_distance: 0,
                    orbit_angle: 0,
                    has_ring: false,
                    flags: []
                },
                asteroid_belts: [
                    {
                        type: "icy_asteroid_belt",
                        radius: 115
                    }
                ],
                planets: [
                    {
                        class: "pc_ocean",
                        name: "Paradise Prime",
                        size: 30,
                        orbit_distance: 60,
                        orbit_angle: -45,
                        has_ring: false,
                        starting_planet: true,
                        entity: "ocean_paradise_planet_01_entity",
                        modifiers: [],
                        flags: ["ignore_startup_effect"]
                    },
                    {
                        class: "pc_frozen",
                        name: "Frozen World",
                        size: 9,
                        orbit_distance: 25,
                        orbit_angle: -17,
                        has_ring: false,
                        flags: []
                    }
                ],
                init_effect_template: "ocean_paradise_nebula_creation"
            },
            
            // ========== UNIQUE SYSTEMS ==========
            tragula_cross: {
                name: "Tragula's Cross",
                enabled: false,
                displayName: "Tragula's Cross",
                icon: '‚≠ê',
                category: "unique_systems",
                subcategory: "triple_planets",
                description: "Drei Planeten in perfekter Formation",
                dlc_requirements: [],
                max_instances: 1,
                star: {
                    class: "sc_m",
                    name: "Tragula"
                },
                planets: [
                    {
                        class: "pc_arid",
                        name: "Keth",
                        size: 16,
                        orbit_distance: 40,
                        orbit_angle: 0
                    },
                    {
                        class: "pc_arid",
                        name: "Makon",
                        size: 16,
                        orbit_distance: 40,
                        orbit_angle: 120
                    },
                    {
                        class: "pc_arid",
                        name: "Tiyana",
                        size: 16,
                        orbit_distance: 40,
                        orbit_angle: 240
                    }
                ]
            },
            
            dragons_hoard: {
                name: "Dragon's Hoard",
                enabled: false,
                displayName: "Dragon's Hoard",
                icon: 'üêâ',
                category: "unique_systems",
                subcategory: "guardians",
                description: "System bewacht von √Ñtherem Drachen",
                dlc_requirements: ["Leviathans"],
                max_instances: 1,
                star: {
                    class: "sc_black_hole",
                    name: "Shard's Domain",
                    flags: ["hostile_system", "dragon_hoard"]
                },
                planets: [
                    {
                        class: "pc_gaia",
                        name: "Dragon's Nest",
                        size: 25,
                        orbit_distance: 40,
                        orbit_angle: 0,
                        flags: ["dragon_egg"]
                    }
                ],
                init_effect: `
                    create_fleet = {
                        effect = {
                            set_owner = last_created_country
                            create_ship = {
                                name = "Shard"
                                design = "Ether Drake"
                            }
                            set_location = {
                                target = solar_system
                                angle = random
                                distance = 45
                            }
                        }
                    }
                `
            },
            
            // ========== MEGASTRUCTURES ==========
            ruined_dyson: {
                name: "Ruined Dyson Sphere",
                enabled: false,
                displayName: "Ruined Dyson Sphere",
                icon: '‚ö°',
                category: "unique_systems",
                subcategory: "megastructures",
                description: "Zerst√∂rte Dyson-Sph√§re",
                dlc_requirements: ["Utopia"],
                max_instances: 3,
                star: {
                    class: "sc_b",
                    name: "Stellar Forge",
                    flags: ["dyson_sphere_built"]
                },
                init_effect: `
                    spawn_megastructure = {
                        type = "dyson_sphere_ruined"
                        orbit_angle = random
                        orbit_distance = 0
                    }
                `
            },

            // ... weitere 30+ System-Definitionen hier
        };
            
            // ============================================================
            // [SECTION-03B] ORIGIN MECHANICS SYSTEM
            // ============================================================
            // HIER: Origin-Mechaniken die auf JEDES System anwendbar sind
            // Diese Mechaniken √§ndern das System, behalten aber den Namen bei
            
            const originMechanics = {
                void_dwellers: {
                    id: "void_dwellers",
                    name: "Void Dwellers Origin",
                    displayName: "Void Dwellers",
                    icon: 'üõ∏',
                    description: "Keine bewohnbaren Planeten - 3 Habitate stattdessen",
                    dlc_requirements: ["Federations"],
                    system_flags: ["void_dwellers_system"],
                    modifications: {
                        convert_habitable_planets: "pc_toxic",
                        add_habitats: [
                            {
                                name: "Habitat Alpha",
                                orbit_distance: 150,
                                orbit_angle: 45,
                                size: 4,
                                flags: ["void_dweller_habitat_1", "megastructure", "habitat", "special_start_planet"]
                            },
                            {
                                name: "Habitat Beta",
                                orbit_distance: 228,
                                orbit_angle: 120,
                                size: 4,
                                flags: ["void_dweller_habitat_2", "megastructure", "habitat"]
                            },
                            {
                                name: "Habitat Gamma",
                                orbit_distance: 350,
                                orbit_angle: 270,
                                size: 4,
                                flags: ["void_dweller_habitat_3", "megastructure", "habitat"]
                            }
                        ]
                    }
                },
                
                life_seeded: {
                    id: "life_seeded",
                    name: "Life Seeded Origin",
                    displayName: "Life Seeded",
                    icon: 'üå±',
                    description: "Heimatwelt wird Gaia - alle anderen unbewohnbar",
                    dlc_requirements: ["Utopia"],
                    system_flags: ["life_seeded_system"],
                    modifications: {
                        homeworld: {
                            class: "pc_gaia",
                            size: 25,
                            flags: ["life_seeded_gaia", "ideal_planet_class"]
                        },
                        other_planets: {
                            convert_to: "pc_barren"
                        }
                    }
                },
                
                remnants: {
                    id: "remnants",
                    name: "Remnants Origin",
                    displayName: "Remnants",
                    icon: 'üèõÔ∏è',
                    description: "Heimatwelt wird Relic World mit Ruinen",
                    dlc_requirements: ["Ancient Relics"],
                    system_flags: ["remnants_system"],
                    modifications: {
                        homeworld: {
                            class: "pc_relic",
                            size: 25,
                            flags: ["remnants_planet", "relic_world", "precursor_world"],
                            deposits: ["d_relic_metal_boneyard_1", "d_relic_dense_ruins_1"],
                            blockers: ["d_relic_toxic_valley_1"]
                        }
                    }
                },
                
                post_apocalyptic: {
                    id: "post_apocalyptic",
                    name: "Post-Apocalyptic Origin",
                    displayName: "Post-Apocalyptic",
                    icon: '‚ò¢Ô∏è',
                    description: "Heimatwelt wird verstrahlt (Nuked)",
                    dlc_requirements: ["Apocalypse"],
                    system_flags: ["post_apocalyptic_system"],
                    modifications: {
                        homeworld: {
                            class: "pc_nuked",
                            size: 18,
                            flags: ["post_apocalyptic_planet", "nuked_world"],
                            blockers: ["d_radioactive_wasteland", "d_bomb_crater"]
                        }
                    }
                },
                
                toxic_knights: {
                    id: "toxic_knights",
                    name: "Toxic Knights Origin",
                    displayName: "Toxic Knights",
                    icon: '‚ò¢Ô∏è',
                    description: "Heimatwelt wird toxisch",
                    dlc_requirements: ["Toxoids"],
                    system_flags: ["toxic_knights_system"],
                    modifications: {
                        homeworld: {
                            class: "pc_toxic",
                            size: 18,
                            flags: ["toxic_knights_planet"]
                        }
                    }
                },
                
                mechanist: {
                    id: "mechanist",
                    name: "Mechanist Origin",
                    displayName: "Mechanist",
                    icon: '‚öôÔ∏è',
                    description: "Start mit Robot-Integration",
                    dlc_requirements: ["Utopia"],
                    system_flags: ["mechanist_system"],
                    modifications: {
                        homeworld: {
                            flags: ["mechanist_planet"],
                            modifiers: ["mechanist_trait"]
                        }
                    }
                },
                
                lost_colony: {
                    id: "lost_colony",
                    name: "Lost Colony Origin",
                    displayName: "Lost Colony",
                    icon: 'üåç',
                    description: "Erstellt NPC-Empire in Nachbarsystem",
                    dlc_requirements: [],
                    system_flags: ["lost_colony_home_system"],
                    modifications: {
                        homeworld: {
                            flags: ["lost_colony_homeworld"]
                        },
                        neighbor_systems: [
                            {
                                initializer: "lost_colony_1",
                                hyperlane_jumps: { min: 1, max: 3 }
                            }
                        ]
                    }
                },
                
                resource_consolidation: {
                    id: "resource_consolidation",
                    name: "Resource Consolidation Origin",
                    displayName: "Resource Consolidation",
                    icon: 'üíé',
                    description: "Heimatwelt mit massiven Ressourcen",
                    dlc_requirements: [],
                    system_flags: ["resource_consolidation_system"],
                    modifications: {
                        homeworld: {
                            flags: ["resource_consolidation_planet"],
                            deposits: ["d_minerals_10", "d_energy_10", "d_alloys_5"]
                        }
                    }
                },
                
                fear_of_the_dark: {
                    id: "fear_of_the_dark",
                    name: "Fear of the Dark Origin",
                    displayName: "Fear of the Dark",
                    icon: 'üåë',
                    description: "Spezielle Fear of the Dark Mechaniken",
                    dlc_requirements: ["First Contact"],
                    system_flags: ["fear_of_dark_system"],
                    modifications: {
                        special_init: "fear_of_the_dark_init"
                    }
                },
                
                mindwarden: {
                    id: "mindwarden",
                    name: "Mindwarden Origin",
                    displayName: "Mindwarden",
                    icon: 'üß†',
                    description: "Mindwarden Origin Mechaniken",
                    dlc_requirements: ["The Machine Age"],
                    system_flags: ["mindwarden_system"],
                    modifications: {
                        special_init: "mindwarden_init"
                    }
                },
                
                unplugged: {
                    id: "unplugged",
                    name: "Unplugged Origin",
                    displayName: "Unplugged",
                    icon: 'üîå',
                    description: "Machine Legacy - Unplugged Origin",
                    dlc_requirements: ["The Machine Age"],
                    system_flags: ["unplugged_system"],
                    modifications: {
                        special_init: "origin_unplugged_init",
                        neighbor_systems: [
                            {
                                initializer: "origin_unplugged_machine_legacy_periphery_system_init"
                            }
                        ]
                    }
                }
            };
            
            // Hilfsfunktion: Origin auf System anwenden
            function applyOriginToSystem(systemData, originId) {
                if (!originId || !originMechanics[originId]) {
                    return systemData;
                }
                
                const origin = originMechanics[originId];
                const modifiedSystem = JSON.parse(JSON.stringify(systemData)); // Deep copy
                
                // System-Flags hinzuf√ºgen
                if (origin.system_flags) {
                    modifiedSystem.flags = [...(modifiedSystem.flags || []), ...origin.system_flags];
                }
                
                // Modifikationen anwenden
                if (origin.modifications) {
                    modifiedSystem.originModifications = origin.modifications;
                }
                
                return modifiedSystem;
            };

            // ============================================================
        // [SECTION-03C] ORIGIN MECHANICS UI V2 - MULTI-SELECTION
        // ============================================================
        
        // Global: Track which origins are enabled (similar to systemVariations)
        let enabledOrigins = {};  // { origin_id: true/false }
        
        // Add enabled property to each origin
        Object.keys(originMechanics).forEach(key => {
            originMechanics[key].enabled = false;  // Default: disabled
        });
        
        // Initialize Origin Mechanics UI V2
        function initializeOriginMechanicsUI() {
            renderOriginCardsList();
            initializeOriginFilters();
            updateOriginVariantCount();
            
            // Event listeners for quick actions
            document.getElementById('selectAllOriginsBtn')?.addEventListener('click', () => {
                Object.keys(originMechanics).forEach(key => {
                    originMechanics[key].enabled = true;
                });
                renderOriginCardsList();
                updateOriginVariantCount();
                updateOutput();
            });
            
            document.getElementById('deselectAllOriginsBtn')?.addEventListener('click', () => {
                Object.keys(originMechanics).forEach(key => {
                    originMechanics[key].enabled = false;
                });
                renderOriginCardsList();
                updateOriginVariantCount();
                updateOutput();
            });
            
            document.getElementById('previewOriginVariantsBtn')?.addEventListener('click', showOriginVariantsPreview);
        }
        
        // Render origin cards grid
        function renderOriginCardsList() {
            const container = document.getElementById('originCardsList');
            if (!container) return;
            
            container.innerHTML = '';
            
            // Apply filters
            const categoryFilter = document.getElementById('originCategoryFilter')?.value || 'all';
            const selectedDlcs = Array.from(document.querySelectorAll('#originDlcFilters input:checked'))
                .map(cb => cb.value);
            
            // Filter origins
            const filteredOrigins = Object.entries(originMechanics).filter(([key, origin]) => {
                // Category filter
                if (categoryFilter !== 'all') {
                    const category = getOriginCategory(key);
                    if (category !== categoryFilter) return false;
                }
                
                // DLC filter
                if (selectedDlcs.length > 0) {
                    if (!origin.dlc_requirements || origin.dlc_requirements.length === 0) return false;
                    const hasDlc = origin.dlc_requirements.some(dlc => selectedDlcs.includes(dlc));
                    if (!hasDlc) return false;
                }
                
                return true;
            });
            
            // Create cards
            filteredOrigins.forEach(([key, origin]) => {
                const card = createOriginCard(key, origin);
                container.appendChild(card);
            });
            
            if (filteredOrigins.length === 0) {
                container.innerHTML = '<p class="text-gray-400 text-center col-span-3 py-8">Keine Origins gefunden mit den aktuellen Filtern</p>';
            }
        }
        
        // Create origin card (similar to system variation card)
        function createOriginCard(originId, origin) {
            const card = document.createElement('div');
            card.className = `relative p-4 rounded-lg border transition-all duration-200 cursor-pointer ${
                origin.enabled 
                    ? 'bg-gradient-to-br from-green-900/40 to-blue-900/40 border-green-500 ring-2 ring-green-500/50' 
                    : 'bg-gradient-to-br from-gray-800/40 to-gray-900/40 border-gray-700 hover:border-blue-500/50'
            }`;
            
            card.innerHTML = `
                <div class="flex items-start gap-3">
                    <!-- Checkbox -->
                    <input type="checkbox" 
                           class="mt-1 w-5 h-5 rounded border-gray-600 text-blue-600 focus:ring-blue-500 focus:ring-offset-gray-900 cursor-pointer"
                           ${origin.enabled ? 'checked' : ''}
                           onchange="toggleOrigin('${originId}')">
                    
                    <!-- Content -->
                    <div class="flex-1">
                        <div class="flex items-start gap-2 mb-2">
                            <span class="text-3xl">${origin.icon}</span>
                            <div class="flex-1">
                                <h3 class="font-semibold text-lg ${origin.enabled ? 'text-green-300' : 'text-gray-200'}">
                                    ${origin.displayName}
                                </h3>
                                <p class="text-xs text-gray-400 mt-1">${origin.description}</p>
                            </div>
                        </div>
                        
                        <!-- DLC Requirements -->
                        ${origin.dlc_requirements && origin.dlc_requirements.length > 0 ? `
                            <div class="flex flex-wrap gap-1 mt-2">
                                ${origin.dlc_requirements.map(dlc => 
                                    `<span class="text-xs px-2 py-0.5 bg-orange-900/50 text-orange-300 rounded border border-orange-700">
                                        ${dlc}
                                    </span>`
                                ).join('')}
                            </div>
                        ` : ''}
                        
                        <!-- Modifications Preview -->
                        <details class="mt-3">
                            <summary class="text-xs text-blue-400 cursor-pointer hover:text-blue-300">
                                üîß System√§nderungen anzeigen
                            </summary>
                            <ul class="text-xs text-gray-300 mt-2 space-y-1 pl-4">
                                ${getModificationsPreviewHTML(origin.modifications)}
                            </ul>
                        </details>
                    </div>
                </div>
                
                ${origin.enabled ? `
                    <div class="absolute top-2 right-2 bg-green-600 text-white text-xs px-2 py-1 rounded">
                        ‚úì Aktiv
                    </div>
                ` : ''}
            `;
            
            // Click on card toggles checkbox
            card.addEventListener('click', (e) => {
                if (e.target.tagName !== 'INPUT' && e.target.tagName !== 'SUMMARY') {
                    const checkbox = card.querySelector('input[type="checkbox"]');
                    checkbox.checked = !checkbox.checked;
                    toggleOrigin(originId);
                }
            });
            
            return card;
        }
        
        // Toggle origin enabled state
        function toggleOrigin(originId) {
            if (originMechanics[originId]) {
                originMechanics[originId].enabled = !originMechanics[originId].enabled;
                renderOriginCardsList();
                updateOriginVariantCount();
                updateOutput();
            }
        }
        
        // Get origin category for filtering
        function getOriginCategory(originId) {
            const categories = {
                void_dwellers: 'habitat_space',
                life_seeded: 'planet_mods',
                remnants: 'planet_mods',
                post_apocalyptic: 'planet_mods',
                toxic_knights: 'planet_mods',
                mechanist: 'civ_mods',
                resource_consolidation: 'civ_mods',
                lost_colony: 'story_special',
                fear_of_the_dark: 'story_special',
                mindwarden: 'story_special',
                unplugged: 'story_special'
            };
            return categories[originId] || 'other';
        }
        
        // Initialize origin filters
        function initializeOriginFilters() {
            // Get all unique DLCs from origins
            const allDlcs = new Set();
            Object.values(originMechanics).forEach(origin => {
                if (origin.dlc_requirements) {
                    origin.dlc_requirements.forEach(dlc => allDlcs.add(dlc));
                }
            });
            
            // Render DLC checkboxes
            const dlcContainer = document.getElementById('originDlcFilters');
            if (dlcContainer) {
                dlcContainer.innerHTML = Array.from(allDlcs).sort().map(dlc => `
                    <label class="flex items-center gap-2 text-sm cursor-pointer">
                        <input type="checkbox" value="${dlc}" class="origin-dlc-filter">
                        <span>${dlc}</span>
                    </label>
                `).join('');
                
                // Add event listeners
                dlcContainer.querySelectorAll('input').forEach(cb => {
                    cb.addEventListener('change', renderOriginCardsList);
                });
            }
            
            // Category filter
            document.getElementById('originCategoryFilter')?.addEventListener('change', renderOriginCardsList);
            
            // Reset filters
            document.getElementById('resetOriginFiltersBtn')?.addEventListener('click', () => {
                document.querySelectorAll('#originDlcFilters input').forEach(cb => cb.checked = false);
                document.getElementById('originCategoryFilter').value = 'all';
                renderOriginCardsList();
            });
        }
        
        // Update origin variant count
        function updateOriginVariantCount() {
            const count = Object.values(originMechanics).filter(o => o.enabled).length;
            const countEl = document.getElementById('originVariantCount');
            if (countEl) {
                countEl.textContent = count;
            }
        }
        
        // Get modifications preview HTML
        function getModificationsPreviewHTML(modifications) {
            if (!modifications) return '<li>Keine Modifikationen</li>';
            
            let preview = [];
            
            if (modifications.convert_habitable_planets) {
                preview.push(`<li>‚Ä¢ Bewohnbare Planeten ‚Üí <code>${modifications.convert_habitable_planets}</code></li>`);
            }
            
            if (modifications.add_habitats) {
                preview.push(`<li>‚Ä¢ ${modifications.add_habitats.length} Habitate hinzugef√ºgt</li>`);
            }
            
            if (modifications.homeworld) {
                const hw = modifications.homeworld;
                if (hw.class) {
                    preview.push(`<li>‚Ä¢ Heimatwelt ‚Üí <code>${hw.class}</code></li>`);
                }
                if (hw.deposits) {
                    preview.push(`<li>‚Ä¢ Spezielle Deposits hinzugef√ºgt</li>`);
                }
            }
            
            if (modifications.other_planets?.convert_to) {
                preview.push(`<li>‚Ä¢ Andere Planeten ‚Üí <code>${modifications.other_planets.convert_to}</code></li>`);
            }
            
            if (modifications.neighbor_systems) {
                preview.push(`<li>‚Ä¢ ${modifications.neighbor_systems.length} Nachbarsystem(e) erstellt</li>`);
            }
            
            if (modifications.special_init) {
                preview.push(`<li>‚Ä¢ Init-Effekt: <code>${modifications.special_init}</code></li>`);
            }
            
            return preview.length > 0 ? preview.join('') : '<li>Standard Origin-Effekte</li>';
        }
        
        // Show preview of all origin variants
        function showOriginVariantsPreview() {
            const enabledOrigins = Object.entries(originMechanics)
                .filter(([_, origin]) => origin.enabled)
                .map(([id, origin]) => ({ id, ...origin }));
            
            if (enabledOrigins.length === 0) {
                alert('Keine Origins ausgew√§hlt!');
                return;
            }
            
            const systemName = solarSystem.name.toLowerCase().replace(/\s+/g, '_');
            
            let preview = `=== ORIGIN-VARIANTEN VORSCHAU ===\n\n`;
            preview += `Basis-System: ${solarSystem.name}\n`;
            preview += `Anzahl Origins: ${enabledOrigins.length}\n\n`;
            preview += `Generierte Initializers:\n\n`;
            
            enabledOrigins.forEach(origin => {
                preview += `üìÑ ${systemName}_${origin.id}\n`;
                preview += `   Origin: ${origin.displayName}\n`;
                preview += `   DLCs: ${origin.dlc_requirements?.join(', ') || 'Keine'}\n\n`;
            });
            
            alert(preview);
        }
        
        // Make toggle function global
        window.toggleOrigin = toggleOrigin;
        
        // ============================================================
        // [SECTION-04] DOM ELEMENT REFERENZEN
        // ============================================================
        // HIER: Alle HTML-Element-Verkn√ºpfungen
        // √ÑNDERN: Wenn du neue Input-Felder im HTML hinzuf√ºgst
        // WICHTIG: ID im HTML muss mit getElementById √ºbereinstimmen

        // DOM Elements
        const elements = {
            // Import elements
            importFile: document.getElementById('importFile'),
            importBtn: document.getElementById('importBtn'),
            clearSystemBtn: document.getElementById('clearSystemBtn'),

            // Neighbor systems elements
            neighborSystemsList: document.getElementById('neighborSystemsList'),
            // ‚úÖ KORRIGIERT: Neue Felder f√ºr hyperlane_jumps
            neighborHyperlaneMin: document.getElementById('neighborHyperlaneMin'),
            neighborHyperlaneMax: document.getElementById('neighborHyperlaneMax'),
            addNeighborBtn: document.getElementById('addNeighborBtn'),
            neighborTrigger: document.getElementById('neighborTrigger'),
            neighborMode: document.getElementById('neighborMode'),
            newNeighborReference: document.getElementById('newNeighborReference'),

            // Asteroid belt elements - HINZUF√úGEN
            asteroidBeltList: document.getElementById('asteroidBeltList'),
            newAsteroidBeltType: document.getElementById('newAsteroidBeltType'),
            newAsteroidBeltRadius: document.getElementById('newAsteroidBeltRadius'),
            addAsteroidBeltBtn: document.getElementById('addAsteroidBeltBtn'),
            
            // System elements
            systemName: document.getElementById('systemName'),
            systemDisplayName: document.getElementById('systemDisplayName'),
            systemClass: document.getElementById('systemClass'),
            systemUsage: document.getElementById('systemUsage'),
            
            // Planet management
            addPlanetBtn: document.getElementById('addPlanetBtn'),
            moveUpBtn: document.getElementById('moveUpBtn'),
            moveDownBtn: document.getElementById('moveDownBtn'),
            planetList: document.getElementById('planetList'),
            
            // Planet details
            celestialDetails: document.getElementById('celestialDetails'),
            noCelestialSelected: document.getElementById('noCelestialSelected'),
            celestialType: document.getElementById('celestialType'),
            celestialPosition: document.getElementById('celestialPosition'),
            celestialName: document.getElementById('celestialName'),
            celestialDisplayName: document.getElementById('celestialDisplayName'),
            celestialClass: document.getElementById('celestialClass'),
            celestialSize: document.getElementById('celestialSize'),
            celestialOrbitDistance: document.getElementById('celestialOrbitDistance'),
            orbitAngleType: document.getElementById('orbitAngleType'),
            celestialOrbitAngle: document.getElementById('celestialOrbitAngle'),
            celestialOrbitAngleMin: document.getElementById('celestialOrbitAngleMin'),
            celestialOrbitAngleMax: document.getElementById('celestialOrbitAngleMax'),
            celestialChangeOrbit: document.getElementById('celestialChangeOrbit'),
            celestialHasRing: document.getElementById('celestialHasRing'),
            celestialIsStartingPlanet: document.getElementById('celestialIsStartingPlanet'),
            addMoonBtn: document.getElementById('addMoonBtn'),
            deleteCelestialBtn: document.getElementById('deleteCelestialBtn'),
            fixedAngleControl: document.getElementById('fixedAngleControl'),
            rangeAngleControl: document.getElementById('rangeAngleControl'),
            
            // Modifier system
            modifierList: document.getElementById('modifierList'),
            modifierCategory: document.getElementById('modifierCategory'),
            modifierType: document.getElementById('modifierType'),
            addModifierBtn: document.getElementById('addModifierBtn'),
            
            // Visualizer
            visualizer: document.getElementById('visualizer'),
            zoomInBtn: document.getElementById('zoomInBtn'),
            zoomOutBtn: document.getElementById('zoomOutBtn'),
            resetViewBtn: document.getElementById('resetViewBtn'),
            
            // Export
            exportTxt: document.getElementById('exportTxt'),
            exportYml: document.getElementById('exportYml'),
            downloadTxtBtn: document.getElementById('downloadTxtBtn'),
            downloadYmlBtn: document.getElementById('downloadYmlBtn')
        };

        // ============================================================
        // [SECTION-05] MODIFIER SYSTEM FUNKTIONEN
        // ============================================================
        // HIER: Logik f√ºr Planet-Modifier (Planetary Diversity, etc.)
        // √ÑNDERN: Um Modifier-Verhalten anzupassen
        // WICHTIG: Achte auf Kompatibilit√§t mit Planetenklassen

        // Modifier System Functions
        function initializeModifierSystem() {
            elements.modifierCategory.addEventListener('change', updateModifierTypes);
            elements.modifierType.addEventListener('change', enableAddModifierButton);
            elements.addModifierBtn.addEventListener('click', addModifierToPlanet);
        }

        function updateModifierTypes() {
            const category = elements.modifierCategory.value;
            const modifierSelect = elements.modifierType;
            
            // Clear existing options
            modifierSelect.innerHTML = '<option value="">-- Modifier w√§hlen --</option>';
            
            if (category && MODIFIERS[category]) {
                modifierSelect.disabled = false;
                
                if (category === 'planetary_diversity') {
                    // For PD, only show modifiers compatible with selected planet class
                    const selectedClass = selectedPlanet ? selectedPlanet.class : null;
                    
                    if (selectedClass && MODIFIERS[category].modifiers[selectedClass]) {
                        Object.entries(MODIFIERS[category].modifiers[selectedClass]).forEach(([key, modifier]) => {
                            const option = document.createElement('option');
                            option.value = key;
                            option.textContent = modifier.name;
                            option.title = modifier.description;
                            modifierSelect.appendChild(option);
                        });
                    } else if (selectedClass) {
                        // Show message if no PD modifiers available for this class
                        const option = document.createElement('option');
                        option.value = '';
                        option.textContent = `Keine PD-Modifier f√ºr ${getClassDisplayName(selectedClass)} verf√ºgbar`;
                        option.disabled = true;
                        modifierSelect.appendChild(option);
                    } else {
                        const option = document.createElement('option');
                        option.value = '';
                        option.textContent = 'Erst Planeten ausw√§hlen';
                        option.disabled = true;
                        modifierSelect.appendChild(option);
                    }
                } else {
                    // For other categories, show all modifiers
                    Object.entries(MODIFIERS[category].modifiers).forEach(([key, modifier]) => {
                        const option = document.createElement('option');
                        option.value = key;
                        option.textContent = modifier.name;
                        option.title = modifier.description;
                        modifierSelect.appendChild(option);
                    });
                }
            } else {
                modifierSelect.disabled = true;
            }
            
            elements.addModifierBtn.disabled = true;
        }

        function enableAddModifierButton() {
            elements.addModifierBtn.disabled = !elements.modifierType.value;
        }

        function addModifierToPlanet() {
            if (!selectedPlanet || !elements.modifierType.value) return;

            const modifierKey = elements.modifierType.value;
            const category = elements.modifierCategory.value;
            
            let modifierInfo;
            if (category === 'planetary_diversity' && selectedPlanet.class) {
                modifierInfo = MODIFIERS[category].modifiers[selectedPlanet.class][modifierKey];
            } else {
                modifierInfo = MODIFIERS[category].modifiers[modifierKey];
            }

            if (!modifierInfo) {
                showNotification('Fehler: Modifier-Information nicht gefunden!');
                return;
            }

            // Check if modifier already exists
            if (!selectedPlanet.modifiers) {
                selectedPlanet.modifiers = [];
            }

            if (selectedPlanet.modifiers.some(m => m.key === modifierKey)) {
                showNotification('Dieser Modifier ist bereits hinzugef√ºgt!');
                return;
            }

            selectedPlanet.modifiers.push({
                key: modifierKey,
                name: modifierInfo.name,
                description: modifierInfo.description,
                category: category,
                baseClass: category === 'planetary_diversity' ? selectedPlanet.class : null
            });

            updateModifierList();
            updatePlanetList();
            updateOutput();
            renderVisualizer();
            
            // Reset selection
            elements.modifierCategory.value = '';
            elements.modifierType.innerHTML = '<option value="">-- Erst Kategorie w√§hlen --</option>';
            elements.modifierType.disabled = true;
            elements.addModifierBtn.disabled = true;
            
            showNotification(`Modifier "${modifierInfo.name}" hinzugef√ºgt!`);
        }

        function updateModifierList() {
            if (!selectedPlanet || !selectedPlanet.modifiers || selectedPlanet.modifiers.length === 0) {
                elements.modifierList.innerHTML = '<p class="text-gray-400 text-sm">Keine Modifier ausgew√§hlt</p>';
                return;
            }

            elements.modifierList.innerHTML = '';
            selectedPlanet.modifiers.forEach((modifier, index) => {
                const modifierItem = document.createElement('div');
                modifierItem.className = 'modifier-item';
                modifierItem.innerHTML = `
                    <div>
                        <span class="font-medium text-green-300">${modifier.name}</span>
                        <p class="text-xs text-gray-400">${modifier.description}</p>
                    </div>
                    <button class="stellaris-btn stellaris-btn-danger text-xs px-2 py-1" onclick="removeModifier(${index})">
                        Entfernen
                    </button>
                `;
                elements.modifierList.appendChild(modifierItem);
            });
        }

        function removeModifier(index) {
            if (selectedPlanet && selectedPlanet.modifiers) {
                selectedPlanet.modifiers.splice(index, 1);
                updateModifierList();
                updateOutput();
            }
        }

        // ============================================================
        // [SECTION-06] FLAG MANAGEMENT (SYSTEM & PLANETEN)
        // ============================================================
        // HIER: Funktionen zum Hinzuf√ºgen/Entfernen von Flags
        // √ÑNDERN: Wenn du Flag-Validierung hinzuf√ºgen willst
        // BEISPIEL: Verhindere bestimmte Flag-Kombinationen

        // ============================================
        // V7 ADDITION - Flag Management Functions
        // ============================================

        function addSystemFlag() {
            const flagInput = document.getElementById('newSystemFlag');
            const flag = flagInput.value.trim().replace(/\s+/g, '_');
            
            if (flag && !solarSystem.flags.includes(flag)) {
                solarSystem.flags.push(flag);
                updateSystemFlagsList();
                updateOutput();
                flagInput.value = '';
                showNotification(`System-Flag "${flag}" hinzugef√ºgt`);
            }
        }

        function quickAddSystemFlag(flag) {
            if (!solarSystem.flags.includes(flag)) {
                solarSystem.flags.push(flag);
                updateSystemFlagsList();
                updateOutput();
                showNotification(`System-Flag "${flag}" hinzugef√ºgt`);
            }
        }

        function removeSystemFlag(index) {
            const flag = solarSystem.flags[index];
            solarSystem.flags.splice(index, 1);
            updateSystemFlagsList();
            updateOutput();
            showNotification(`System-Flag "${flag}" entfernt`);
        }

        function updateSystemFlagsList() {
            const list = document.getElementById('systemFlagsList');
            
            if (!solarSystem.flags || solarSystem.flags.length === 0) {
                list.innerHTML = '<p class="text-gray-400 text-sm">Keine System-Flags gesetzt</p>';
                return;
            }
            
            list.innerHTML = '';
            solarSystem.flags.forEach((flag, index) => {
                const item = document.createElement('div');
                item.className = 'flag-item';
                item.innerHTML = `
                    <div class="flex items-center gap-2">
                        <span class="text-xl">üè¥</span>
                        <code class="text-sm">${flag}</code>
                    </div>
                    <button class="stellaris-btn stellaris-btn-danger text-xs px-2 py-1" 
                            onclick="removeSystemFlag(${index})">
                        ‚úï
                    </button>
                `;
                list.appendChild(item);
            });
        }

        function addPlanetFlag() {
            if (!selectedPlanet) return;
            
            const flagInput = document.getElementById('newPlanetFlag');
            const flag = flagInput.value.trim().replace(/\s+/g, '_');
            
            if (flag) {
                if (!selectedPlanet.flags) selectedPlanet.flags = [];
                
                if (!selectedPlanet.flags.includes(flag)) {
                    selectedPlanet.flags.push(flag);
                    updatePlanetFlagsList();
                    updatePlanetList();
                    updateOutput();
                    flagInput.value = '';
                    showNotification(`Planet-Flag "${flag}" hinzugef√ºgt`);
                }
            }
        }

        function removePlanetFlag(index) {
            if (selectedPlanet && selectedPlanet.flags) {
                const flag = selectedPlanet.flags[index];
                selectedPlanet.flags.splice(index, 1);
                updatePlanetFlagsList();
                updatePlanetList();
                updateOutput();
                showNotification(`Planet-Flag "${flag}" entfernt`);
            }
        }

        function updatePlanetFlagsList() {
            const list = document.getElementById('planetFlagsList');
            
            if (!selectedPlanet || !selectedPlanet.flags || selectedPlanet.flags.length === 0) {
                list.innerHTML = '<p class="text-gray-400 text-sm">Keine Planet-Flags gesetzt</p>';
                return;
            }
            
            list.innerHTML = '';
            selectedPlanet.flags.forEach((flag, index) => {
                const item = document.createElement('div');
                item.className = 'flag-item';
                item.innerHTML = `
                    <div class="flex items-center gap-2">
                        <span class="text-xl">üè¥</span>
                        <code class="text-sm">${flag}</code>
                    </div>
                    <button class="stellaris-btn stellaris-btn-danger text-xs px-2 py-1" 
                            onclick="removePlanetFlag(${index})">
                        ‚úï
                    </button>
                `;
                list.appendChild(item);
            });
        }

        // ============================================================
        // [SECTION-07] SYSTEM-VARIATIONEN FUNKTIONEN - V9 NEU
        // ============================================================
        // HIER: UI f√ºr System-Auswahl mit expandierbaren Kategorien
        // √ÑNDERN: Um Kategorie-Darstellung anzupassen
        // TIPP: Kategorien k√∂nnen standardm√§√üig eingeklappt sein (expanded: false)

        function renderSystemVariations() {
            const container = document.getElementById('systemVariationsList');
            container.innerHTML = '';
            
            // Render jede Kategorie
            Object.entries(systemCategories).forEach(([catKey, category]) => {
                // Kategorie-Header
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'mb-4';
                
                const categoryHeader = document.createElement('div');
                categoryHeader.className = 'flex items-center justify-between p-3 bg-gray-800 rounded-lg cursor-pointer hover:bg-gray-700 transition-colors';
                categoryHeader.innerHTML = `
                    <div class="flex items-center gap-2">
                        <span class="text-lg">${category.expanded ? '‚ñº' : '‚ñ∂'}</span>
                        <span class="font-semibold text-blue-300">${category.name}</span>
                        <span class="text-xs text-gray-400">(${getSystemCount(catKey)} systems)</span>
                    </div>
                `;
                
                // Toggle Expand/Collapse
                categoryHeader.addEventListener('click', () => {
                    category.expanded = !category.expanded;
                    renderSystemVariations();
                });
                
                categoryDiv.appendChild(categoryHeader);
                
                // Kategorie-Inhalt (wenn expanded)
                if (category.expanded) {
                    const contentDiv = document.createElement('div');
                    contentDiv.className = 'ml-4 mt-2 space-y-2';
                    
                    // Unterkategorien oder direkte Systeme
                    if (category.subcategories) {
                        // Render Unterkategorien
                        Object.entries(category.subcategories).forEach(([subKey, subcategory]) => {
                            const subHeader = document.createElement('div');
                            subHeader.className = 'text-sm font-medium text-gray-400 mb-1 mt-3';
                            subHeader.textContent = subcategory.name;
                            contentDiv.appendChild(subHeader);
                            
                            // Systeme in dieser Unterkategorie
                            subcategory.systems.forEach(systemKey => {
                                if (systemVariations[systemKey]) {
                                    contentDiv.appendChild(createSystemCard(systemKey, systemVariations[systemKey]));
                                }
                            });
                        });
                    } else if (category.systems) {
                        // Direkte Systeme ohne Unterkategorien
                        category.systems.forEach(systemKey => {
                            if (systemVariations[systemKey]) {
                                contentDiv.appendChild(createSystemCard(systemKey, systemVariations[systemKey]));
                            }
                        });
                    }
                    
                    categoryDiv.appendChild(contentDiv);
                }
                
                container.appendChild(categoryDiv);
            });
        }

        // Helper-Funktion: Erstelle System-Karte
        function createSystemCard(key, system) {
            const card = document.createElement('div');
            card.className = 'stellaris-card p-3 cursor-pointer hover:border-blue-500 transition-all';
            
            // DLC-Badges
            let dlcBadges = '';
            if (system.dlc_requirements && system.dlc_requirements.length > 0) {
                dlcBadges = system.dlc_requirements.map(dlc => 
                    `<span class="text-xs px-2 py-1 bg-purple-900 rounded">${dlc}</span>`
                ).join('');
            }
            
            // Max Instances Badge
            let instanceBadge = '';
            if (system.max_instances) {
                instanceBadge = `<span class="text-xs px-2 py-1 bg-yellow-900 rounded">Max: ${system.max_instances}</span>`;
            }
            
            card.innerHTML = `
                <div class="flex justify-between items-start mb-2">
                    <div class="font-semibold text-blue-200">${system.name}</div>
                    <div class="flex gap-1">
                        ${dlcBadges}
                        ${instanceBadge}
                    </div>
                </div>
                <div class="text-xs text-gray-400">${system.description || ''}</div>
            `;
            
            card.addEventListener('click', () => applySystemVariation(key));
            
            return card;
        }

        // Helper-Funktion: Z√§hle Systeme in Kategorie
        function getSystemCount(categoryKey) {
            const category = systemCategories[categoryKey];
            if (category.subcategories) {
                return Object.values(category.subcategories)
                    .reduce((sum, sub) => sum + sub.systems.length, 0);
            } else if (category.systems) {
                return category.systems.length;
            }
            return 0;
        }

        function updateVariationCount() {
            const count = Object.values(systemVariations).filter(v => v.enabled).length;
            const countElement = document.getElementById('variationCount');
            if (countElement) {
                countElement.textContent = count;
            }
        }

        // Toggle variation enabled/disabled state
        function toggleVariation(key) {
            if (systemVariations[key]) {
                // Toggle the enabled state
                systemVariations[key].enabled = !systemVariations[key].enabled;
                
                // Update the UI
                renderVariationsList();
                updateVariationCount();
                updateOutput();
                
                // Show notification
                const variation = systemVariations[key];
                const status = variation.enabled ? 'aktiviert' : 'deaktiviert';
                showNotification(`${variation.displayName} ${status}`);
            }
        }

        // ============================================================
        // [SECTION-07B] FILTER-SYSTEM (NEU IN V9)
        // ============================================================
        // HIER: Filter-Logik f√ºr System-Auswahl
        // √ÑNDERN: Um neue Filter-Kategorien hinzuzuf√ºgen
        // TIPP: matchesFilters() bestimmt welche Systeme angezeigt werden

        const systemFilters = {
            dlc: [],           // Array der aktivierten DLCs
            type: 'all',       // 'single', 'binary', 'trinary', 'all'
            features: []       // Array der gew√ºnschten Features
        };

        function initializeFilters() {
            // DLC-Checkboxen generieren
            const dlcContainer = document.getElementById('dlcFilters');
            if (!dlcContainer) return;
            
            const dlcs = [
                'Utopia', 'Leviathans', 'Federations', 'Aquatics', 
                'Toxoids', 'Ancient Relics', 'Nemesis', 'Overlord'
            ];
            
            dlcContainer.innerHTML = '';
            dlcs.forEach(dlc => {
                const checkbox = document.createElement('label');
                checkbox.className = 'flex items-center gap-2 text-sm cursor-pointer hover:bg-gray-700 p-1 rounded';
                checkbox.innerHTML = `
                    <input type="checkbox" value="${dlc}" class="dlc-filter">
                    <span>${dlc}</span>
                `;
                dlcContainer.appendChild(checkbox);
            });
            
            // Event Listeners f√ºr DLC-Filter
            document.querySelectorAll('.dlc-filter').forEach(cb => {
                cb.addEventListener('change', (e) => {
                    if (e.target.checked) {
                        systemFilters.dlc.push(e.target.value);
                    } else {
                        systemFilters.dlc = systemFilters.dlc.filter(d => d !== e.target.value);
                    }
                    renderVariationsList();
                });
            });
            
            // Type-Filter
            const typeFilter = document.getElementById('typeFilter');
            if (typeFilter) {
                typeFilter.addEventListener('change', (e) => {
                    systemFilters.type = e.target.value;
                    renderVariationsList();
                });
            }
            
            // Feature-Filter
            document.querySelectorAll('.feature-filter').forEach(cb => {
                cb.addEventListener('change', (e) => {
                    if (e.target.checked) {
                        systemFilters.features.push(e.target.value);
                    } else {
                        systemFilters.features = systemFilters.features.filter(f => f !== e.target.value);
                    }
                    renderVariationsList();
                });
            });
            
            // Reset-Button
            const resetBtn = document.getElementById('resetFiltersBtn');
            if (resetBtn) {
                resetBtn.addEventListener('click', () => {
                    // Alle Filter zur√ºcksetzen
                    systemFilters.dlc = [];
                    systemFilters.type = 'all';
                    systemFilters.features = [];
                    
                    // UI zur√ºcksetzen
                    document.querySelectorAll('.dlc-filter').forEach(cb => cb.checked = false);
                    document.querySelectorAll('.feature-filter').forEach(cb => cb.checked = false);
                    if (typeFilter) typeFilter.value = 'all';
                    
                    renderVariationsList();
                    showNotification('üîÑ Filter zur√ºckgesetzt');
                });
            }
        }

        // Pr√ºfe ob ein System den aktiven Filtern entspricht
        function matchesFilters(systemKey, system) {
            // DLC-Filter (nur wenn DLCs ausgew√§hlt sind)
            if (systemFilters.dlc.length > 0) {
                // System muss ALLE ausgew√§hlten DLCs haben
                const hasAllRequiredDLCs = systemFilters.dlc.every(requiredDlc => {
                    // Wenn System keine DLC-Requirements hat, passt es nicht
                    if (!system.dlc_requirements || system.dlc_requirements.length === 0) {
                        return false;
                    }
                    return system.dlc_requirements.includes(requiredDlc);
                });
                
                if (!hasAllRequiredDLCs) return false;
            }
            
            // Type-Filter
            if (systemFilters.type !== 'all') {
                // Bestimme System-Typ aus dem Key oder Stern-Konfiguration
                const isBinary = systemKey.includes('binary') || 
                                (system.star && system.star.companion);
                const isTrinary = systemKey.includes('trinary') || 
                                (system.star && system.star.tertiary);
                
                if (systemFilters.type === 'binary' && !isBinary) return false;
                if (systemFilters.type === 'trinary' && !isTrinary) return false;
                if (systemFilters.type === 'single' && (isBinary || isTrinary)) return false;
            }
            
            // Feature-Filter
            if (systemFilters.features.length > 0) {
                const hasFeature = systemFilters.features.some(feature => {
                    if (feature === 'megastructures') {
                        return systemKey.includes('dyson') || 
                            systemKey.includes('nexus') || 
                            systemKey.includes('shipyard') ||
                            systemKey.includes('catapult') ||
                            systemKey.includes('ring');
                    }
                    if (feature === 'guardians') {
                        return systemKey.includes('dragon') || 
                            systemKey.includes('leviathan') ||
                            system.subcategory === 'guardians';
                    }
                    if (feature === 'habitats') {
                        return systemKey.includes('void_dwellers') ||
                            system.modifications?.add_objects?.some(obj => obj.type === 'habitat');
                    }
                    return false;
                });
                
                if (!hasFeature) return false;
            }
            
            return true;
        }

        // WICHTIG: renderVariationsList() anpassen um Filter zu nutzen
        // Ersetze die bestehende renderVariationsList() Funktion mit dieser:
        
        // Helper function to render variation changes
        function renderVariationChanges(variation) {
            let html = '';
            
            // Show DLC requirements if any
            if (variation.dlc_requirements && variation.dlc_requirements.length > 0) {
                html += `
                    <div class="text-xs text-yellow-400 mb-2">
                        <span class="font-semibold">üì¶ Ben√∂tigt DLCs:</span> ${variation.dlc_requirements.join(', ')}
                    </div>
                `;
            }
            
            // Show modifications if any
            if (variation.modifications) {
                html += '<div class="text-xs text-gray-400 mb-2">';
                html += '<span class="font-semibold">Modifikationen:</span><ul class="ml-4 mt-1">';
                
                if (variation.modifications.planets) {
                    Object.keys(variation.modifications.planets).forEach(planet => {
                        html += `<li>‚Ä¢ Planet: ${planet}</li>`;
                    });
                }
                
                if (variation.modifications.add_objects) {
                    html += `<li>‚Ä¢ ${variation.modifications.add_objects.length} Objekte hinzugef√ºgt</li>`;
                }
                
                html += '</ul></div>';
            }
            
            // Show if it has custom planets
            if (variation.planets && variation.planets.length > 0) {
                html += `
                    <div class="text-xs text-gray-400 mb-2">
                        <span class="font-semibold">Planeten:</span> ${variation.planets.length} definiert
                    </div>
                `;
            }
            
            // Show features
            if (variation.features) {
                html += '<div class="flex flex-wrap gap-1 mt-2">';
                if (variation.features.includes('megastructures')) {
                    html += '<span class="text-xs bg-purple-900/50 px-2 py-1 rounded">üèóÔ∏è Megastrukturen</span>';
                }
                if (variation.features.includes('guardians')) {
                    html += '<span class="text-xs bg-red-900/50 px-2 py-1 rounded">üêâ Guardians</span>';
                }
                if (variation.features.includes('habitats')) {
                    html += '<span class="text-xs bg-blue-900/50 px-2 py-1 rounded">üõ∏ Habitats</span>';
                }
                html += '</div>';
            }
            
            return html;
        }

        function renderVariationsList() {
            const container = document.getElementById('variationsList');
            if (!container) return;
            
            container.innerHTML = '';
            
            let visibleCount = 0;
            
            Object.entries(systemVariations).forEach(([key, variation]) => {
                // FILTER ANWENDEN
                if (!matchesFilters(key, variation)) {
                    return; // System wird nicht angezeigt
                }
                
                visibleCount++;
                
                const card = document.createElement('div');
                card.className = `variation-card ${variation.enabled ? 'enabled' : ''}`;
                
                const isLocked = variation.locked || false;
                const disabled = isLocked ? 'disabled' : '';
                const checkedAttr = variation.enabled ? 'checked' : '';
                
                // ... restlicher bestehender Card-Code bleibt gleich ...
                card.innerHTML = `
                    <div class="stellaris-panel p-4">
                        <div class="flex items-start justify-between mb-3">
                            <label class="flex items-center cursor-pointer ${isLocked ? 'cursor-not-allowed' : ''}">
                                <input type="checkbox" 
                                    ${disabled}
                                    ${checkedAttr}
                                    onchange="toggleVariation('${key}')"
                                    class="mr-3 w-5 h-5">
                                <div>
                                    <div class="flex items-center gap-2">
                                        <span class="text-2xl">${variation.icon}</span>
                                        <span class="font-semibold text-lg">${variation.displayName}</span>
                                    </div>
                                    ${isLocked ? '<span class="text-xs text-yellow-400">‚≠ê Immer aktiv</span>' : ''}
                                </div>
                            </label>
                        </div>
                        
                        ${variation.systemNameOverride ? `
                            <div class="text-xs text-gray-400 mb-2 font-mono bg-black/20 px-2 py-1 rounded">
                                ‚Üí ${variation.systemNameOverride}
                            </div>
                        ` : ''}
                        
                        <p class="text-sm text-gray-300 mb-3">${variation.description}</p>
                        
                        ${renderVariationChanges(variation)}
                    </div>
                `;
                
                container.appendChild(card);
            });
            
            // Zeige Hinweis wenn keine Systeme gefunden wurden
            if (visibleCount === 0) {
                container.innerHTML = `
                    <div class="col-span-full p-8 text-center">
                        <p class="text-gray-400 text-lg">üîç Keine Systeme gefunden</p>
                        <p class="text-gray-500 text-sm mt-2">Passe deine Filter-Einstellungen an</p>
                    </div>
                `;
            }
            
            updateVariationCount();
        }

        // ============================================================
        // [SECTION-08] PLANET MANAGEMENT FUNKTIONEN
        // ============================================================
        // HIER: Hinzuf√ºgen, Ausw√§hlen, L√∂schen von Planeten
        // √ÑNDERN: Um Standard-Planetenwerte anzupassen
        // TIPP: Siehe addPlanet() f√ºr neue Planet-Defaults

        // Planet Management Functions
        function addPlanet() {
            const newPlanet = {
                id: nextCelestialId++,
                type: 'planet',
                name: `planet_${nextCelestialId - 1}`,
                displayName: `Planet ${nextCelestialId - 1}`,
                class: 'pc_continental',
                size: 16,
                orbitDistance: solarSystem.planets.length === 0 ? 40 : 0,
                orbitAngleType: 'range',
                orbitAngleMin: 90,
                orbitAngleMax: 270,
                changeOrbit: 0,
                hasRing: false,
                isStartingPlanet: false,
                modifiers: [],
                moons: [],
                flags: [],
                preventAnomaly: false,
                entityOverride: null
            };

            solarSystem.planets.push(newPlanet);
            updatePlanetList();
            selectPlanet(newPlanet.id);
            updateOutput();
            renderVisualizer();
        }

        function selectPlanet(id) {
            selectedPlanet = findPlanetById(id);
            if (selectedPlanet) {
                elements.celestialDetails.classList.remove('hidden');
                elements.noCelestialSelected.classList.add('hidden');

                const planetIndex = solarSystem.planets.findIndex(p => p.id === selectedPlanet.id);
                
                // Populate details panel
                elements.celestialType.value = selectedPlanet.type === 'planet' ? 'Planet' : 'Mond';
                elements.celestialPosition.value = selectedPlanet.type === 'planet' ? 
                    `Position ${planetIndex + 1}` : `Mond von ${findParentPlanet(selectedPlanet).displayName}`;
                elements.celestialName.value = selectedPlanet.name;
                elements.celestialDisplayName.value = selectedPlanet.displayName;
                elements.celestialClass.value = selectedPlanet.class;
                elements.celestialSize.value = selectedPlanet.size;
                elements.celestialOrbitDistance.value = selectedPlanet.orbitDistance;
                elements.orbitAngleType.value = selectedPlanet.orbitAngleType || 'range';
                elements.celestialOrbitAngle.value = selectedPlanet.orbitAngle || 0;
                elements.celestialOrbitAngleMin.value = selectedPlanet.orbitAngleMin || 90;
                elements.celestialOrbitAngleMax.value = selectedPlanet.orbitAngleMax || 270;
                elements.celestialChangeOrbit.value = selectedPlanet.changeOrbit || 0;
                elements.celestialHasRing.checked = selectedPlanet.hasRing || false;
                elements.celestialIsStartingPlanet.checked = selectedPlanet.isStartingPlanet || false;

                // V7 ADDITION - Update new fields
                if (elements.celestialPreventAnomaly) {
                    elements.celestialPreventAnomaly.checked = selectedPlanet.preventAnomaly || false;
                }
                if (elements.celestialEntity) {
                    elements.celestialEntity.value = selectedPlanet.entityOverride || '';
                }

                // Toggle angle controls
                const isRange = selectedPlanet.orbitAngleType === 'range';
                elements.fixedAngleControl.classList.toggle('hidden', isRange);
                elements.rangeAngleControl.classList.toggle('hidden', !isRange);

                // Update modifier list and reset modifier selection
                updateModifierList();
                elements.modifierCategory.value = '';
                elements.modifierType.innerHTML = '<option value="">-- Erst Kategorie w√§hlen --</option>';
                elements.modifierType.disabled = true;
                elements.addModifierBtn.disabled = true;

                // Enable/disable buttons
                elements.addMoonBtn.disabled = selectedPlanet.type !== 'planet';
                elements.moveUpBtn.disabled = planetIndex <= 0 || selectedPlanet.type === 'moon';
                elements.moveDownBtn.disabled = planetIndex >= solarSystem.planets.length - 1 || selectedPlanet.type === 'moon';

                updatePlanetList();
            } else {
                deselectPlanet();
            }
        }

        function deselectPlanet() {
            selectedPlanet = null;
            elements.celestialDetails.classList.add('hidden');
            elements.noCelestialSelected.classList.remove('hidden');
            elements.addMoonBtn.disabled = true;
            elements.moveUpBtn.disabled = true;
            elements.moveDownBtn.disabled = true;
            updatePlanetList();
        }

        /**
         * Verschiebt den ausgew√§hlten Planeten in der Reihenfolge nach oben
         */
        function movePlanetUp() {
            if (!selectedPlanet || selectedPlanet.type === 'moon') return;
            
            const planetIndex = solarSystem.planets.findIndex(p => p.id === selectedPlanet.id);
            if (planetIndex <= 0) return; // Bereits ganz oben
            
            // Tausche Positionen
            [solarSystem.planets[planetIndex - 1], solarSystem.planets[planetIndex]] = 
            [solarSystem.planets[planetIndex], solarSystem.planets[planetIndex - 1]];
            
            // UI aktualisieren
            updatePlanetList();
            updateOutput();
            renderVisualizer();
            
            // Planet neu ausw√§hlen um Button-Status zu aktualisieren
            selectPlanet(selectedPlanet.id);
            
            showNotification('Planet nach oben verschoben');
        }

        /**
         * Verschiebt den ausgew√§hlten Planeten in der Reihenfolge nach unten
         */
        function movePlanetDown() {
            if (!selectedPlanet || selectedPlanet.type === 'moon') return;
            
            const planetIndex = solarSystem.planets.findIndex(p => p.id === selectedPlanet.id);
            if (planetIndex >= solarSystem.planets.length - 1) return; // Bereits ganz unten
            
            // Tausche Positionen
            [solarSystem.planets[planetIndex], solarSystem.planets[planetIndex + 1]] = 
            [solarSystem.planets[planetIndex + 1], solarSystem.planets[planetIndex]];
            
            // UI aktualisieren
            updatePlanetList();
            updateOutput();
            renderVisualizer();
            
            // Planet neu ausw√§hlen um Button-Status zu aktualisieren
            selectPlanet(selectedPlanet.id);
            
            showNotification('Planet nach unten verschoben');
        }

        function findPlanetById(id) {
            for (const planet of solarSystem.planets) {
                if (planet.id === id) return planet;
                if (planet.moons) {
                    for (const moon of planet.moons) {
                        if (moon.id === id) return moon;
                    }
                }
            }
            return null;
        }

        function findParentPlanet(moon) {
            for (const planet of solarSystem.planets) {
                if (planet.moons && planet.moons.some(m => m.id === moon.id)) {
                    return planet;
                }
            }
            return null;
        }

        function addMoon() {
            if (!selectedPlanet || selectedPlanet.type !== 'planet') {
                showNotification('Bitte w√§hlen Sie zuerst einen Planeten aus!');
                return;
            }

            const newMoon = {
                id: nextCelestialId++,
                type: 'moon',
                name: `moon_${selectedPlanet.moons.length + 1}`,
                displayName: `Mond ${selectedPlanet.moons.length + 1}`,
                class: 'pc_barren_cold',
                size: Math.max(1, Math.floor(selectedPlanet.size * 0.3)),
                orbitDistance: 10 + (selectedPlanet.moons.length * 5),
                orbitAngleType: 'range',
                orbitAngle: 0,
                orbitAngleMin: 90,
                orbitAngleMax: 270,
                changeOrbit: 0,
                hasRing: false,
                isStartingPlanet: false,
                modifiers: [],
                moons: [],
                flags: [],
                preventAnomaly: false,
                entityOverride: null
            };

            selectedPlanet.moons.push(newMoon);
            updatePlanetList();
            selectPlanet(newMoon.id);
            updateOutput();
            renderVisualizer();
            showNotification(`Mond "${newMoon.displayName}" zu ${selectedPlanet.displayName} hinzugef√ºgt!`);
        }

        // ============================================================
        // [SECTION-09] NACHBARSYSTEM MANAGEMENT
        // ============================================================
        // HIER: Alle Funktionen f√ºr Nachbarsysteme
        // √ÑNDERN: Um neue Nachbarsystem-Features hinzuzuf√ºgen
        // WICHTIG: Unterscheide zwischen 'reference' und 'custom' Modus
        // 
        // UNTERFUNKTIONEN:
        // - addNeighborSystem()           ‚Üí Nachbarsystem hinzuf√ºgen
        // - updateNeighborSystemsList()   ‚Üí Liste aktualisieren
        // - editNeighborSystem()          ‚Üí Bestehende bearbeiten
        // - removeNeighborSystem()        ‚Üí L√∂schen
        // - toggleNeighborCustomFields()  ‚Üí UI zwischen Modi umschalten
        // - clearNeighborInputs()         ‚Üí Formular zur√ºcksetzen

        // ============================================================
        // STELLARIS SYSTEM PARSER CLASS
        // ============================================================
        // Parses Stellaris system initializer files and extracts:
        // - System properties (name, class, usage)
        // - Asteroid belts
        // - Neighbor systems
        // - Planets (filtering out stars)
        // - Moons (nested within planets)

        class StellarisSystemParser {
            constructor() {
                this.starClasses = [
                    'pc_b_star', 'pc_a_star', 'pc_f_star', 'pc_g_star', 
                    'pc_k_star', 'pc_m_star', 
                    'pc_black_hole', 'pc_neutron_star', 'pc_pulsar',
                    'pc_t_star', 'pc_o_star', 'pc_toxoid_star', 'pc_rift_star'
                ];
            }

            parse(stellarisCode) {
                const result = {
                    name: '',
                    displayName: '',
                    class: 'sc_g',
                    usage: 'custom_empire',
                    neighborSystems: [],
                    asteroidBelts: [],
                    planets: []
                };

                try {
                    const systemNameMatch = stellarisCode.match(/^(\w+)\s*=\s*\{/m);
                    if (systemNameMatch) {
                        result.name = systemNameMatch[1];
                        result.displayName = systemNameMatch[1];
                    }

                    const classMatch = stellarisCode.match(/class\s*=\s*"([^"]+)"/);
                    if (classMatch) {
                        result.class = classMatch[1];
                    }

                    const usageMatch = stellarisCode.match(/usage\s*=\s*(\w+)/);
                    if (usageMatch) {
                        result.usage = usageMatch[1];
                    }

                    const asteroidBeltRegex = /asteroid_belt\s*=\s*\{[^}]*type\s*=\s*(\w+)[^}]*radius\s*=\s*(\d+)[^}]*\}/g;
                    let beltMatch;
                    while ((beltMatch = asteroidBeltRegex.exec(stellarisCode)) !== null) {
                        result.asteroidBelts.push({
                            type: beltMatch[1],
                            radius: parseInt(beltMatch[2])
                        });
                    }

                    const neighborRegex = /neighbor_system\s*=\s*\{[^}]*\}/g;
                    let neighborMatch;
                    while ((neighborMatch = neighborRegex.exec(stellarisCode)) !== null) {
                        const distanceMatch = neighborMatch[0].match(/distance\s*=\s*(\d+)/);
                        const initializerMatch = neighborMatch[0].match(/initializer\s*=\s*"?([^"\s}]+)"?/);
                        
                        // Nur Nachbarsysteme mit initializer hinzuf√ºgen
                        if (initializerMatch && initializerMatch[1]) {
                            result.neighborSystems.push({
                                distance: distanceMatch ? parseInt(distanceMatch[1]) : 100,
                                initializer: initializerMatch[1]
                            });
                        }
                    }

                    result.planets = this.extractPlanets(stellarisCode);

                } catch (error) {
                    console.error('Parser error:', error);
                    throw new Error('Fehler beim Parsen der Systemdatei: ' + error.message);
                }

                return result;
            }

            extractPlanets(code) {
                const planets = [];
                let planetId = 1;
                
                // Bracket-Counting f√ºr verschachtelte Strukturen
                let i = 0;
                while (i < code.length) {
                    // Finde "planet = {"
                    const planetKeyword = code.indexOf('planet', i);
                    if (planetKeyword === -1) break;
                    
                    // Pr√ºfe ob es wirklich "planet = {" ist
                    const equalsSign = code.indexOf('=', planetKeyword);
                    if (equalsSign === -1 || equalsSign - planetKeyword > 10) {
                        i = planetKeyword + 6;
                        continue;
                    }
                    
                    const braceStart = code.indexOf('{', equalsSign);
                    if (braceStart === -1) break;
                    
                    // Z√§hle Brackets um den kompletten Block zu finden
                    let braceCount = 0;
                    let blockEnd = -1;
                    
                    for (let j = braceStart; j < code.length; j++) {
                        if (code[j] === '{') braceCount++;
                        if (code[j] === '}') {
                            braceCount--;
                            if (braceCount === 0) {
                                blockEnd = j;
                                break;
                            }
                        }
                    }
                    
                    if (blockEnd === -1) break;
                    
                    // Extrahiere den Planet-Block (mit allen verschachtelten Monden)
                    const planetBlock = code.substring(braceStart + 1, blockEnd);
                    
                    try {
                        const planet = this.parsePlanetBlock(planetBlock, planetId);
                        
                        // Intelligente Sterne-Erkennung:
                        // Nur als Stern markieren wenn:
                        // 1. Es eine Stern-Klasse ist UND
                        // 2. Gr√∂√üe > 30 (echte Sterne sind gro√ü) ODER orbit_distance = 0 und erster Planet
                        if (this.isStarClass(planet.class)) {
                            if (planet.size > 30 || (planet.orbitDistance === 0 && planetId === 1)) {
                                planet.isStar = true;
                                planet.type = 'star';
                            } else {
                                // Kleine Objekte mit Stern-Klasse sind wahrscheinlich Fehler
                                // Konvertiere zu Asteroid
                                console.warn(`Planet ${planet.name} hat Stern-Klasse aber kleine Gr√∂√üe (${planet.size}). Konvertiere zu Asteroid.`);
                                planet.class = 'pc_asteroid';
                            }
                        }
                        
                        planets.push(planet);
                        planetId++;
                    } catch (error) {
                        console.error('Fehler beim Parsen von Planet:', error);
                    }
                    
                    // Weiter nach dem n√§chsten Planeten suchen
                    i = blockEnd + 1;
                }
                
                return planets;
            }

            parsePlanetBlock(blockContent, id) {
                const planet = {
                    id: id,
                    type: 'planet',
                    name: this.extractValue(blockContent, 'name') || `planet_${id}`,
                    displayName: this.extractValue(blockContent, 'name') || `Planet ${id}`,
                    class: this.extractValue(blockContent, 'class') || 'pc_continental',
                    size: parseInt(this.extractValue(blockContent, 'size')) || 16,
                    orbitDistance: (() => {
                        const val = this.extractValue(blockContent, 'orbit_distance');
                        return val !== null ? parseInt(val) : 25;
                    })(),
                    orbitAngleType: 'range',
                    orbitAngle: 0,
                    orbitAngleMin: 90,
                    orbitAngleMax: 270,
                    changeOrbit: parseInt(this.extractValue(blockContent, 'change_orbit') || '0'),
                    hasRing: this.extractValue(blockContent, 'has_ring') === 'yes',
                    isStartingPlanet: blockContent.includes('starting_planet') || blockContent.includes('generate_start_buildings'),
                    modifiers: [],
                    moons: [],
                    flags: [],
                    preventAnomaly: blockContent.includes('prevent_anomaly'),
                    entityOverride: null
                };

                // FIX: Unterst√ºtze mehrzeilige orbit_angle Definitionen
                // \s* matcht beliebige Whitespace inkl. Zeilenumbr√ºche
                const angleRangeMatch = blockContent.match(/orbit_angle\s*=\s*\{\s*min\s*=\s*(\d+)\s*max\s*=\s*(\d+)\s*\}/);
                if (angleRangeMatch) {
                    planet.orbitAngleType = 'range';
                    planet.orbitAngleMin = parseInt(angleRangeMatch[1]);
                    planet.orbitAngleMax = parseInt(angleRangeMatch[2]);
                } else {
                    const angleFixedMatch = blockContent.match(/orbit_angle\s*=\s*(\d+)/);
                    if (angleFixedMatch) {
                        planet.orbitAngleType = 'fixed';
                        planet.orbitAngle = parseInt(angleFixedMatch[1]);
                    }
                }

                planet.moons = this.extractMoons(blockContent, id);

                return planet;
            }

            extractMoons(planetBlock, parentId) {
                console.log('=== extractMoons aufgerufen ===');
                console.log('Planet ID:', parentId);
                console.log('Block L√§nge:', planetBlock.length);
                console.log('Block Inhalt (erste 200 Zeichen):', planetBlock.substring(0, 200));
                
                const moons = [];
                let moonId = 1;
                
                // Verbesserte Moon-Extraktion mit Bracket-Counting
                let i = 0;
                while (i < planetBlock.length) {
                    // Finde "moon = {"
                    const moonStart = planetBlock.indexOf('moon', i);
                    if (moonStart === -1) break;
                    
                    const braceStart = planetBlock.indexOf('{', moonStart);
                    if (braceStart === -1) break;
                    
                    // Z√§hle Brackets um den Block zu finden
                    let braceCount = 0;
                    let blockEnd = -1;
                    
                    for (let j = braceStart; j < planetBlock.length; j++) {
                        if (planetBlock[j] === '{') braceCount++;
                        if (planetBlock[j] === '}') {
                            braceCount--;
                            if (braceCount === 0) {
                                blockEnd = j;
                                break;
                            }
                        }
                    }
                    
                    if (blockEnd === -1) break;
                    
                    // Extrahiere den Moon-Block
                    const moonBlock = planetBlock.substring(braceStart + 1, blockEnd);
                    
                    const moon = {
                        id: parentId * 1000 + moonId,
                        type: 'moon',
                        name: this.extractValue(moonBlock, 'name') || `moon_${moonId}`,
                        displayName: this.extractValue(moonBlock, 'name') || `Mond ${moonId}`,
                        class: this.extractValue(moonBlock, 'class') || 'pc_barren_cold',
                        size: parseInt(this.extractValue(moonBlock, 'size')) || 8,
                        orbitDistance: (() => {
                            const val = this.extractValue(moonBlock, 'orbit_distance');
                            return val !== null ? parseInt(val) : 10;
                        })(),
                        orbitAngleType: 'range',
                        orbitAngle: 0,
                        orbitAngleMin: 90,
                        orbitAngleMax: 270,
                        changeOrbit: 0,
                        hasRing: this.extractValue(moonBlock, 'has_ring') === 'yes',
                        isStartingPlanet: false,
                        modifiers: [],
                        moons: [],
                        flags: [],
                        preventAnomaly: moonBlock.includes('prevent_anomaly'),
                        entityOverride: null
                    };

                    // Orbit angle parsing
                    const angleRangeMatch = moonBlock.match(/orbit_angle\s*=\s*\{\s*min\s*=\s*(\d+)\s+max\s*=\s*(\d+)\s*\}/);
                    if (angleRangeMatch) {
                        moon.orbitAngleType = 'range';
                        moon.orbitAngleMin = parseInt(angleRangeMatch[1]);
                        moon.orbitAngleMax = parseInt(angleRangeMatch[2]);
                    } else {
                        const angleFixedMatch = moonBlock.match(/orbit_angle\s*=\s*(\d+)/);
                        if (angleFixedMatch) {
                            moon.orbitAngleType = 'fixed';
                            moon.orbitAngle = parseInt(angleFixedMatch[1]);
                        }
                    }

                    moons.push(moon);
                    moonId++;
                    
                    // Weiter nach dem n√§chsten Mond suchen
                    i = blockEnd + 1;
                }
                
                console.log('Gefundene Monde:', moons.length);
                moons.forEach(m => console.log('  -', m.name, 'Gr√∂√üe:', m.size));
                console.log('=== extractMoons Ende ===');
                
                return moons;
            }

            extractValue(block, key) {
                // Strategie: Finde das erste Vorkommen von "key = value" 
                // das NICHT innerhalb von geschweiften Klammern {} ist
                
                let braceDepth = 0;
                let i = 0;
                
                while (i < block.length) {
                    const char = block[i];
                    
                    // Z√§hle Klammer-Tiefe
                    if (char === '{') {
                        braceDepth++;
                        i++;
                        continue;
                    }
                    if (char === '}') {
                        braceDepth--;
                        i++;
                        continue;
                    }
                    
                    // Nur auf Top-Level (braceDepth === 0) nach dem Key suchen
                    if (braceDepth === 0) {
                        // Versuche den Key an dieser Position zu finden
                        const remaining = block.substring(i);
                        const keyPattern = new RegExp(`^\\s*${key}\\s*=\\s*`);
                        
                        if (keyPattern.test(remaining)) {
                            // Key gefunden! Jetzt den Wert extrahieren
                            const afterKey = remaining.replace(keyPattern, '');
                            
                            // Mit Anf√ºhrungszeichen?
                            const quotedMatch = afterKey.match(/^"([^"]+)"/);
                            if (quotedMatch) return quotedMatch[1];
                            
                            // Ohne Anf√ºhrungszeichen?
                            const unquotedMatch = afterKey.match(/^(\w+)/);
                            if (unquotedMatch) return unquotedMatch[1];
                        }
                    }
                    
                    i++;
                }
                
                return null;
            }

            isStarClass(className) {
                return this.starClasses.includes(className);
            }
        }

        // Import/Export Functions
        function importSystem() {
            const file = elements.importFile.files[0];
            if (!file) {
                showNotification('Bitte w√§hlen Sie eine Datei aus.');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const parser = new StellarisSystemParser();
                    const parsedSystem = parser.parse(e.target.result);
                    
                    // Load parsed data into the editor
                    loadSystemData(parsedSystem);
                    showNotification('System erfolgreich importiert!');
                } catch (error) {
                    showNotification('Fehler beim Import: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        function loadSystemData(systemData) {
            // Clear existing data
            clearSystem();
            
            // Load basic properties
            solarSystem.name = systemData.name || 'custom_system';
            solarSystem.displayName = systemData.displayName || systemData.name || 'Unbenanntes System';
            solarSystem.class = systemData.class || 'sc_g';
            solarSystem.usage = systemData.usage || 'custom_empire';

            elements.systemName.value = solarSystem.name;
            elements.systemDisplayName.value = solarSystem.displayName;
            elements.systemClass.value = solarSystem.class;
            elements.systemUsage.value = solarSystem.usage;

            // Load flags
            if (systemData.flags && Array.isArray(systemData.flags)) {
                solarSystem.flags = [...systemData.flags];
            }

            // Load neighbor systems mit Konvertierung
            if (systemData.neighborSystems && systemData.neighborSystems.length > 0) {
                systemData.neighborSystems.forEach(neighbor => {
                    if (!neighbor.initializer) {
                        return; // √úberspringe Nachbarsysteme ohne initializer
                    }
                    
                    let neighborData = {
                        id: Date.now() + Math.random(),
                        mode: 'reference',
                        initializer: neighbor.initializer
                    };
                    
                    // Konvertiere alte distance zu neuer hyperlaneJumps-Struktur
                    if (neighbor.distance !== undefined) {
                        const jumps = Math.max(1, Math.floor(neighbor.distance / 50));
                        neighborData.hyperlaneJumps = {
                            min: jumps,
                            max: jumps + 2
                        };
                    } else if (neighbor.hyperlaneJumps) {
                        neighborData.hyperlaneJumps = neighbor.hyperlaneJumps;
                    } else {
                        neighborData.hyperlaneJumps = { min: 1, max: 3 };
                    }
                    
                    solarSystem.neighborSystems.push(neighborData);
                });
            }

            // Load asteroid belts
            systemData.asteroidBelts.forEach(belt => {
                solarSystem.asteroidBelts.push({
                    id: Date.now() + Math.random(),
                    type: belt.type,
                    radius: belt.radius
                });
            });

            // Load planets
            systemData.planets.forEach(planet => {
                nextCelestialId = Math.max(nextCelestialId, planet.id + 1);
                solarSystem.planets.push(planet);
            });

            // Update UI
            updateNeighborSystemsList();
            updateAsteroidBeltList();
            updatePlanetList();
            updateSystemFlagsList(); // Flags-Liste aktualisieren
            updateOutput();
            renderVisualizer();
        }

        function clearSystem() {
            solarSystem = {
                name: 'my_custom_system',
                displayName: 'Mein Sonnensystem',
                class: 'sc_g',
                usage: 'custom_empire',
                neighborSystems: [],
                asteroidBelts: [],
                planets: [],
                flags: [] // Flags initialisieren
            };
            
            selectedPlanet = null;
            nextCelestialId = 1;
            
            // Reset UI
            elements.systemName.value = solarSystem.name;
            elements.systemDisplayName.value = solarSystem.displayName;
            elements.systemClass.value = solarSystem.class;
            elements.systemUsage.value = solarSystem.usage;
            
            updateNeighborSystemsList();
            updateAsteroidBeltList();
            updatePlanetList();
            updateSystemFlagsList(); // Flags-Liste aktualisieren
            updateOutput();
            renderVisualizer();
            deselectPlanet();
            
            showNotification('System geleert!');
        }


        // ============================================================
        // [SECTION-09] NACHBARSYSTEM MANAGEMENT
        // ============================================================
        // (Siehe Marker oben f√ºr Details)

        /**
         * ‚úÖ KORRIGIERT: Nachbarsystem hinzuf√ºgen mit korrekter Datenstruktur
         */
        function addNeighborSystem() {
            const mode = document.getElementById('neighborMode').value;
            
            let newNeighbor = {
                id: Date.now(),
                mode: mode,
                // ‚úÖ KORRIGIERT: hyperlaneJumps statt distance
                hyperlaneJumps: { 
                    min: parseInt(document.getElementById('neighborHyperlaneMin')?.value || 1),
                    max: parseInt(document.getElementById('neighborHyperlaneMax')?.value || 3)
                },
                trigger: document.getElementById('neighborTrigger')?.value.trim() || null
            };
            
            if (mode === 'reference') {
                // Referenz-Modus
                const reference = document.getElementById('newNeighborReference').value.trim();
                if (!reference) {
                    showNotification('‚ö†Ô∏è Bitte geben Sie eine System-Referenz ein!');
                    return;
                }
                newNeighbor.initializer = reference;
            } else {
                // Custom-Modus
                const customName = document.getElementById('customNeighborName').value.trim();
                const customStarClass = document.getElementById('customNeighborStarClass').value;
                
                if (!customName) {
                    showNotification('‚ö†Ô∏è Bitte geben Sie einen Systemnamen ein!');
                    return;
                }
                
                newNeighbor.name = customName;
                newNeighbor.starClass = customStarClass;
                
                // ‚úÖ NEU: Asteroideng√ºrtel sammeln
                newNeighbor.asteroidBelts = [];
                document.querySelectorAll('#customNeighborAsteroidsList .neighbor-belt-item').forEach(belt => {
                    newNeighbor.asteroidBelts.push({
                        type: belt.querySelector('[data-field="type"]').value,
                        radius: parseInt(belt.querySelector('[data-field="radius"]').value)
                    });
                });
                
                // ‚úÖ ERWEITERT: Planeten mit Monden sammeln
                newNeighbor.planets = [];
                document.querySelectorAll('#customNeighborPlanetsList .neighbor-planet-item').forEach(planet => {
                    const planetType = planet.dataset.type;
                    
                    if (planetType === 'asteroid_group') {
                        newNeighbor.planets.push({
                            type: 'asteroid_group',
                            class: planet.querySelector('[data-field="class"]').value,
                            countMin: parseInt(planet.querySelector('[data-field="countMin"]').value),
                            countMax: parseInt(planet.querySelector('[data-field="countMax"]').value)
                        });
                    } else {
                        const planetData = {
                            type: 'single',
                            name: planet.querySelector('[data-field="name"]').value,
                            class: planet.querySelector('[data-field="class"]').value,
                            size: parseInt(planet.querySelector('[data-field="size"]').value),
                            hasRing: false,
                            moons: []
                        };
                        
                        // Monde sammeln
                        planet.querySelectorAll('.moon-item').forEach(moon => {
                            planetData.moons.push({
                                name: moon.querySelector('[data-field="name"]').value,
                                class: moon.querySelector('[data-field="class"]').value,
                                size: parseInt(moon.querySelector('[data-field="size"]').value),
                                orbitDistance: 5
                            });
                        });
                        
                        newNeighbor.planets.push(planetData);
                    }
                });
            }
            
            solarSystem.neighborSystems.push(newNeighbor);
            updateNeighborSystemsList();
            clearNeighborInputs();
            updateOutput();
            renderVisualizer();
            showNotification(`‚úÖ Nachbarsystem "${newNeighbor.name || newNeighbor.initializer}" hinzugef√ºgt!`);
        }

        function clearNeighborInputs() {
            // ‚úÖ KORRIGIERT: Richtige Felder zur√ºcksetzen
            const hyperlaneMin = document.getElementById('neighborHyperlaneMin');
            const hyperlaneMax = document.getElementById('neighborHyperlaneMax');
            const triggerInput = document.getElementById('neighborTrigger');
            const referenceInput = document.getElementById('newNeighborReference');
            const customNameInput = document.getElementById('customNeighborName');
            const customStarClass = document.getElementById('customNeighborStarClass');
            
            if (hyperlaneMin) hyperlaneMin.value = 1;
            if (hyperlaneMax) hyperlaneMax.value = 3;
            if (triggerInput) triggerInput.value = '';
            if (referenceInput) referenceInput.value = '';
            if (customNameInput) customNameInput.value = '';
            if (customStarClass) customStarClass.value = 'sc_g';
            
            // Clear custom asteroid belts
            const asteroidsList = document.getElementById('customNeighborAsteroidsList');
            if (asteroidsList) {
                asteroidsList.innerHTML = '<p class="text-gray-400 text-xs">Keine G√ºrtel definiert</p>';
            }
            
            // Clear custom planet list
            const planetsList = document.getElementById('customNeighborPlanetsList');
            if (planetsList) {
                planetsList.innerHTML = '<p class="text-gray-400 text-xs">Keine Planeten definiert</p>';
            }
        }

        /**
         * ‚úÖ NEU: Toggle zwischen Reference und Custom Modus
         */
        function toggleNeighborCustomFields() {
            const mode = document.getElementById('neighborMode').value;
            const referenceFields = document.getElementById('referenceNeighborFields');
            const customFields = document.getElementById('customNeighborFields');
            
            if (mode === 'reference') {
                referenceFields.classList.remove('hidden');
                customFields.classList.add('hidden');
            } else {
                referenceFields.classList.add('hidden');
                customFields.classList.remove('hidden');
            }
        }

        /**
         * ‚úÖ NEU: Asteroideng√ºrtel zu Draft-Nachbarsystem hinzuf√ºgen
         */
        function addNeighborAsteroidBelt() {
            const beltList = document.getElementById('customNeighborAsteroidsList');
            const existingBelts = beltList.querySelectorAll('.neighbor-belt-item').length;
            
            if (existingBelts === 0) {
                beltList.innerHTML = '';
            }
            
            const beltItem = document.createElement('div');
            beltItem.className = 'neighbor-belt-item bg-gray-700/50 p-2 rounded flex justify-between items-center';
            
            beltItem.innerHTML = `
                <div class="flex gap-2 flex-1">
                    <select class="stellaris-input text-xs py-1 flex-1" data-field="type">
                        <option value="rocky_asteroid_belt">Rocky Asteroid Belt</option>
                        <option value="icy_asteroid_belt">Icy Asteroid Belt</option>
                        <option value="crystal_asteroid_belt">Crystal Asteroid Belt</option>
                    </select>
                    <input type="number" placeholder="Radius" value="${90 + existingBelts * 60}" min="30" max="300"
                           class="stellaris-input text-xs py-1 w-24" data-field="radius">
                </div>
                <button onclick="removeNeighborBeltDraft(this)" 
                        class="stellaris-btn stellaris-btn-danger text-xs px-2 py-1 ml-2">
                    ‚úï
                </button>
            `;
            
            beltList.appendChild(beltItem);
        }

        function removeNeighborBeltDraft(button) {
            const beltList = document.getElementById('customNeighborAsteroidsList');
            button.closest('.neighbor-belt-item').remove();
            
            if (beltList.querySelectorAll('.neighbor-belt-item').length === 0) {
                beltList.innerHTML = '<p class="text-gray-400 text-xs">Keine G√ºrtel definiert</p>';
            }
        }

        /**
         * ‚úÖ NEU: Planet zu Draft-Nachbarsystem hinzuf√ºgen
         */
        function addNeighborPlanetDraft(type = 'single') {
            const planetList = document.getElementById('customNeighborPlanetsList');
            const existingPlanets = planetList.querySelectorAll('.neighbor-planet-item').length;
            
            if (existingPlanets === 0) {
                planetList.innerHTML = '';
            }
            
            const planetItem = document.createElement('div');
            planetItem.className = 'neighbor-planet-item bg-gray-700/50 p-3 rounded border border-gray-600';
            planetItem.dataset.type = type;
            
            if (type === 'asteroid_group') {
                // Asteroiden-Gruppe
                planetItem.innerHTML = `
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm font-medium text-yellow-400">‚òÑÔ∏è Asteroiden-Gruppe</span>
                        <button onclick="removeNeighborPlanetDraft(this)" 
                                class="stellaris-btn stellaris-btn-danger text-xs px-2 py-1">
                            ‚úï
                        </button>
                    </div>
                    <div class="grid grid-cols-3 gap-2">
                        <select class="stellaris-input text-xs py-1" data-field="class">
                            <option value="pc_asteroid">Rocky Asteroid</option>
                            <option value="pc_ice_asteroid">Eis-Asteroid</option>
                        </select>
                        <input type="number" placeholder="Min" value="2" min="1" max="10"
                               class="stellaris-input text-xs py-1" data-field="countMin">
                        <input type="number" placeholder="Max" value="4" min="1" max="10"
                               class="stellaris-input text-xs py-1" data-field="countMax">
                    </div>
                `;
            } else {
                // Einzelner Planet
                planetItem.innerHTML = `
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm font-medium text-blue-400">üåç Planet</span>
                        <button onclick="removeNeighborPlanetDraft(this)" 
                                class="stellaris-btn stellaris-btn-danger text-xs px-2 py-1">
                            ‚úï
                        </button>
                    </div>
                    <div class="grid grid-cols-3 gap-2 mb-2">
                        <input type="text" placeholder="Name (optional)" value="planet_${existingPlanets + 1}"
                               class="stellaris-input text-xs py-1" data-field="name">
                        <select class="stellaris-input text-xs py-1" data-field="class">
                            <optgroup label="Bewohnbar">
                                <option value="pc_continental">Kontinental</option>
                                <option value="pc_ocean">Ozean</option>
                                <option value="pc_tropical">Tropisch</option>
                                <option value="pc_arid">Arid</option>
                                <option value="pc_desert">W√ºste</option>
                                <option value="pc_savannah">Savanne</option>
                                <option value="pc_arctic">Arktisch</option>
                                <option value="pc_tundra">Tundra</option>
                                <option value="pc_alpine">Alpin</option>
                                <option value="pc_gaia">Gaia</option>
                            </optgroup>
                            <optgroup label="Unbewohnbar">
                                <option value="pc_barren">Karg</option>
                                <option value="pc_barren_cold">Karg (Kalt)</option>
                                <option value="pc_frozen">Gefroren</option>
                                <option value="pc_molten">Geschmolzen</option>
                                <option value="pc_toxic">Toxisch</option>
                            </optgroup>
                            <optgroup label="Gas-Riesen">
                                <option value="pc_gas_giant">Gasriese</option>
                                <option value="pc_hot_gas_giant">Hei√üer Gasriese</option>
                                <option value="pc_cold_gas_giant">Kalter Gasriese</option>
                            </optgroup>
                            <optgroup label="Asteroiden">
                                <option value="pc_asteroid">Rocky Asteroid</option>
                                <option value="pc_ice_asteroid">Eis-Asteroid</option>
                            </optgroup>
                        </select>
                        <input type="number" placeholder="Gr√∂√üe" value="16" min="1" max="50"
                               class="stellaris-input text-xs py-1" data-field="size">
                    </div>
                    
                    <!-- Monde-Bereich -->
                    <div class="mt-2 p-2 bg-gray-800/50 rounded border-l-2 border-purple-500/50">
                        <div class="flex justify-between items-center mb-1">
                            <span class="text-xs text-gray-400">üåô Monde</span>
                            <button onclick="addMoonToDraftPlanet(this)" 
                                    class="stellaris-btn stellaris-btn-secondary text-xs px-2 py-1">
                                + Mond
                            </button>
                        </div>
                        <div class="moon-list space-y-1 mt-1">
                            <!-- Monde werden hier eingef√ºgt -->
                        </div>
                    </div>
                `;
            }
            
            planetList.appendChild(planetItem);
        }

        // ============================================================
        // [NEUE SEKTION] SYSTEM-NAMING & TEMPLATE MANAGEMENT
        // ============================================================
        
        /**
         * System-Naming Helper
         * Verhindert Konflikte mit Vanilla-System-IDs
         */
        const SystemNaming = {
            RESERVED_IDS: [
                "sol", "deneb", "sirius", "vega", "altair", "rigel", 
                "alpha_centauri", "barnards_star", "procyon", "tau_ceti"
                // F√ºge weitere Vanilla-System-IDs hier hinzu
            ],
            
            GREEK_NAMES: [
                "alpha", "beta", "gamma", "delta", "epsilon", "zeta", 
                "eta", "theta", "iota", "kappa", "lambda", "mu"
            ],
            
            CONSTELLATION_NAMES: [
                "andromeda", "aquarius", "aries", "cancer", "capricorn",
                "cassiopeia", "cygnus", "draco", "gemini", "hercules",
                "leo", "libra", "orion", "pegasus", "perseus", "phoenix",
                "pisces", "sagittarius", "scorpio", "taurus", "virgo"
            ],
            
            /**
             * Generiert Namensvorschl√§ge basierend auf System-Typ
             */
            suggestNames(systemType, baseTemplate = null) {
                const suggestions = [];
                
                if (systemType === 'custom') {
                    // Custom-Systeme: Eindeutige, nicht-Vanilla Namen
                    suggestions.push(
                        `custom_${this.getRandomGreekName()}_system`,
                        `custom_${this.getRandomConstellationName()}`,
                        `system_${Date.now().toString().slice(-6)}`
                    );
                } else if (systemType === 'vanilla_variant' && baseTemplate) {
                    // Vanilla-Variante
                    suggestions.push(
                        `${baseTemplate}_variant`,
                        `${baseTemplate}_alt`,
                        `${baseTemplate}_custom`
                    );
                } else if (systemType === 'template') {
                    // Von Template
                    suggestions.push(
                        `binary_custom_${Date.now().toString().slice(-6)}`,
                        `trinary_custom_${Date.now().toString().slice(-6)}`,
                        `custom_kepler_${Date.now().toString().slice(-6)}`
                    );
                }
                
                return suggestions;
            },
            
            /**
             * Validiert System-ID gegen Vanilla-Konflikte
             */
            validateSystemId(systemId) {
                const normalized = systemId.toLowerCase().trim();
                
                if (this.RESERVED_IDS.includes(normalized)) {
                    return {
                        valid: false,
                        warning: `‚ö†Ô∏è "${systemId}" ist ein Vanilla-System-ID. Bitte "_variant", "_custom" oder "_alt" anh√§ngen.`,
                        suggestion: `${normalized}_custom`
                    };
                }
                
                if (!/^[a-z0-9_]+$/.test(normalized)) {
                    return {
                        valid: false,
                        warning: `‚ö†Ô∏è System-ID darf nur Kleinbuchstaben, Zahlen und Unterstriche enthalten.`,
                        suggestion: normalized.replace(/[^a-z0-9_]/g, '_')
                    };
                }
                
                return { valid: true };
            },
            
            getRandomGreekName() {
                return this.GREEK_NAMES[Math.floor(Math.random() * this.GREEK_NAMES.length)];
            },
            
            getRandomConstellationName() {
                return this.CONSTELLATION_NAMES[Math.floor(Math.random() * this.CONSTELLATION_NAMES.length)];
            },
            
            /**
             * Pr√ºft ob System-ID ein Vanilla-System ist
             */
            isVanillaSystem(systemId) {
                return this.RESERVED_IDS.includes(systemId.toLowerCase());
            }
        };
        
        /**
         * System-Typ-Selector Dialog
         * Zeigt beim System-Erstellen einen Dialog zur Auswahl des System-Typs
         */
        function showSystemTypeDialog() {
            const existingDialog = document.getElementById('systemTypeDialog');
            if (existingDialog) {
                existingDialog.remove();
            }
            
            const dialogHtml = `
                <div id="systemTypeDialog" 
                     style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; 
                            background: rgba(0,0,0,0.8); z-index: 9999; 
                            display: flex; align-items: center; justify-content: center;">
                    <div class="stellaris-panel" style="max-width: 600px; width: 90%;">
                        <h3 class="section-title">üåü Neues Sonnensystem erstellen</h3>
                        
                        <div style="margin-top: 1.5rem;">
                            <!-- Option 1: Leeres Custom-System -->
                            <label class="flex items-center p-4 border border-gray-600 rounded-lg cursor-pointer hover:border-blue-500 transition mb-3">
                                <input type="radio" name="systemType" value="custom" checked 
                                       class="mr-3" style="width: 20px; height: 20px;">
                                <div>
                                    <div class="font-semibold text-blue-400">‚≠ê Leeres benutzerdefiniertes System</div>
                                    <div class="text-sm text-gray-400 mt-1">Starte mit einem komplett leeren System</div>
                                    <input type="text" id="customSystemName" placeholder="z.B. custom_kepler_prime" 
                                           class="stellaris-input mt-2" style="width: 100%;">
                                </div>
                            </label>
                            
                            <!-- Option 2: Von Template -->
                            <label class="flex items-center p-4 border border-gray-600 rounded-lg cursor-pointer hover:border-blue-500 transition mb-3">
                                <input type="radio" name="systemType" value="template" 
                                       class="mr-3" style="width: 20px; height: 20px;">
                                <div style="flex: 1;">
                                    <div class="font-semibold text-purple-400">üìê Von Template starten</div>
                                    <div class="text-sm text-gray-400 mt-1">Basierend auf vorgefertigtem Template</div>
                                    <select id="templateSelect" class="stellaris-input mt-2" style="width: 100%;">
                                        <option value="single_star">Einfaches Einzelstern-System</option>
                                        <option value="binary">Bin√§rstern-System</option>
                                        <option value="trinary">Trin√§rstern-System</option>
                                        <option value="black_hole">Schwarzes Loch-System</option>
                                    </select>
                                    <input type="text" id="templateSystemName" placeholder="z.B. binary_custom_001" 
                                           class="stellaris-input mt-2" style="width: 100%;">
                                </div>
                            </label>
                            
                            <!-- Option 3: Vanilla-Variante -->
                            <label class="flex items-center p-4 border border-gray-600 rounded-lg cursor-pointer hover:border-yellow-500 transition mb-3">
                                <input type="radio" name="systemType" value="vanilla_variant" 
                                       class="mr-3" style="width: 20px; height: 20px;">
                                <div style="flex: 1;">
                                    <div class="font-semibold text-yellow-400">üìã Vanilla-System nachbauen/variieren</div>
                                    <div class="text-sm text-gray-400 mt-1">Erstelle Variante eines Vanilla-Systems</div>
                                    <div class="bg-yellow-900/30 border border-yellow-500/50 rounded p-2 text-xs text-yellow-200 mt-2">
                                        ‚ö†Ô∏è √úberschreibt das Original-System beim Export!
                                    </div>
                                    <select id="vanillaSelect" class="stellaris-input mt-2" style="width: 100%;">
                                        <option value="sol">Sol (Sonnensystem)</option>
                                        <option value="deneb">Deneb</option>
                                        <option value="sirius">Sirius</option>
                                        <option value="alpha_centauri">Alpha Centauri</option>
                                    </select>
                                    <input type="text" id="vanillaVariantName" placeholder="z.B. sol_alternate_history" 
                                           class="stellaris-input mt-2" style="width: 100%;">
                                </div>
                            </label>
                        </div>
                        
                        <!-- Validation Message -->
                        <div id="systemNameValidation" class="mt-3 hidden"></div>
                        
                        <!-- Buttons -->
                        <div class="flex gap-3 mt-6">
                            <button onclick="closeSystemTypeDialog()" 
                                    class="stellaris-btn stellaris-btn-secondary flex-1">
                                Abbrechen
                            </button>
                            <button onclick="createSystemFromDialog()" 
                                    class="stellaris-btn flex-1">
                                System erstellen
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', dialogHtml);
            
            // Event-Listener f√ºr Live-Validierung
            document.querySelectorAll('#customSystemName, #templateSystemName, #vanillaVariantName').forEach(input => {
                input.addEventListener('input', validateSystemNameInput);
            });
        }
        
        /**
         * Validiert System-Namen w√§hrend der Eingabe
         */
        function validateSystemNameInput(event) {
            const input = event.target;
            const systemId = input.value.trim();
            const validationDiv = document.getElementById('systemNameValidation');
            
            if (!systemId) {
                validationDiv.classList.add('hidden');
                return;
            }
            
            const validation = SystemNaming.validateSystemId(systemId);
            
            if (!validation.valid) {
                validationDiv.className = 'mt-3 p-3 bg-red-900/30 border border-red-500 rounded-lg text-sm';
                validationDiv.innerHTML = `
                    ${validation.warning}<br>
                    <span class="text-gray-300">Vorschlag: <code class="text-yellow-400">${validation.suggestion}</code></span>
                `;
                validationDiv.classList.remove('hidden');
            } else {
                validationDiv.className = 'mt-3 p-3 bg-green-900/30 border border-green-500 rounded-lg text-sm text-green-200';
                validationDiv.textContent = '‚úÖ System-ID ist g√ºltig';
                validationDiv.classList.remove('hidden');
            }
        }
        
        /**
         * Erstellt System basierend auf Dialog-Auswahl
         */
        function createSystemFromDialog() {
            const selectedType = document.querySelector('input[name="systemType"]:checked').value;
            let systemId = '';
            let systemDisplayName = '';
            let isVanillaVariant = false;
            
            if (selectedType === 'custom') {
                systemId = document.getElementById('customSystemName').value.trim() || 
                           `custom_system_${Date.now().toString().slice(-6)}`;
                systemDisplayName = systemId.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
            } else if (selectedType === 'template') {
                const template = document.getElementById('templateSelect').value;
                systemId = document.getElementById('templateSystemName').value.trim() || 
                           `${template}_custom_${Date.now().toString().slice(-6)}`;
                systemDisplayName = systemId.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
            } else if (selectedType === 'vanilla_variant') {
                const vanillaBase = document.getElementById('vanillaSelect').value;
                systemId = document.getElementById('vanillaVariantName').value.trim() || 
                           `${vanillaBase}_variant`;
                systemDisplayName = `${vanillaBase.toUpperCase()} Variant`;
                isVanillaVariant = true;
            }
            
            // Validierung
            const validation = SystemNaming.validateSystemId(systemId);
            if (!validation.valid) {
                showNotification(`‚ùå ${validation.warning}`, 'error');
                return;
            }
            
            // Vanilla-Warnung
            if (SystemNaming.isVanillaSystem(systemId) && !systemId.includes('_variant') && !systemId.includes('_custom')) {
                if (!confirm(`‚ö†Ô∏è WARNUNG: "${systemId}" ist eine Vanilla-System-ID!\n\nBeim Export wird das Original-System √ºberschrieben.\n\nWirklich fortfahren?`)) {
                    return;
                }
            }
            
            // System erstellen
            solarSystem.name = systemId;
            solarSystem.displayName = systemDisplayName;
            solarSystem.isVanillaVariant = isVanillaVariant;
            
            // UI aktualisieren
            document.getElementById('systemName').value = systemId;
            document.getElementById('systemDisplayName').value = systemDisplayName;
            
            closeSystemTypeDialog();
            showNotification(`‚úÖ System "${systemDisplayName}" erstellt!`, 'success');
            updateOutput();
        }
        
        /**
         * Schlie√üt den Dialog
         */
        function closeSystemTypeDialog() {
            const dialog = document.getElementById('systemTypeDialog');
            if (dialog) {
                dialog.remove();
            }
        }
        
        // Global verf√ºgbar machen
        window.showSystemTypeDialog = showSystemTypeDialog;
        window.closeSystemTypeDialog = closeSystemTypeDialog;
        window.createSystemFromDialog = createSystemFromDialog;

        /**
         * ‚úÖ NEU: Mond zu Draft-Planet hinzuf√ºgen
         */
        function addMoonToDraftPlanet(button) {
            const planetItem = button.closest('.neighbor-planet-item');
            const moonList = planetItem.querySelector('.moon-list');
            const existingMoons = moonList.querySelectorAll('.moon-item').length;
            
            const moonItem = document.createElement('div');
            moonItem.className = 'moon-item bg-gray-700/30 p-1 rounded flex gap-1 items-center';
            
            moonItem.innerHTML = `
                <span class="text-xs text-gray-400">üåô</span>
                <input type="text" placeholder="Name (optional)" value="moon_${existingMoons + 1}"
                       class="stellaris-input text-xs py-1 flex-1" data-field="name">
                <select class="stellaris-input text-xs py-1" data-field="class">
                    <option value="pc_barren_cold">Karg (Kalt)</option>
                    <option value="pc_frozen">Gefroren</option>
                    <option value="pc_barren">Karg</option>
                    <option value="pc_molten">Geschmolzen</option>
                    <option value="pc_asteroid">Asteroid</option>
                    <option value="pc_ice_asteroid">Eis-Asteroid</option>
                </select>
                <input type="number" placeholder="Gr√∂√üe" value="${8 - existingMoons}" min="1" max="15"
                       class="stellaris-input text-xs py-1 w-16" data-field="size">
                <button onclick="removeMoonFromDraft(this)" 
                        class="stellaris-btn stellaris-btn-danger text-xs px-1 py-1">
                    ‚úï
                </button>
            `;
            
            moonList.appendChild(moonItem);
        }

        function removeMoonFromDraft(button) {
            button.closest('.moon-item').remove();
        }

        function removeNeighborPlanetDraft(button) {
            const planetList = document.getElementById('customNeighborPlanetsList');
            button.closest('.neighbor-planet-item').remove();
            
            if (planetList.querySelectorAll('.neighbor-planet-item').length === 0) {
                planetList.innerHTML = '<p class="text-gray-400 text-xs">Keine Planeten definiert</p>';
            }
        }

        function addPlanetToNeighbor(neighborId) {
            const neighbor = solarSystem.neighborSystems.find(n => n.id === neighborId);
            if (!neighbor || neighbor.mode !== 'custom') return;
            
            const newPlanet = {
                id: Date.now(),
                name: `planet_${neighbor.planets.length + 1}`,
                class: 'pc_continental',
                size: 16,
                orbitDistance: neighbor.planets.length === 0 ? 40 : 25
            };
            
            neighbor.planets.push(newPlanet);
            updateNeighborSystemsList();
            updateOutput();
            showNotification('‚úÖ Planet zum Nachbarsystem hinzugef√ºgt!');
        }

        function addPlanetToCustomNeighborDraft() {
            // This is for the draft neighbor being created
            const planetList = document.getElementById('customNeighborPlanetsList');
            const existingPlanets = planetList.querySelectorAll('.neighbor-planet-item').length;
            
            const planetItem = document.createElement('div');
            planetItem.className = 'neighbor-planet-item bg-gray-700/50 p-2 rounded flex justify-between items-center';
            planetItem.dataset.index = existingPlanets;
            
            planetItem.innerHTML = `
                <div class="grid grid-cols-3 gap-2 flex-1">
                    <input type="text" placeholder="Planet Name" value="planet_${existingPlanets + 1}"
                        class="stellaris-input text-xs py-1" data-field="name">
                    <select class="stellaris-input text-xs py-1" data-field="class">
                        <option value="pc_continental">Kontinental</option>
                        <option value="pc_ocean">Ozean</option>
                        <option value="pc_desert">W√ºste</option>
                        <option value="pc_arctic">Arktisch</option>
                        <option value="pc_tropical">Tropisch</option>
                        <option value="pc_arid">Arid</option>
                        <option value="pc_tundra">Tundra</option>
                        <option value="pc_barren">Karg</option>
                        <option value="pc_gas_giant">Gasriese</option>
                    </select>
                    <input type="number" placeholder="Gr√∂√üe" value="16" min="1" max="50"
                        class="stellaris-input text-xs py-1" data-field="size">
                </div>
                <button onclick="removeNeighborPlanetDraft(this)" 
                        class="stellaris-btn stellaris-btn-danger text-xs px-2 py-1 ml-2">
                    ‚úï
                </button>
            `;
            
            if (existingPlanets === 0) {
                planetList.innerHTML = '';
            }
            planetList.appendChild(planetItem);
        }

        function removeNeighborPlanetDraft(button) {
            button.closest('.neighbor-planet-item').remove();
            
            const planetList = document.getElementById('customNeighborPlanetsList');
            if (planetList.querySelectorAll('.neighbor-planet-item').length === 0) {
                planetList.innerHTML = '<p class="text-gray-400 text-xs">Keine Planeten definiert</p>';
            }
        }

        function collectCustomNeighborPlanets() {
            const planetItems = document.querySelectorAll('#customNeighborPlanetsList .neighbor-planet-item');
            const planets = [];
            
            planetItems.forEach(item => {
                const name = item.querySelector('[data-field="name"]').value.trim();
                const planetClass = item.querySelector('[data-field="class"]').value;
                const size = parseInt(item.querySelector('[data-field="size"]').value) || 16;
                
                if (name) {
                    planets.push({
                        id: Date.now() + Math.random(),
                        name: name,
                        class: planetClass,
                        size: size,
                        orbitDistance: planets.length === 0 ? 40 : 25
                    });
                }
            });
            
            return planets;
        }

        function removePlanetFromNeighbor(neighborId, planetId) {
            const neighbor = solarSystem.neighborSystems.find(n => n.id === neighborId);
            if (!neighbor) return;
            
            neighbor.planets = neighbor.planets.filter(p => p.id !== planetId);
            updateNeighborSystemsList();
            updateOutput();
            showNotification('Planet aus Nachbarsystem entfernt!');
        }

        function editNeighborSystem(neighborId) {
            const neighbor = solarSystem.neighborSystems.find(n => n.id === neighborId);
            if (!neighbor) return;
            
            // Scroll to neighbor section and populate fields
            const neighborSection = document.querySelector('.mt-6.p-4.bg-gradient-to-r.from-indigo-900\\/30');
            neighborSection.scrollIntoView({ behavior: 'smooth' });
            
            document.getElementById('neighborMode').value = neighbor.mode;
            document.getElementById('newNeighborDistance').value = neighbor.distance;
            
            if (neighbor.mode === 'reference') {
                document.getElementById('newNeighborReference').value = neighbor.initializer || '';
            } else {
                document.getElementById('customNeighborName').value = neighbor.name || '';
                document.getElementById('customNeighborStarClass').value = neighbor.starClass || 'sc_g';
                
                // Populate planets
                const planetList = document.getElementById('customNeighborPlanetsList');
                planetList.innerHTML = '';
                
                if (neighbor.planets && neighbor.planets.length > 0) {
                    neighbor.planets.forEach(planet => {
                        const planetItem = document.createElement('div');
                        planetItem.className = 'neighbor-planet-item bg-gray-700/50 p-2 rounded flex justify-between items-center';
                        
                        planetItem.innerHTML = `
                            <div class="grid grid-cols-3 gap-2 flex-1">
                                <input type="text" value="${planet.name}" class="stellaris-input text-xs py-1" data-field="name">
                                <select class="stellaris-input text-xs py-1" data-field="class">
                                    <option value="pc_continental" ${planet.class === 'pc_continental' ? 'selected' : ''}>Kontinental</option>
                                    <option value="pc_ocean" ${planet.class === 'pc_ocean' ? 'selected' : ''}>Ozean</option>
                                    <option value="pc_desert" ${planet.class === 'pc_desert' ? 'selected' : ''}>W√ºste</option>
                                    <option value="pc_arctic" ${planet.class === 'pc_arctic' ? 'selected' : ''}>Arktisch</option>
                                    <option value="pc_tropical" ${planet.class === 'pc_tropical' ? 'selected' : ''}>Tropisch</option>
                                </select>
                                <input type="number" value="${planet.size}" min="1" max="50" class="stellaris-input text-xs py-1" data-field="size">
                            </div>
                            <button onclick="removeNeighborPlanetDraft(this)" class="stellaris-btn stellaris-btn-danger text-xs px-2 py-1 ml-2">‚úï</button>
                        `;
                        
                        planetList.appendChild(planetItem);
                    });
                } else {
                    planetList.innerHTML = '<p class="text-gray-400 text-xs">Keine Planeten definiert</p>';
                }
            }
            
            toggleNeighborCustomFields();
            
            // Remove original and user will re-add
            removeNeighborSystem(neighborId);
            showNotification('Nachbarsystem zur Bearbeitung geladen. Bitte speichern Sie die √Ñnderungen.');
        }

        function updateNeighborSystemsList() {
            elements.neighborSystemsList.innerHTML = '';
            
            if (solarSystem.neighborSystems.length === 0) {
                elements.neighborSystemsList.innerHTML = '<p class="text-gray-400 text-sm">Keine Nachbarsysteme definiert</p>';
                return;
            }

            solarSystem.neighborSystems.forEach((neighbor) => {
                const neighborItem = document.createElement('div');
                neighborItem.className = 'bg-gray-700/50 p-3 rounded border border-indigo-500/30';
                
                let content = '';
                
                // ‚úÖ KORRIGIERT: Hyperlane Jumps anzeigen
                const jumpsDisplay = neighbor.hyperlaneJumps 
                    ? `${neighbor.hyperlaneJumps.min}-${neighbor.hyperlaneJumps.max} Jumps`
                    : '1-3 Jumps';
                
                if (neighbor.mode === 'reference') {
                    content = `
                        <div class="flex justify-between items-start">
                            <div>
                                <div class="font-medium text-indigo-300">üîé ${neighbor.initializer}</div>
                                <div class="text-xs text-gray-400 mt-1">Hyperlane: ${jumpsDisplay} ‚Ä¢ Modus: Referenz</div>
                                ${neighbor.trigger ? `<div class="text-xs text-blue-300 mt-1">Trigger: ${neighbor.trigger}</div>` : ''}
                            </div>
                            <div class="flex gap-2">
                                <button onclick="editNeighborSystem(${neighbor.id})" 
                                        class="stellaris-btn stellaris-btn-secondary text-xs px-2 py-1">
                                    Bearbeiten
                                </button>
                                <button onclick="removeNeighborSystem(${neighbor.id})" 
                                        class="stellaris-btn stellaris-btn-danger text-xs px-2 py-1">
                                    L√∂schen
                                </button>
                            </div>
                        </div>
                    `;
                } else {
                    const planetCount = neighbor.planets ? neighbor.planets.length : 0;
                    const asteroidCount = neighbor.asteroidBelts ? neighbor.asteroidBelts.length : 0;
                    const starIcon = getStarIcon(neighbor.starClass);
                    
                    content = `
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <div class="font-medium text-purple-300">${starIcon} ${neighbor.name}</div>
                                <div class="text-xs text-gray-400 mt-1">
                                    Hyperlane: ${jumpsDisplay} ‚Ä¢ Klasse: ${neighbor.starClass} ‚Ä¢ 
                                    ${planetCount} Planet${planetCount !== 1 ? 'en' : ''}
                                    ${asteroidCount > 0 ? ` ‚Ä¢ ${asteroidCount} G√ºrtel` : ''}
                                </div>
                                ${neighbor.trigger ? `<div class="text-xs text-blue-300 mt-1">Trigger: ${neighbor.trigger}</div>` : ''}
                            </div>
                            <div class="flex gap-2">
                                <button onclick="editNeighborSystem(${neighbor.id})" 
                                        class="stellaris-btn stellaris-btn-secondary text-xs px-2 py-1">
                                    Bearbeiten
                                </button>
                                <button onclick="removeNeighborSystem(${neighbor.id})" 
                                        class="stellaris-btn stellaris-btn-danger text-xs px-2 py-1">
                                    L√∂schen
                                </button>
                            </div>
                        </div>
                    `;
                    
                    if (neighbor.planets && neighbor.planets.length > 0) {
                        content += '<div class="mt-2 pl-4 border-l-2 border-purple-500/30 space-y-1">';
                        neighbor.planets.forEach(planet => {
                            const planetIcon = getPlanetIcon(planet.class);
                            content += `
                                <div class="text-xs flex justify-between items-center bg-gray-800/50 p-1 rounded">
                                    <span>${planetIcon} ${planet.name} ‚Ä¢ ${getClassDisplayName(planet.class)} ‚Ä¢ Gr√∂√üe ${planet.size}</span>
                                    <button onclick="removePlanetFromNeighbor(${neighbor.id}, ${planet.id})" 
                                            class="text-red-400 hover:text-red-300 text-xs px-1">
                                        ‚úï
                                    </button>
                                </div>
                            `;
                        });
                        content += '</div>';
                    }
                }
                
                neighborItem.innerHTML = content;
                elements.neighborSystemsList.appendChild(neighborItem);
            });
        }

        function getStarIcon(starClass) {
            const icons = {
                // Hauptreihen-Sterne
                'sc_o': 'üîµ',              // Blauer √úberriese
                'sc_b': 'üíô',              // Hei√üer Riese
                'sc_a': '‚ö™',              // Wei√üer Stern
                'sc_f': 'üíõ',              // Gelblich-wei√üer Stern
                'sc_g': '‚òâ',               // Gelber Zwerg (Sol)
                'sc_k': 'üß°',              // Oranger Zwerg
                'sc_m': 'üî¥',              // Roter Zwerg
                'sc_t': 'üü§',              // Brauner Zwerg
                // Riesen & Spezial
                'sc_m_giant': 'üî•',        // Roter Riese
                'sc_toxoid_star': 'üíö',   // Toxoider Stern
                'sc_rift_star': 'üíú',      // Rift-Stern
                // Kompakte Objekte
                'sc_black_hole': '‚ö´',     // Schwarzes Loch
                'sc_neutron_star': '‚ú®',   // Neutronenstern
                'sc_pulsar': 'üí´',         // Pulsar
                // Multi-Star
                'sc_binary': '‚≠ê‚≠ê',         // Binary
                'sc_trinary': '‚≠ê‚≠ê‚≠ê'      // Trinary
            };
            return icons[starClass] || '‚≠ê';
        }

        function toggleNeighborCustomFields() {
            const mode = document.getElementById('neighborMode').value;
            const customFields = document.getElementById('customNeighborFields');
            const referenceField = document.getElementById('neighborReferenceField');
            
            if (mode === 'custom') {
                customFields.classList.remove('hidden');
                referenceField.classList.add('hidden');
            } else {
                customFields.classList.add('hidden');
                referenceField.classList.remove('hidden');
            }
        }

        function removeNeighborSystem(neighborId) {
            solarSystem.neighborSystems = solarSystem.neighborSystems.filter(n => n.id !== neighborId);
            updateNeighborSystemsList();
            updateOutput();
            renderVisualizer();
        }

        // ============================================================
        // [SECTION-10] ASTEROIDENG√úRTEL MANAGEMENT
        // ============================================================
        // HIER: Funktionen f√ºr Asteroideng√ºrtel im Hauptsystem
        // √ÑNDERN: Um neue Asteroideng√ºrtel-Typen hinzuzuf√ºgen
        // TIPP: Siehe auch generateCustomNeighborDefinition() f√ºr
        //       Asteroideng√ºrtel in Nachbarsystemen

        // Asteroid Belt Management
        function addAsteroidBelt() {
            const newBelt = {
                id: Date.now(),
                type: elements.newAsteroidBeltType.value,
                radius: parseInt(elements.newAsteroidBeltRadius.value) || 575
            };
            
            solarSystem.asteroidBelts.push(newBelt);
            updateAsteroidBeltList();
            updateOutput();
            renderVisualizer();
        }

        function updateAsteroidBeltList() {
            elements.asteroidBeltList.innerHTML = '';
            
            if (solarSystem.asteroidBelts.length === 0) {
                elements.asteroidBeltList.innerHTML = '<p class="text-gray-400 text-sm">Keine Asteroideng√ºrtel definiert</p>';
                return;
            }

            solarSystem.asteroidBelts.forEach((belt, index) => {
                const beltItem = document.createElement('div');
                beltItem.className = 'flex items-center justify-between bg-gray-700 p-2 rounded';
                beltItem.innerHTML = `
                    <span class="text-sm">
                        ‚òÑÔ∏è ${getAsteroidBeltTypeName(belt.type)} (Radius: ${belt.radius})
                    </span>
                    <button class="stellaris-btn stellaris-btn-danger text-xs px-2 py-1" onclick="removeAsteroidBelt(${belt.id})">
                        L√∂schen
                    </button>
                `;
                elements.asteroidBeltList.appendChild(beltItem);
            });
        }

        function removeAsteroidBelt(beltId) {
            solarSystem.asteroidBelts = solarSystem.asteroidBelts.filter(belt => belt.id !== beltId);
            updateAsteroidBeltList();
            updateOutput();
            renderVisualizer();
        }

        function getAsteroidBeltTypeName(type) {
            const names = {
                'rocky_asteroid_belt': 'Felsiger Asteroideng√ºrtel',
                'icy_asteroid_belt': 'Eisiger Asteroideng√ºrtel',
                'crystalline_asteroid_belt': 'Kristalliner Asteroideng√ºrtel'
            };
            return names[type] || type;
        }

        // ============================================================
        // [SECTION-12] CODE-GENERIERUNG (STELLARIS .TXT)
        // ============================================================
        // HIER: Generierung des Stellaris-kompatiblen Codes
        // √ÑNDERN: Um neue Stellaris-Features zu unterst√ºtzen
        // WICHTIG: Achte auf korrekte Einr√ºckung (Tabs!)
        // 
        // HAUPTFUNKTIONEN:
        // - generateStellarisTxt()           ‚Üí Hauptfunktion f√ºr Export
        // - generateSingleVariant()          ‚Üí Einzelne Variante generieren
        // - generateAllVariants()            ‚Üí Mehrere Varianten kombinieren
        // - applyVariationModifications()    ‚Üí Origin-√Ñnderungen anwenden
        // - generateCustomNeighborDefinition() ‚Üí Nachbarsystem-Code
        // - generateStellarisYml()           ‚Üí Lokalisierung (.yml)

        // Code Generation with proper modifier system
        function generateStellarisTxt() {
            // Get enabled system variations
            const enabledSystemVariations = Object.values(systemVariations).filter(v => v.enabled);
            
            // Get enabled origins
            const enabledOrigins = Object.entries(originMechanics)
                .filter(([_, origin]) => origin.enabled)
                .map(([id, origin]) => ({ id, ...origin }));
            
            // If multiple variations OR multiple origins, generate all combinations
            if (enabledSystemVariations.length > 1 || enabledOrigins.length > 1) {
                return generateAllVariantsWithOrigins(enabledSystemVariations, enabledOrigins);
            }
            
            // Single variant, possibly with single origin
            const variation = enabledSystemVariations[0] || systemVariations.blank_single;
            const origin = enabledOrigins[0] || null;
            
            return generateSingleVariantWithOrigin(variation, origin);
        }
        
        function generateAllVariantsWithOrigins(systemVariations, origins) {
            let combinedTxt = `##### Generated by Stellaris Solar System Editor V11 #####\n`;
            combinedTxt += `##### System Variations: ${systemVariations.length} #####\n`;
            combinedTxt += `##### Origin Variants: ${origins.length > 0 ? origins.length : 'None'} #####\n`;
            combinedTxt += `##### Total Combinations: ${systemVariations.length * (origins.length || 1)} #####\n\n`;
            
            // For each system variation
            systemVariations.forEach((variation, vIdx) => {
                if (origins.length === 0) {
                    // No origins - just generate base variation
                    combinedTxt += generateSingleVariantWithOrigin(variation, null);
                    if (vIdx < systemVariations.length - 1) {
                        combinedTxt += '\n\n' + '='  .repeat(80) + '\n\n';
                    }
                } else {
                    // Generate for each origin
                    origins.forEach((origin, oIdx) => {
                        combinedTxt += generateSingleVariantWithOrigin(variation, origin);
                        if (vIdx < systemVariations.length - 1 || oIdx < origins.length - 1) {
                            combinedTxt += '\n\n' + '='.repeat(80) + '\n\n';
                        }
                    });
                }
            });
            
            return combinedTxt;
        }
        
        function generateSingleVariantWithOrigin(variation, origin) {
            console.log('=== EXPORT DEBUG ===');
            console.log('Variation:', variation?.displayName);
            console.log('Origin:', origin?.displayName);
            
            // Start with base system
            const variantSystem = applyVariationModifications(
                JSON.parse(JSON.stringify(solarSystem)), 
                variation
            );
            
            // Apply origin if selected
            let finalSystem = variantSystem;
            if (origin) {
                console.log('Applying origin:', origin.id);
                finalSystem = applyOriginToSystem(variantSystem, origin.id);
            }
            
            console.log('===================');
            
            // Generate system name with origin suffix
            let systemName = variation.systemNameOverride || finalSystem.name || solarSystem.name;
            if (origin) {
                systemName = `${systemName}_${origin.id}`;
            }
            
            let txt = `##### Generated by Stellaris Solar System Editor V11 #####\n`;
            txt += `##### Variant: ${variation.displayName}`;
            if (origin) {
                txt += ` + ${origin.displayName} Origin`;
            }
            txt += ` #####\n\n`;
            
            txt += `${systemName} = {\n`;
            
            // Vanilla override warning
            if (typeof SystemNaming !== 'undefined' && SystemNaming.isVanillaSystem(systemName) && !systemName.includes('_variant') && !systemName.includes('_custom')) {
                txt += `\t# ‚ö†Ô∏è WARNUNG: √úberschreibt Vanilla-System "${systemName}"\n\n`;
            }
            
            txt += `\tname = "${finalSystem.displayName}`;
            if (origin) {
                txt += ` (${origin.displayName})`;
            }
            txt += `"\n`;
            txt += `\tclass = "${finalSystem.class}"\n`;

            // Multiple asteroid belts
            finalSystem.asteroidBelts.forEach(belt => {
                txt += `\tasteroid_belt = {\n`;
                txt += `\t\ttype = ${belt.type}\n`;
                txt += `\t\tradius = ${belt.radius}\n`;
                txt += `\t}\n`;
            });

            // V7 ADDITION - FLAGS
            if (variantSystem.flags && variantSystem.flags.length > 0) {
                txt += `\n\tflags = { ${variantSystem.flags.join(' ')} }\n`;
            }

            if (variantSystem.usage) {
                txt += `\n\tusage = ${variantSystem.usage}\n`;
            }

            // V7 ADDITION - USAGE ODDS
            if (variantSystem.usageOdds) {
                txt += `\n\tusage_odds = {\n`;
                txt += `\t\tbase = ${variantSystem.usageOdds.base}\n`;
                txt += `\t\tmodifier = {\n`;
                txt += `\t\t\t${variantSystem.usageOdds.condition}\n`;
                txt += `\t\t\tadd = ${variantSystem.usageOdds.add}\n`;
                txt += `\t\t}\n`;
                txt += `\t}\n`;
            }

            // V7 ADDITION - MAX INSTANCES
            if (variantSystem.maxInstances) {
                txt += `\n\tmax_instances = ${variantSystem.maxInstances}\n`;
            }

            // ============================================
            // ‚úÖ CORRECTED: Neighbor Systems Generation
            // ============================================
            if (variantSystem.neighborSystems && variantSystem.neighborSystems.length > 0) {
                variantSystem.neighborSystems.forEach(neighbor => {
                    txt += `\tneighbor_system = {\n`;
                    
                    // ‚úÖ KORRIGIERT: hyperlane_jumps statt distance
                    const jumps = neighbor.hyperlaneJumps || { min: 1, max: 3 };
                    txt += `\t\thyperlane_jumps = { min = ${jumps.min} max = ${jumps.max} }\n`;
                    
                    // Trigger (optional)
                    if (neighbor.trigger) {
                        txt += `\t\ttrigger = { ${neighbor.trigger} }\n`;
                    }
                    
                    // ‚úÖ KORRIGIERT: initializer ist immer ein STRING, niemals ein Objekt
                    if (neighbor.mode === 'reference') {
                        // Modus A: Referenz zu existierendem System
                        txt += `\t\tinitializer = "${neighbor.initializer}"\n`;
                    } else if (neighbor.mode === 'custom') {
                        // Modus B: Referenz zu eigenem Custom-System
                        const customSystemName = neighbor.name.toLowerCase().replace(/\s+/g, '_') + '_neighbor';
                        txt += `\t\tinitializer = "${customSystemName}"\n`;
                    }

                    // Generate star
                    txt += `\t\t\tplanet = {\n`;
                    txt += `\t\t\t\tname = "${neighbor.name.toLowerCase().replace(/\s+/g, '_')}_star"\n`;
                    txt += `\t\t\t\tclass = "${getStarClassForSystemClass(neighbor.starClass)}"\n`;
                    txt += `\t\t\t\torbit_distance = 0\n`;
                    txt += `\t\t\t\torbit_angle = 1\n`;
                    txt += `\t\t\t\tsize = 40\n`;
                    txt += `\t\t\t\thas_ring = no\n`;
                    txt += `\t\t\t}\n`;
                   
                    // Generate planets
                    if (neighbor.planets && neighbor.planets.length > 0) {
                        neighbor.planets.forEach(planet => {
                            txt += `\t\t\tplanet = {\n`;
                            txt += `\t\t\t\tname = "${planet.name}"\n`;
                            const planetClass = (planet.isStar || planet.type === 'star') 
                                ? getStarClassForSystemClass(neighbor.starClass) 
                                : planet.class;
                            txt += `\t\t\t\tclass = "${planetClass}"\n`;  // ‚úÖ
                            txt += `\t\t\t\torbit_distance = ${planet.orbitDistance}\n`;
                            txt += `\t\t\t\torbit_angle = { min = 90 max = 270 }\n`;
                            txt += `\t\t\t\tsize = ${planet.size}\n`;
                            txt += `\t\t\t\thas_ring = no\n`;
                            txt += `\t\t\t}\n`;
                        });
                    }
                    
                    txt += `\t}\n`;
                });
            }
        
            txt += `}\n\n`;
            
            // ‚úÖ NEU: Separate Nachbarsystem-Definitionen
            if (solarSystem.neighborSystems && solarSystem.neighborSystems.length > 0) {
                solarSystem.neighborSystems.forEach(neighbor => {
                    if (neighbor.mode === 'custom') {
                        txt += generateCustomNeighborDefinition(neighbor);
                        txt += '\n';
                    }
                });
            }

            txt += `\tinit_effect = {\n`;

            /**
            * ‚úÖ NEU: Generiert separate Nachbarsystem-Definition
            */
            function generateCustomNeighborDefinition(neighbor) {
                const systemId = neighbor.name.toLowerCase().replace(/\s+/g, '_') + '_neighbor';
                
                let txt = `# Custom Neighbor System: ${neighbor.name}\n`;
                txt += `${systemId} = {\n`;
                txt += `\tname = "${neighbor.name}"\n`;
                txt += `\tclass = "${neighbor.starClass}"\n\n`;
                
                // Init Effect f√ºr Nachbarsysteme
                txt += `\tinit_effect = {\n`;
                txt += `\t\tevery_neighbor_system = { set_star_flag = empire_cluster }\n`;
                txt += `\t}\n\n`;
                
                // Stern
                txt += `\tplanet = {\n`;
                txt += `\t\tname = "${systemId}_star"\n`;
                txt += `\t\tclass = "${getStarClassForSystemClass(neighbor.starClass)}"\n`;
                txt += `\t\torbit_distance = 0\n`;
                txt += `\t\torbit_angle = 1\n`;
                txt += `\t\tsize = 30\n`;
                txt += `\t\thas_ring = no\n`;
                txt += `\t}\n\n`;
                
                // Asteroideng√ºrtel
                if (neighbor.asteroidBelts && neighbor.asteroidBelts.length > 0) {
                    neighbor.asteroidBelts.forEach(belt => {
                        txt += `\tasteroid_belt = {\n`;
                        txt += `\t\ttype = ${belt.type}\n`;
                        txt += `\t\tradius = ${belt.radius}\n`;
                        txt += `\t}\n`;
                    });
                    txt += '\n';
                }
                
                // Planeten
                if (neighbor.planets && neighbor.planets.length > 0) {
                    txt += `\tchange_orbit = 45\n\n`;
                    
                    neighbor.planets.forEach((planet, index) => {
                        if (planet.type === 'asteroid_group') {
                            // Asteroiden-Gruppe
                            txt += `\tplanet = {\n`;
                            txt += `\t\tcount = { min = ${planet.countMin || 2} max = ${planet.countMax || 4} }\n`;
                            txt += `\t\tclass = ${planet.class}\n`;
                            txt += `\t\torbit_distance = ${index === 0 ? 0 : 20}\n`;
                            txt += `\t\torbit_angle = { min = 90 max = 270 }\n`;
                            txt += `\t}\n\n`;
                        } else {
                            // Regul√§rer Planet
                            txt += `\tplanet = {\n`;
                            if (planet.name) {
                                txt += `\t\tname = "${planet.name}"\n`;
                            }
                            // ‚úÖ KORRIGIERT: Sterne bekommen Klasse basierend auf Nachbarsystem-Klasse
                            const planetClass = ((planet.orbitDistance || (index === 0 ? 40 : 25)) === 0)
                                ? getStarClassForSystemClass(neighbor.starClass)
                                : planet.class;
                            txt += `\t\tclass = "${planetClass}"\n`;
                            txt += `\t\torbit_distance = ${planet.orbitDistance || (index === 0 ? 40 : 25)}\n`;
                            // ‚¨ÜÔ∏è‚¨ÜÔ∏è‚¨ÜÔ∏è ENDE DER KORREKTUR ‚¨ÜÔ∏è‚¨ÜÔ∏è‚¨ÜÔ∏è
                            txt += `\t\torbit_angle = { min = 90 max = 270 }\n`;
                            txt += `\t\tsize = ${planet.size || 16}\n`;
                            txt += `\t\thas_ring = ${planet.hasRing ? 'yes' : 'no'}\n`;
                            
                            // Monde
                            if (planet.moons && planet.moons.length > 0) {
                                txt += `\n\t\tchange_orbit = 5\n\n`;
                                
                                planet.moons.forEach(moon => {
                                    txt += `\t\tmoon = {\n`;
                                    if (moon.name) {
                                        txt += `\t\t\tname = "${moon.name}"\n`;
                                    }
                                    txt += `\t\t\tclass = "${moon.class}"\n`;
                                    txt += `\t\t\tsize = ${moon.size || 8}\n`;
                                    txt += `\t\t\torbit_distance = ${moon.orbitDistance || 5}\n`;
                                    txt += `\t\t\torbit_angle = { min = 90 max = 270 }\n`;
                                    txt += `\t\t\thas_ring = no\n`;
                                    txt += `\t\t}\n\n`;
                                });
                            }
                            
                            txt += `\t}\n\n`;
                        }
                    });
                }
                
                txt += `}\n`;
                return txt;
            }
            
            /**
            * Konvertiert System-Klasse zu Stern-Klasse
            */
            function getStarClassForSystemClass(systemClass) {
                const mapping = {
                    'sc_b': 'pc_b_star',
                    'sc_a': 'pc_a_star',
                    'sc_f': 'pc_f_star',
                    'sc_o': 'pc_o_star',
                    'sc_b': 'pc_b_star',
                    'sc_a': 'pc_a_star',
                    'sc_f': 'pc_f_star',
                    'sc_g': 'pc_g_star',
                    'sc_k': 'pc_k_star',
                    'sc_m': 'pc_m_star',
                    'sc_t': 'pc_t_star',
                    'sc_m_giant': 'pc_m_star',
                    'sc_toxoid_star': 'pc_toxoid_star',
                    'sc_rift_star': 'pc_rift_star',
                    'sc_black_hole': 'pc_black_hole',
                    'sc_neutron_star': 'pc_neutron_star',
                    'sc_pulsar': 'pc_pulsar'
                };
                return mapping[systemClass] || 'pc_g_star';
            }
            
            // Add empire cluster effects if custom_empire
            if (solarSystem.usage === 'custom_empire') {
                txt += `\t\tevery_neighbor_system = {\n`;
                txt += `\t\t\tset_star_flag = empire_cluster\n`;
                txt += `\t\t\tevery_neighbor_system = {\n`;
                txt += `\t\t\t\tset_star_flag = empire_cluster\n`;
                txt += `\t\t\t}\n`;
                txt += `\t\t}\n`;
                txt += `\t\tgenerate_home_system_resources = yes\n`;
            }
            
            txt += `\t}\n\n`;

            // Pr√ºfe ob ein Stern bereits in der planets-Liste ist
            const hasStar = variantSystem.planets.some(p => p.isStar || p.type === 'star');
            
            if (!hasStar) {
                // Nur generischen Stern erstellen, wenn keiner vorhanden ist
                const systemDisplayName = variantSystem.displayName || 'unknown_system';
                txt += `\tplanet = {\n`;
                txt += `\t\tname = "${systemDisplayName.toLowerCase().replace(/\s+/g, '_')}"\n`;
                txt += `\t\tclass = "${getStarClassForSystemClass(variantSystem.class)}"\n`;
                txt += `\t\torbit_distance = 0\n`;
                txt += `\t\torbit_angle = 1\n`;
                txt += `\t\tsize = 45\n`;
                txt += `\t\thas_ring = no\n`;
                txt += `\t}\n\n`;
            }

            // Generate planets (inkl. importierte Sterne)
            variantSystem.planets.forEach((planet, index) => {
                console.log(`Exporting planet ${index}: ${planet.name}, class: ${planet.class}, orbitDistance: ${planet.orbitDistance}`);
                
                txt += `\tplanet = {\n`;
                txt += `\t\tname = "${planet.name}"\n`;
                // Nur echte Sterne (isStar=true oder type='star') bekommen die Systemklasse
                // orbit_distance=0 bedeutet NICHT automatisch Stern, sondern "gleiche Umlaufbahn wie vorheriges Objekt"
                const planetClass = (planet.isStar || planet.type === 'star') 
                    ? getStarClassForSystemClass(variantSystem.class) 
                    : planet.class;
                txt += `\t\tclass = "${planetClass}"\n`;  // ‚úÖ Pr√ºft ob Stern
                txt += `\t\torbit_distance = ${planet.orbitDistance}\n`;
                
                // Handle orbit angle
                if (planet.orbitAngleType && planet.orbitAngleType.startsWith('shared_')) {
                    // Shared Orbit: Verwende den direkt im Typ gespeicherten Winkel
                    const angle = parseInt(planet.orbitAngleType.split('_')[1]);
                    txt += `\t\torbit_angle = ${angle}\n`;
                } else if (planet.orbitAngleType === 'range') {
                    txt += `\t\torbit_angle = { min = ${planet.orbitAngleMin} max = ${planet.orbitAngleMax} }\n`;
                } else {
                    // Fixed angle
                    txt += `\t\torbit_angle = ${planet.orbitAngle}\n`;
                }
                
                txt += `\t\tsize = ${planet.size}\n`;
                
                if (planet.changeOrbit > 0) {
                    txt += `\t\tchange_orbit = ${planet.changeOrbit}\n`;
                }
                
                txt += `\t\thas_ring = ${planet.hasRing ? 'yes' : 'no'}\n`;
                
                // V7 ADDITION - PLANET FLAGS
                if (planet.flags && planet.flags.length > 0) {
                    txt += `\t\tflags = { ${planet.flags.join(' ')} }\n`;
                }
                
                // V7 ADDITION - ENTITY OVERRIDE
                if (planet.entityOverride) {
                    txt += `\t\tentity = "${planet.entityOverride}"\n`;
                }
                
                // Generate modifiers
                let hasInitEffect = false;
                let initEffectContent = '';
                
                if (planet.modifiers && planet.modifiers.length > 0) {
                    hasInitEffect = true;
                    
                    // Group modifiers by category for better organization
                    const pdModifiers = planet.modifiers.filter(m => m.category === 'planetary_diversity');
                    const otherModifiers = planet.modifiers.filter(m => m.category !== 'planetary_diversity');
                    
                    // Add PD modifiers with conditional check
                    if (pdModifiers.length > 0) {
                        initEffectContent += `\t\t\tif = {\n`;
                        initEffectContent += `\t\t\t\tlimit = { has_planetary_diversity = yes }\n`;
                        pdModifiers.forEach(modifier => {
                            initEffectContent += `\t\t\t\t${modifier.key} = yes\n`;
                        });
                        initEffectContent += `\t\t\t}\n`;
                    }
                    
                    // Add other modifiers directly
                    otherModifiers.forEach(modifier => {
                        if (modifier.category === 'environmental' || modifier.category === 'resource' || modifier.category === 'special') {
                            initEffectContent += `\t\t\tadd_modifier = { modifier = ${modifier.key} }\n`;
                        }
                    });
                }
                
                // V7 ADDITION - PREVENT ANOMALY
                if (planet.preventAnomaly) {
                    hasInitEffect = true;
                    initEffectContent += `\t\t\tprevent_anomaly = yes\n`;
                }
                
                if (planet.isStartingPlanet) {
                    hasInitEffect = true;
                    if (!planet.preventAnomaly) { // Don't duplicate if already added
                        initEffectContent += `\t\t\tprevent_anomaly = yes\n`;
                    }
                    initEffectContent += `\t\t\tgenerate_start_buildings_and_blockers = yes\n`;
                }
                
                if (hasInitEffect) {
                    txt += `\t\tmodifiers = none\n`;
                    txt += `\t\tinit_effect = {\n`;
                    txt += initEffectContent;
                    txt += `\t\t}\n`;
                } else if (planet.isStartingPlanet) {
                    txt += `\t\tstarting_planet = yes\n`;
                    txt += `\t\ttile_blockers = none\n`;
                    txt += `\t\tmodifiers = none\n`;
                }

                // Generate moons
                if (planet.moons && planet.moons.length > 0) {
                    planet.moons.forEach(moon => {
                        txt += `\t\tmoon = {\n`;
                        txt += `\t\t\tname = "${moon.name}"\n`;
                        txt += `\t\t\tclass = "${moon.class}"\n`;
                        txt += `\t\t\torbit_distance = ${moon.orbitDistance}\n`;
                        
                        if (moon.orbitAngleType && moon.orbitAngleType.startsWith('shared_')) {
                            // Shared Orbit: Verwende den direkt im Typ gespeicherten Winkel
                            const angle = parseInt(moon.orbitAngleType.split('_')[1]);
                            txt += `\t\t\torbit_angle = ${angle}\n`;
                        } else if (moon.orbitAngleType === 'range') {
                            txt += `\t\t\torbit_angle = { min = ${moon.orbitAngleMin} max = ${moon.orbitAngleMax} }\n`;
                        } else {
                            txt += `\t\t\torbit_angle = ${moon.orbitAngle}\n`;
                        }
                        
                        txt += `\t\t\tsize = ${moon.size}\n`;
                        if (moon.hasRing) {
                            txt += `\t\t\thas_ring = yes\n`;
                        }
                        
                        txt += `\t\t}\n`;
                    });
                }

                txt += `\t}\n`;
            });

            txt += `}\n`;
            return txt;
        }

        // V7 ADDITION - Multi-Variant Generation
        function generateAllVariants() {
            let combinedTxt = `##### Generated by Stellaris Solar System Editor V7 #####\n`;
            combinedTxt += `##### Multiple Variants Export #####\n`;
            combinedTxt += `##### Total Variants: ${Object.values(systemVariations).filter(v => v.enabled).length} #####\n\n`;
            
            const enabledVariations = Object.entries(systemVariations).filter(([key, v]) => v.enabled);
            
            enabledVariations.forEach(([key, variation], index) => {
                if (index > 0) {
                    combinedTxt += `\n\n##########################################################\n`;
                }
                combinedTxt += `### Variant ${index + 1}: ${variation.displayName} ###\n`;
                combinedTxt += `### System: ${variation.systemNameOverride || solarSystem.name} ###\n`;
                combinedTxt += `##########################################################\n\n`;
                
                combinedTxt += generateSingleVariant(variation);
            });
            
            return combinedTxt;
        }

        function applyVariationModifications(system, variation) {
            const mods = variation.modifications;
            if (!mods) return system;
            
            // Apply system-level modifications
            if (mods.system) {
                if (mods.system.usage) system.usage = mods.system.usage;
                if (mods.system.flags) system.flags = [...mods.system.flags];
                if (mods.system.usageOdds) system.usageOdds = mods.system.usageOdds;
                if (mods.system.maxInstances) system.maxInstances = mods.system.maxInstances;
            }
            
            // Apply planet-level modifications
            if (mods.planets) {
                system.planets.forEach(planet => {
                    // Match planet by normalized name (remove spaces, lowercase)
                    const planetKey = planet.name.toLowerCase().replace(/[^a-z0-9]/g, '');
                    
                    // Check all possible planet name variations
                    const planetMods = mods.planets[planetKey] || 
                                      mods.planets[planet.name.toLowerCase()] ||
                                      mods.planets[planet.displayName.toLowerCase()];
                    
                    if (planetMods) {
                        if (planetMods.changeClass) planet.class = planetMods.changeClass;
                        if (planetMods.changeSize) planet.size = planetMods.changeSize;
                        
                        if (planetMods.addFlags) {
                            planet.flags = [...(planet.flags || []), ...planetMods.addFlags];
                        }
                        
                        if (planetMods.removeFlags) {
                            planetMods.removeFlags.forEach(flag => {
                                planet.flags = (planet.flags || []).filter(f => f !== flag);
                            });
                        }
                        
                        if (planetMods.addModifiers) {
                            planet.modifiers = [...(planet.modifiers || []), ...planetMods.addModifiers];
                        }
                    }
                });
            }
            
            return system;
        }

        function generateStellarisYml() {
            let yml = `l_german:\n`;
            yml += ` # Generated by Stellaris Solar System Editor V10\n`;
            yml += ` # System: ${solarSystem.displayName}\n`;
            yml += ` # With proper modifier system\n\n`;
            yml += ` ${solarSystem.name}_NAME: "${solarSystem.displayName}"\n`;
            yml += ` ${solarSystem.name}_DESC: "Ein ma√ügeschneidertes Sonnensystem mit korrektem Modifier-System."\n\n`;

            // Main system planets
            solarSystem.planets.forEach(planet => {
                yml += ` ${planet.name}_NAME: "${planet.displayName}"\n`;
                if (planet.moons && planet.moons.length > 0) {
                    planet.moons.forEach(moon => {
                        yml += ` ${moon.name}_NAME: "${moon.displayName}"\n`;
                    });
                }
            });

            // Neighbor systems localization
            if (solarSystem.neighborSystems && solarSystem.neighborSystems.length > 0) {
                yml += `\n # Neighbor Systems\n`;
                solarSystem.neighborSystems.forEach(neighbor => {
                    if (neighbor.mode === 'custom') {
                        const systemId = neighbor.name.toLowerCase().replace(/\s+/g, '_') + '_neighbor';
                        
                        // System name
                        yml += ` ${systemId}_NAME: "${neighbor.name}"\n`;
                        
                        // Planets in neighbor systems
                        if (neighbor.planets && neighbor.planets.length > 0) {
                            neighbor.planets.forEach(planet => {
                                if (planet.name && planet.type !== 'asteroid_group') {
                                    yml += ` ${planet.name}_NAME: "${planet.displayName || planet.name}"\n`;
                                    
                                    // Moons of planets
                                    if (planet.moons && planet.moons.length > 0) {
                                        planet.moons.forEach(moon => {
                                            if (moon.name) {
                                                yml += ` ${moon.name}_NAME: "${moon.displayName || moon.name}"\n`;
                                            }
                                        });
                                    }
                                }
                            });
                        }
                    }
                });
            }

            return yml;
        }

        // ============================================================
        // [SECTION-12B] BATCH-EXPORT (NEU IN V9)
        // ============================================================
        // HIER: Export mehrerer System-Varianten in eine Datei
        // √ÑNDERN: Um Export-Format anzupassen
        
        function generateMultiSystemBatch(selectedKeys) {
            let fullCode = `##### Generated by Stellaris Solar System Editor V10 #####\n`;
            fullCode += `##### Batch Export - ${selectedKeys.length} Systems #####\n`;
            fullCode += `##### Generated: ${new Date().toLocaleString('de-DE')} #####\n\n`;
            
            selectedKeys.forEach((key, index) => {
                const variation = systemVariations[key];
                if (!variation) return;
                
                fullCode += `\n${'#'.repeat(70)}\n`;
                fullCode += `### System ${index + 1}/${selectedKeys.length}: ${variation.displayName}\n`;
                fullCode += `### Key: ${key}\n`;
                fullCode += `${'#'.repeat(70)}\n\n`;
                
                // Variation tempor√§r als aktiv markieren
                const wasEnabled = variation.enabled;
                variation.enabled = true;
                
                // Code f√ºr diese Variation generieren
                fullCode += generateSingleVariant(variation);
                
                // Urspr√ºnglichen Status wiederherstellen
                variation.enabled = wasEnabled;
                
                fullCode += `\n\n`;
            });
            
            return fullCode;
        }
        
        function showBatchExportDialog() {
            // Modal erstellen
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-gray-900 p-6 rounded-lg max-w-4xl max-h-[80vh] overflow-y-auto border-2 border-blue-500">
                    <h3 class="text-2xl font-bold mb-4 text-blue-300">üì¶ Batch-Export: Systeme ausw√§hlen</h3>
                    
                    <div class="mb-4 p-3 bg-blue-900/30 rounded border border-blue-500/30">
                        <p class="text-blue-200 text-sm">
                            W√§hle alle Systeme aus, die in eine gemeinsame .txt-Datei exportiert werden sollen.
                            Jedes System wird als separater Initializer eingef√ºgt.
                        </p>
                    </div>
                    
                    <div class="mb-4 flex gap-2">
                        <button id="selectAllBtn" class="stellaris-btn stellaris-btn-secondary text-sm px-3 py-1">
                            ‚úÖ Alle ausw√§hlen
                        </button>
                        <button id="deselectAllBtn" class="stellaris-btn stellaris-btn-secondary text-sm px-3 py-1">
                            ‚¨ú Alle abw√§hlen
                        </button>
                        <div class="ml-auto text-sm text-gray-400 flex items-center">
                            <span id="selectionCount">0</span> Systeme ausgew√§hlt
                        </div>
                    </div>
                    
                    <div id="batchSystemList" class="space-y-2 mb-4 max-h-96 overflow-y-auto">
                        <!-- Wird mit JavaScript gef√ºllt -->
                    </div>
                    
                    <div class="flex gap-2 pt-4 border-t border-gray-700">
                        <button id="executeBatchExportBtn" class="stellaris-btn flex-1">
                            üì• Ausgew√§hlte Systeme exportieren
                        </button>
                        <button id="cancelBatchBtn" class="stellaris-btn-danger">
                            Abbrechen
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Liste populieren
            const listContainer = modal.querySelector('#batchSystemList');
            const selectionCountEl = modal.querySelector('#selectionCount');
            
            function updateSelectionCount() {
                const count = modal.querySelectorAll('.batch-system-cb:checked').length;
                selectionCountEl.textContent = count;
            }
            
            Object.entries(systemVariations).forEach(([key, system]) => {
                const row = document.createElement('label');
                row.className = 'flex items-center gap-3 p-3 bg-gray-800 hover:bg-gray-700 rounded cursor-pointer transition-colors';
                row.innerHTML = `
                    <input type="checkbox" value="${key}" class="batch-system-cb w-5 h-5">
                    <span class="text-2xl">${system.icon}</span>
                    <div class="flex-1">
                        <div class="font-semibold text-blue-200">${system.displayName}</div>
                        <div class="text-xs text-gray-400">${system.description || ''}</div>
                    </div>
                    ${system.dlc_requirements && system.dlc_requirements.length > 0 ? 
                        `<div class="text-xs px-2 py-1 bg-purple-900 rounded">${system.dlc_requirements[0]}</div>` : 
                        ''}
                `;
                listContainer.appendChild(row);
                
                row.querySelector('.batch-system-cb').addEventListener('change', updateSelectionCount);
            });
            
            // Select All
            modal.querySelector('#selectAllBtn').addEventListener('click', () => {
                modal.querySelectorAll('.batch-system-cb').forEach(cb => cb.checked = true);
                updateSelectionCount();
            });
            
            // Deselect All
            modal.querySelector('#deselectAllBtn').addEventListener('click', () => {
                modal.querySelectorAll('.batch-system-cb').forEach(cb => cb.checked = false);
                updateSelectionCount();
            });
            
            // Export Button
            modal.querySelector('#executeBatchExportBtn').addEventListener('click', () => {
                const selected = Array.from(modal.querySelectorAll('.batch-system-cb:checked'))
                    .map(cb => cb.value);
                
                if (selected.length === 0) {
                    showNotification('‚ö†Ô∏è Bitte w√§hle mindestens ein System aus', 'warning');
                    return;
                }
                
                // Code generieren
                const batchCode = generateMultiSystemBatch(selected);
                
                // Datei herunterladen
                const blob = new Blob([batchCode], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `stellaris_batch_${selected.length}_systems_${Date.now()}.txt`;
                a.click();
                URL.revokeObjectURL(url);
                
                showNotification(`‚úÖ ${selected.length} Systeme erfolgreich exportiert!`);
                document.body.removeChild(modal);
            });
            
            // Cancel Button
            modal.querySelector('#cancelBatchBtn').addEventListener('click', () => {
                document.body.removeChild(modal);
            });
            
            // Close on background click
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            });
        }
        
        // ============================================================
        // [SECTION-13] UI UPDATE FUNKTIONEN
        // ============================================================
        // HIER: Aktualisierung der Benutzeroberfl√§che
        // √ÑNDERN: Um neue UI-Elemente zu aktualisieren
        // TIPP: Diese Funktionen werden nach jeder √Ñnderung aufgerufen

        // Cumulative Orbit Calculation (unchanged from V5)
        function calculateCumulativeOrbitDistances() {
            const result = [];
            let currentDistance = 0;
            
            // Filtere Sterne aus der Berechnung
            const planetsOnly = solarSystem.planets.filter(p => !p.isStar && p.type !== 'star');
            
            planetsOnly.forEach((planet, index) => {
                if (planet.orbitDistance === 0 && index === 0) {
                    // First planet with 0 distance gets default
                    currentDistance = 40;
                } else if (planet.orbitDistance > 0) {
                    // Add to cumulative distance
                    currentDistance += planet.orbitDistance;
                }
                // If orbitDistance === 0 and not first planet, keep currentDistance
                
                result.push({
                    planet: planet,
                    actualDistance: currentDistance,
                    isNewOrbit: planet.orbitDistance > 0 || index === 0
                });
                
                // Apply change_orbit for next planet
                if (planet.changeOrbit > 0) {
                    currentDistance += planet.changeOrbit;
                }
            });
            
            return result;
        }

        // UI Update Functions
        function updatePlanetList() {
            elements.planetList.innerHTML = '';
            
            if (solarSystem.planets.length === 0) {
                elements.planetList.innerHTML = '<p class="text-gray-400">F√ºgen Sie Planeten hinzu, um mit dem Systembau zu beginnen.</p>';
                return;
            }

            const cumulativeOrbits = calculateCumulativeOrbitDistances();

            cumulativeOrbits.forEach((orbitData, index) => {
                const planet = orbitData.planet;
                const actualDistance = orbitData.actualDistance;
                const isNewOrbit = orbitData.isNewOrbit;
                
                const planetItem = createPlanetListItem(planet, index, isNewOrbit, false, actualDistance);
                elements.planetList.appendChild(planetItem);

                if (planet.moons && planet.moons.length > 0) {
                    planet.moons.forEach(moon => {
                        const moonItem = createPlanetListItem(moon, -1, false, true, 0);
                        elements.planetList.appendChild(moonItem);
                    });
                }
            });
        }

        function createPlanetListItem(celestial, index, isNewOrbit = false, isMoon = false, actualDistance = 0) {
            const item = document.createElement('div');
            item.className = `celestial-item ${selectedPlanet && selectedPlanet.id === celestial.id ? 'selected' : ''} ${isNewOrbit ? 'new-orbit' : 'same-orbit'} ${isMoon ? 'ml-6' : ''}`;
            item.dataset.id = celestial.id;
            
            const icon = getPlanetIcon(celestial.class);
            const typeText = isMoon ? 'Mond' : 'Planet';
            
            let orbitInfo = '';
            if (!isMoon) {
                if (isNewOrbit) {
                    orbitInfo = `üü° +${celestial.orbitDistance} ‚Üí Gesamt: ${actualDistance}`;
                } else {
                    orbitInfo = `‚ö™ +0 ‚Üí Gleiche Umlaufbahn (${actualDistance})`;
                }
            }
            
            // Show modifier count
            let modifierInfo = '';
            if (celestial.modifiers && celestial.modifiers.length > 0) {
                modifierInfo = `<div class="text-xs text-green-300">üåø ${celestial.modifiers.length} Modifier</div>`;
            }
            
            item.innerHTML = `
                <div class="flex items-center">
                    <span class="text-2xl mr-2">${icon}</span>
                    <div>
                        <div class="font-medium">${isMoon ? '‚Ü≥ ' : `${index + 1}. `}${celestial.displayName}</div>
                        <div class="text-sm text-gray-400">${getClassDisplayName(celestial.class)} ‚Ä¢ Gr√∂√üe ${celestial.size}</div>
                        ${orbitInfo ? `<div class="text-xs text-blue-300">${orbitInfo}</div>` : ''}
                        ${modifierInfo}
                    </div>
                </div>
                <button class="stellaris-btn stellaris-btn-secondary text-sm px-2 py-1" onclick="selectPlanet(${celestial.id})">
                    Ausw√§hlen
                </button>
            `;
            
            item.addEventListener('click', (e) => {
                if (e.target.tagName !== 'BUTTON') {
                    selectPlanet(celestial.id);
                }
            });
            
            return item;
        }

        // ============================================================
        // [SECTION-14] VISUALISIERUNG (CANVAS)
        // ============================================================
        // HIER: Rendering des Solar Systems im Canvas
        // √ÑNDERN: Um visuelle Darstellung anzupassen
        // TIPP: 
        // - visualizerScale f√ºr Zoom-Stufe
        // - getColorForClass() f√ºr Planetenfarben
        // - drawCelestial() f√ºr einzelne Objekte

        // Visualization (unchanged from V5)
        function renderVisualizer() {
            elements.visualizer.innerHTML = '';

            const centerX = elements.visualizer.offsetWidth / 2;
            const centerY = elements.visualizer.offsetHeight / 2;

            // Finde den tats√§chlichen Stern aus dem planets-Array
            const star = solarSystem.planets.find(p => p.isStar || p.type === 'star');
            
            // Draw the star
            const starSize = star ? Math.max(20, star.size * visualizerScale * 0.6) : 30 * visualizerScale;
            const starEl = document.createElement('div');
            starEl.className = 'stellaris-star';
            starEl.style.width = `${starSize}px`;
            starEl.style.height = `${starSize}px`;
            starEl.style.left = `${centerX - starSize / 2}px`;
            starEl.style.top = `${centerY - starSize / 2}px`;
            starEl.style.borderRadius = '50%';
            starEl.style.position = 'absolute';
            
            // Verwende die tats√§chliche Sternfarbe
            if (star) {
                starEl.style.background = getColorForClass(star.class);
                starEl.title = `${star.displayName} (${getClassDisplayName(star.class)})`;
            } else {
                starEl.style.background = 'radial-gradient(circle, #ffeb3b, #ffa726)';
            }
            
            elements.visualizer.appendChild(starEl);

            // Draw neighbor system indicators - HINZUF√úGEN
            solarSystem.neighborSystems.forEach((neighbor, index) => {
                const angle = (index * 360 / solarSystem.neighborSystems.length) * Math.PI / 180;
                const distance = 200 * visualizerScale;
                const x = centerX + distance * Math.cos(angle);
                const y = centerY + distance * Math.sin(angle);

                // Draw connection line
                const line = document.createElement('div');
                line.style.position = 'absolute';
                line.style.width = `${distance}px`;
                line.style.height = '1px';
                line.style.background = 'rgba(153, 102, 255, 0.3)';
                line.style.left = `${centerX}px`;
                line.style.top = `${centerY}px`;
                line.style.transformOrigin = '0 0';
                line.style.transform = `rotate(${angle}rad)`;
                elements.visualizer.appendChild(line);

                // Draw neighbor system
                const neighborEl = document.createElement('div');
                neighborEl.style.position = 'absolute';
                neighborEl.style.width = '20px';
                neighborEl.style.height = '20px';
                neighborEl.style.left = `${x - 10}px`;
                neighborEl.style.top = `${y - 10}px`;
                neighborEl.style.background = 'linear-gradient(45deg, #9966ff, #6633cc)';
                neighborEl.style.borderRadius = '50%';
                neighborEl.style.border = '2px solid rgba(153, 102, 255, 0.5)';
                neighborEl.style.boxShadow = '0 0 10px rgba(153, 102, 255, 0.5)';
                neighborEl.title = neighbor.initializer || 'Random System';
                elements.visualizer.appendChild(neighborEl);
            });

            // Draw multiple asteroid belts - HINZUF√úGEN
            solarSystem.asteroidBelts.forEach(belt => {
                const beltRadius = belt.radius * visualizerScale;
                const beltEl = document.createElement('div');
                beltEl.className = 'asteroid-belt';
                beltEl.style.width = `${beltRadius * 2}px`;
                beltEl.style.height = `${beltRadius * 2}px`;
                beltEl.style.left = `${centerX - beltRadius}px`;
                beltEl.style.top = `${centerY - beltRadius}px`;
                elements.visualizer.appendChild(beltEl);
            });

            // Calculate cumulative orbits and draw planets
            const cumulativeOrbits = calculateCumulativeOrbitDistances();
            const drawnOrbits = new Set();

            cumulativeOrbits.forEach((orbitData, index) => {
                const actualDistance = orbitData.actualDistance;
                const planet = orbitData.planet;
                
                // Draw orbit ring if we haven't drawn it yet
                const orbitRadius = actualDistance * visualizerScale;
                if (orbitRadius > starSize / 2 + 10 && !drawnOrbits.has(actualDistance)) {
                    drawnOrbits.add(actualDistance);
                    const orbitEl = document.createElement('div');
                    orbitEl.className = 'orbit-indicator';
                    orbitEl.style.width = `${orbitRadius * 2}px`;
                    orbitEl.style.height = `${orbitRadius * 2}px`;
                    orbitEl.style.left = `${centerX - orbitRadius}px`;
                    orbitEl.style.top = `${centerY - orbitRadius}px`;
                    elements.visualizer.appendChild(orbitEl);
                }

                // Draw planet
                drawCelestial(planet, centerX, centerY, orbitRadius, index * 45);
            });
        }

        function drawCelestial(celestial, parentX, parentY, distance, baseAngle = 0, starCenterX = null, starCenterY = null) {
            // Wenn starCenter nicht √ºbergeben wurde, ist parentX/Y das Stern-Zentrum (Planet-Fall)
            if (starCenterX === null) starCenterX = parentX;
            if (starCenterY === null) starCenterY = parentY;
            let angle = baseAngle;
            if (celestial.orbitAngleType === 'fixed') {
                angle = celestial.orbitAngle || 0;
            } else {
                // For range, use middle of range for visualization
                const min = celestial.orbitAngleMin || 90;
                const max = celestial.orbitAngleMax || 270;
                angle = (min + max) / 2;
            }

            const angleRad = (angle * Math.PI) / 180;
            const x = parentX + distance * Math.cos(angleRad);
            const y = parentY + distance * Math.sin(angleRad);

            // Draw celestial body
            const size = Math.max(8, celestial.size * visualizerScale * 0.8);
            const bodyEl = document.createElement('div');
            bodyEl.className = celestial.type;
            bodyEl.style.width = `${size}px`;
            bodyEl.style.height = `${size}px`;
            bodyEl.style.left = `${x - size / 2}px`;
            bodyEl.style.top = `${y - size / 2}px`;
            bodyEl.style.background = getColorForClass(celestial.class);
            bodyEl.style.position = 'absolute';
            bodyEl.style.borderRadius = '50%';
            bodyEl.style.display = 'flex';
            bodyEl.style.justifyContent = 'center';
            bodyEl.style.alignItems = 'center';
            bodyEl.style.fontSize = '0.7rem';
            bodyEl.style.fontWeight = '600';
            bodyEl.style.color = 'white';
            bodyEl.style.textShadow = '0 0 5px rgba(0,0,0,0.8)';
            bodyEl.style.cursor = 'pointer';
            bodyEl.textContent = celestial.displayName.substring(0, 3);
            
            // Add modifier indicator
            if (celestial.modifiers && celestial.modifiers.length > 0) {
                bodyEl.style.border = '3px solid #48bb78';
                bodyEl.style.boxShadow = '0 0 10px rgba(72, 187, 120, 0.5)';
            }
            
            bodyEl.addEventListener('click', () => selectPlanet(celestial.id));
            elements.visualizer.appendChild(bodyEl);

            // Draw ring system if present
            if (celestial.hasRing) {
                const ringEl = document.createElement('div');
                ringEl.style.position = 'absolute';
                ringEl.style.width = `${size * 1.8}px`;
                ringEl.style.height = `${size * 1.8}px`;
                ringEl.style.left = `${x - (size * 1.8) / 2}px`;
                ringEl.style.top = `${y - (size * 1.8) / 2}px`;
                ringEl.style.border = '2px solid rgba(255, 255, 255, 0.4)';
                ringEl.style.borderRadius = '50%';
                ringEl.style.pointerEvents = 'none';
                elements.visualizer.appendChild(ringEl);
            }

            // Draw moons around the planet (not from star center!)
            if (celestial.moons && celestial.moons.length > 0) {
                let currentMoonDistance = 0; // Start at 0, relative to planet
                
                    celestial.moons.forEach((moon, moonIndex) => {
                        if (moon.orbitDistance === 0 && moonIndex === 0) {
                            // First moon with 0 distance gets default
                            currentMoonDistance = 10 * visualizerScale;
                        } else if (moon.orbitDistance > 0) {
                            // Add to cumulative distance (relative to planet)
                            currentMoonDistance += moon.orbitDistance * visualizerScale;
                        }
                        // If orbitDistance === 0 and not first moon, keep currentMoonDistance
                        
                        // Zeichne kleinen Orbit-Ring UM DEN PLANETEN herum
                        const moonOrbitEl = document.createElement('div');
                        moonOrbitEl.className = 'orbit-indicator moon-orbit';
                        moonOrbitEl.style.width = `${currentMoonDistance * 2}px`;
                        moonOrbitEl.style.height = `${currentMoonDistance * 2}px`;
                        moonOrbitEl.style.left = `${x - currentMoonDistance}px`;
                        moonOrbitEl.style.top = `${y - currentMoonDistance}px`;
                        moonOrbitEl.style.borderColor = 'rgba(255, 255, 255, 0.2)';
                        moonOrbitEl.style.borderWidth = '1px';
                        moonOrbitEl.style.borderStyle = 'dashed';
                        elements.visualizer.appendChild(moonOrbitEl);
                        
                        // Mond-Position relativ zum Planeten
                        drawCelestial(moon, x, y, currentMoonDistance, moonIndex * 120, starCenterX, starCenterY);
                    });
                }
            }    

        // ============================================================
        // [SECTION-15] HELPER FUNKTIONEN (ICONS, FARBEN, ETC.)
        // ============================================================
        // HIER: Hilfsfunktionen f√ºr Icons, Farben, Namen
        // √ÑNDERN: 
        // - getPlanetIcon(): Um neue Planet-Icons hinzuzuf√ºgen
        // - getClassDisplayName(): F√ºr deutsche √úbersetzungen
        // - getColorForClass(): F√ºr Planetenfarben im Visualizer
        // - getStarIcon(): F√ºr Stern-Icons in Nachbarsystemen
        // 
        // TIPP: Emojis k√∂nnen direkt eingef√ºgt werden: üåç üî¥ ‚≠ê

        // Helper Functions
        function getPlanetIcon(planetClass) {
            const icons = {
                // Stars
                'pc_b_star': 'üíô', 'pc_a_star': '‚ö™', 'pc_f_star': 'üíõ', 'pc_g_star': '‚òâ', 'pc_k_star': 'üß°', 'pc_m_star': 'üî¥',
                'pc_black_hole': '‚ö´', 'pc_neutron_star': '‚ö´', 'pc_pulsar': 'üåü', 'pc_brown_dwarf': 'üü§',
                
                // Habitable Worlds
                'pc_continental': 'üåç', 'pc_ocean': 'üåä', 'pc_tropical': 'üå¥',
                'pc_arid': 'üèúÔ∏è', 'pc_desert': 'üèúÔ∏è', 'pc_savannah': 'üåæ',
                'pc_arctic': 'üßä', 'pc_tundra': '‚ùÑÔ∏è', 'pc_alpine': 'üèîÔ∏è',
                'pc_gaia': 'üåø',
                
                // Uninhabitable Worlds
                'pc_barren': 'üåë', 'pc_barren_cold': '‚òÑÔ∏è', 'pc_frozen': '‚òÑÔ∏è',
                'pc_molten': 'üî•', 'pc_toxic': '‚ò¢Ô∏è', 'pc_hothouse': 'üî•',
                'pc_gas_giant': 'ü™ê', 'pc_hot_gas_giant': 'üî•', 'pc_cold_gas_giant': '‚ùÑÔ∏è', 'pc_dwarf_gas_giant': 'üåå',
                'pc_storm': '‚õàÔ∏è', 'pc_nuked': 'üí•', 'pc_shattered': 'üí•',
                'pc_asteroid': '‚òÑÔ∏è', 'pc_subglacial': 'üßä',
                
                // Special Worlds
                'pc_relic': 'üõõÔ∏è', 'pc_habitat': 'üõ∞Ô∏è', 'pc_ecumenopolis': 'üèôÔ∏è',
                'pc_machine': 'ü§ñ', 'pc_hive': 'ü™≤', 'pc_shielded': 'üõ°Ô∏è',
                
                // Gigastructural Engineers
                'pc_birch': 'üå≥', 'pc_alderson': 'üíø', 'pc_gas_giant_habitable': 'ü™ê', 
                'pc_stellar_systemcraft': 'üöÄ', 'pc_nicoll_dyson_beam': '‚ö°', 'pc_penrose_sphere_habitable': '‚ö´',
                'pc_virtual_reality': 'üíª', 'pc_pouchkinn_planet': 'üåü', 'pc_gigastructural_shielded': 'üõ°Ô∏è',
                'pc_quasi_stellar_obliterator': '‚≠ê', 'pc_neutronium_gigaforge': '‚öíÔ∏è',
                
                // Planetary Diversity - Gaia & Special
                'pd_wet_gaia_world': 'üåø', 'pd_dry_gaia_world': 'üåø', 'pd_cold_gaia_world': 'üåø',
                'pd_wet_cave_world': 'üï≥Ô∏è', 'pd_dry_cave_world': 'üï≥Ô∏è', 'pd_cold_cave_world': 'üï≥Ô∏è',
                'pd_wet_superhabitable_world': 'üå∫', 'pd_dry_superhabitable_world': 'üå∫', 'pd_cold_superhabitable_world': 'üå∫',
                'pd_wet_tidally_locked_world': 'üåó', 'pd_dry_tidally_locked_world': 'üåó', 'pd_cold_tidally_locked_world': 'üåó',
                
                // Planetary Diversity - Uncommon
                'pc_superhabitable': 'üå∫', 'pc_tidally_locked': 'üåó', 'pc_mantle': 'üåã', 'pc_karst': 'ü™®',
                'pc_crystal': 'üíé', 'pc_frozen_desert': 'üèîÔ∏è', 'pc_ash': 'üåã', 'pc_marginal': 'üå´Ô∏è',
                'pc_sandsea': 'üèñÔ∏è', 'pc_technoorganic': 'üî¨'
            };
            return icons[planetClass] || 'üåå';
        }

        function getClassDisplayName(planetClass) {
            const names = {
                // Stars
                'pc_b_star': 'B-Stern', 'pc_a_star': 'A-Stern', 'pc_f_star': 'F-Stern',
                'pc_g_star': 'G-Stern', 'pc_k_star': 'K-Stern', 'pc_m_star': 'M-Stern',
                'pc_black_hole': 'Schwarzes Loch', 'pc_neutron_star': 'Neutronenstern',
                'pc_pulsar': 'Pulsar', 'pc_brown_dwarf': 'Brauner Zwerg',
                
                // Habitable Worlds
                'pc_continental': 'Kontinental', 'pc_ocean': 'Ozean', 'pc_tropical': 'Tropisch',
                'pc_arid': 'Arid', 'pc_desert': 'W√ºste', 'pc_savannah': 'Savanne',
                'pc_arctic': 'Arktisch', 'pc_tundra': 'Tundra', 'pc_alpine': 'Alpin',
                'pc_gaia': 'Gaia',
                
                // Uninhabitable Worlds
                'pc_barren': 'Karg', 'pc_barren_cold': 'Karg (Kalt)', 'pc_frozen': 'Gefroren',
                'pc_molten': 'Geschmolzen', 'pc_toxic': 'Toxisch', 'pc_hothouse': 'Treibhaus',
                'pc_gas_giant': 'Gasriese', 'pc_hot_gas_giant': 'Hei√üer Gasriese',
                'pc_cold_gas_giant': 'Kalter Gasriese', 'pc_dwarf_gas_giant': 'Zwerg-Gasriese',
                'pc_storm': 'Sturm', 'pc_nuked': 'Verstrahlt', 'pc_shattered': 'Zerst√∂rt',
                'pc_asteroid': 'Asteroid', 'pc_subglacial': 'Subglazial',
                
                // Special Worlds
                'pc_relic': 'Relikt', 'pc_habitat': 'Habitat', 'pc_ecumenopolis': '√ñkumenopolis',
                'pc_machine': 'Maschine', 'pc_hive': 'Schwarm', 'pc_shielded': 'Abgeschirmt',
                
                // Gigastructural Engineers
                'pc_birch': 'Birch-Welt', 'pc_alderson': 'Alderson-Scheibe',
                'pc_gas_giant_habitable': 'Bewohnbarer Gasriese', 'pc_stellar_systemcraft': 'Stellares Systemschiff',
                'pc_nicoll_dyson_beam': 'Nicoll-Dyson-Strahl-Ziel', 'pc_penrose_sphere_habitable': 'Penrose-Sph√§re Habitat',
                'pc_virtual_reality': 'Virtual Reality Welt', 'pc_pouchkinn_planet': 'Pouchkinn Planet',
                'pc_gigastructural_shielded': 'Gigastruktureller Schild', 'pc_quasi_stellar_obliterator': 'Quasi-Stellar Obliterator',
                'pc_neutronium_gigaforge': 'Neutronium Gigaforge',
                
                // Planetary Diversity (shortened for space, add more as needed)
                'pd_retinal_world': 'Retinal-Welt', 'pd_lake_world': 'Seen-Welt', 'pd_mushroom_world': 'Pilz-Welt',
                'pd_dune_world': 'D√ºnen-Welt', 'pd_glacial_world': 'Gletscher-Welt',
                'pc_superhabitable': 'Superbewohnbar', 'pc_tidally_locked': 'Gezeitengebunden',
                'pc_mantle': 'Mantel-Welt', 'pc_crystal': 'Kristall-Welt'
            };
            return names[planetClass] || planetClass;
        }

        function getColorForClass(className) {
            const colors = {
                // Habitable Worlds
                // Stars
                'pc_b_star': 'linear-gradient(45deg, #4299e1, #3182ce)',
                'pc_a_star': 'linear-gradient(45deg, #f7fafc, #edf2f7)',
                'pc_f_star': 'linear-gradient(45deg, #faf089, #f6e05e)',
                'pc_g_star': 'linear-gradient(45deg, #f6e05e, #ecc94b)',
                'pc_k_star': 'linear-gradient(45deg, #ed8936, #dd6b20)',
                'pc_m_star': 'linear-gradient(45deg, #e53e3e, #c53030)',
                
                // Habitable Worlds
                'pc_continental': 'linear-gradient(45deg, #38b2ac, #4299e1)',
                'pc_ocean': 'linear-gradient(45deg, #4299e1, #3182ce)',
                'pc_tropical': 'linear-gradient(45deg, #48bb78, #38a169)',
                'pc_arid': 'linear-gradient(45deg, #f6ad55, #ed8936)',
                'pc_desert': 'linear-gradient(45deg, #ecc94b, #d69e2e)',
                'pc_savannah': 'linear-gradient(45deg, #ed8936, #dd6b20)',
                'pc_arctic': 'linear-gradient(45deg, #a0aec0, #718096)',
                'pc_tundra': 'linear-gradient(45deg, #718096, #4a5568)',
                'pc_alpine': 'linear-gradient(45deg, #cbd5e0, #a0aec0)',
                'pc_gaia': 'linear-gradient(45deg, #68d391, #48bb78)',
                
                // Uninhabitable Worlds
                'pc_barren': 'linear-gradient(45deg, #718096, #4a5568)',
                'pc_barren_cold': 'linear-gradient(45deg, #a0aec0, #718096)',
                'pc_frozen': 'linear-gradient(45deg, #bee3f8, #90cdf4)',
                'pc_molten': 'linear-gradient(45deg, #e53e3e, #c53030)',
                'pc_toxic': 'linear-gradient(45deg, #805ad5, #6b46c1)',
                'pc_gas_giant': 'linear-gradient(45deg, #9f7aea, #805ad5)',
                'pc_nuked': 'linear-gradient(45deg, #a3bffa, #7c3aed)',
                'pc_asteroid': 'linear-gradient(45deg, #718096, #4a5568)',
                
                // Special Worlds
                'pc_relic': 'linear-gradient(45deg, #d69e2e, #b7791f)',
                'pc_habitat': 'linear-gradient(45deg, #a0aec0, #718096)',
                'pc_ecumenopolis': 'linear-gradient(45deg, #fed7d7, #fc8181)',
                'pc_machine': 'linear-gradient(45deg, #4a5568, #2d3748)',
                'pc_hive': 'linear-gradient(45deg, #9f7aea, #805ad5)',
                'pc_shielded': 'linear-gradient(45deg, #e2e8f0, #cbd5e0)',
                
                // Gigastructural Engineers
                'pc_birch': 'linear-gradient(45deg, #276749, #38a169)',
                'pc_alderson': 'linear-gradient(45deg, #4a5568, #2d3748)',
                'pc_gas_giant_habitable': 'linear-gradient(45deg, #48bb78, #805ad5)',
                'pc_stellar_systemcraft': 'linear-gradient(45deg, #e2e8f0, #a0aec0)',
                'pc_nicoll_dyson_beam': 'linear-gradient(45deg, #f6e05e, #e53e3e)',
                'pc_penrose_sphere_habitable': 'linear-gradient(45deg, #2d3748, #1a202c)',
                'pc_virtual_reality': 'linear-gradient(45deg, #667eea, #764ba2)',
                'pc_pouchkinn_planet': 'linear-gradient(45deg, #f093fb, #f5576c)',
                'pc_gigastructural_shielded': 'linear-gradient(45deg, #4fd1c7, #06bfa5)',
                
                // Add more Planetary Diversity colors as needed
                'pd_retinal_world': 'linear-gradient(45deg, #fc8181, #e53e3e)',
                'pd_lake_world': 'linear-gradient(45deg, #4299e1, #3182ce)',
                'pd_mushroom_world': 'linear-gradient(45deg, #805ad5, #38a169)',
                'pd_dune_world': 'linear-gradient(45deg, #ecc94b, #d69e2e)',
                'pd_glacial_world': 'linear-gradient(45deg, #bee3f8, #90cdf4)',
                'pc_superhabitable': 'linear-gradient(45deg, #68d391, #38b2ac)',
                'pc_crystal': 'linear-gradient(45deg, #9f7aea, #bee3f8)'
            };
            return colors[className] || 'linear-gradient(45deg, #e2e8f0, #cbd5e0)';
        }

        function getStarClassForSystemClass(systemClass) {
            const mapping = {
                'sc_b': 'pc_b_star',
                'sc_a': 'pc_a_star',
                'sc_f': 'pc_f_star',
                'sc_o': 'pc_o_star',
                'sc_b': 'pc_b_star',
                'sc_a': 'pc_a_star',
                'sc_f': 'pc_f_star',
                'sc_g': 'pc_g_star',
                'sc_k': 'pc_k_star',
                'sc_m': 'pc_m_star',
                'sc_t': 'pc_t_star',
                'sc_m_giant': 'pc_m_star',
                'sc_toxoid_star': 'pc_toxoid_star',
                'sc_rift_star': 'pc_rift_star'
            };
            return mapping[systemClass] || 'pc_g_star';
        }

        // ============================================================
        // [SECTION-16] EVENT LISTENER INITIALISIERUNG
        // ============================================================
        // HIER: Alle Event-Handler f√ºr Buttons, Inputs, etc.
        // √ÑNDERN: Um neue Buttons/Felder zu verkn√ºpfen
        // WICHTIG: 
        // - Pr√ºfe mit if() ob Element existiert vor addEventListener
        // - Verwende () => {} f√ºr anonyme Funktionen
        // - Nutze updateOutput() nach jeder √Ñnderung
        // 
        // STRUKTUR:
        // 1. System-Properties (Name, Klasse, Usage)
        // 2. Nachbarsystem-Controls
        // 3. Asteroideng√ºrtel-Controls
        // 4. Planeten-Controls
        // 5. Planet-Eigenschaften
        // 6. Modifier-System
        // 7. Visualizer-Controls
        // 8. Export-Buttons
        // 9. V7-Features (Flags, Variationen)

        // Event handlers and property updates
        function updateSelectedPlanetProperty(property) {
            return (e) => {
                if (selectedPlanet) {
                    selectedPlanet[property] = e.target.value;
                    updatePlanetList();
                    updateOutput();
                    renderVisualizer();
                }
            };
        }

        function updateOutput() {
            elements.exportTxt.value = generateStellarisTxt();
            elements.exportYml.value = generateStellarisYml();
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 bg-blue-600 text-white px-4 py-2 rounded shadow-lg z-50';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showNotification(`Datei "${filename}" wurde erfolgreich heruntergeladen!`);
        }

        // ============================================================
        // [SECTION-16] EVENT LISTENER INITIALISIERUNG
        // ============================================================
        // (Siehe Marker oben f√ºr Details)

        // Event Listeners
        function initializeEventListeners() {
            // System properties
            elements.systemName.addEventListener('input', (e) => {
                const value = e.target.value.replace(/[^a-zA-Z0-9_]/g, '');
                e.target.value = value;
                solarSystem.name = value || 'my_custom_system';
                updateOutput();
            });

            elements.systemDisplayName.addEventListener('input', (e) => {
                solarSystem.displayName = e.target.value || 'Unbenanntes System';
                updateOutput();
            });

            elements.systemUsage.addEventListener('change', (e) => {
                solarSystem.usage = e.target.value;
                updateOutput();
            });

                // ============================================
                // Import/Clear System Event Listeners
                // ============================================
                elements.importBtn.addEventListener('click', importSystem);
                elements.clearSystemBtn.addEventListener('click', () => {
                    if (confirm('M√∂chten Sie wirklich das gesamte System leeren? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.')) {
                        clearSystem();
                    }
                });

                // ========== NEU: BATCH-EXPORT BUTTON ========== 
                const batchExportBtn = document.getElementById('batchExportBtn');
                if (batchExportBtn) {
                    batchExportBtn.addEventListener('click', showBatchExportDialog);
                }
            }
            
            // ============================================
            // Neighbor Systems Event Listeners - KORRIGIERT
            // ============================================
            if (elements.addNeighborBtn) {
                elements.addNeighborBtn.addEventListener('click', addNeighborSystem);
            }

            const neighborModeSelect = document.getElementById('neighborMode');
            if (neighborModeSelect) {
                neighborModeSelect.addEventListener('change', toggleNeighborCustomFields);
            }
            
            // Asteroid belt listeners - HINZUF√úGEN
            elements.addAsteroidBeltBtn.addEventListener('click', addAsteroidBelt);

            // Planet management - KORRIGIERT
            if (elements.addPlanetBtn) {
                elements.addPlanetBtn.addEventListener('click', addPlanet);
            }

            // Move planet buttons
            if (elements.moveUpBtn) {
                elements.moveUpBtn.addEventListener('click', movePlanetUp);
            }
            if (elements.moveDownBtn) {
                elements.moveDownBtn.addEventListener('click', movePlanetDown);
            }

            elements.orbitAngleType.addEventListener('change', (e) => {
                const type = e.target.value;
                const isRange = type === 'range';
                const isFixed = type === 'fixed';
                const isShared = type.startsWith('shared_');
                
                elements.fixedAngleControl.classList.toggle('hidden', !isFixed);
                elements.rangeAngleControl.classList.toggle('hidden', !isRange);
                
                if (selectedPlanet) {
                    selectedPlanet.orbitAngleType = type;
                    
                    // Bei Shared Orbit: Setze automatisch den entsprechenden Winkel
                    if (isShared) {
                        const angle = parseInt(type.split('_')[1]);
                        selectedPlanet.orbitAngle = angle;
                        
                        // Zeige Info √ºber den gew√§hlten Shared Orbit
                        const objectCount = {
                            180: '2 Objekte',
                            120: '3 Objekte',
                            90: '4 Objekte',
                            60: '6 Objekte'
                        }[angle];
                        
                        showNotification(`‚úÖ Shared Orbit ${angle}¬∞ aktiviert (${objectCount} gleichm√§√üig verteilt)`, 'info');
                    }
                    
                    updateOutput();
                    updatePlanetList();
                }
            });

            // Planet property updates
            elements.celestialName.addEventListener('input', updateSelectedPlanetProperty('name'));
            elements.celestialDisplayName.addEventListener('input', updateSelectedPlanetProperty('displayName'));
            elements.celestialClass.addEventListener('change', (e) => {
                if (selectedPlanet) {
                    const newClass = e.target.value;
                    
                    // Warnung wenn Stern-Klasse f√ºr kleinen Planeten gew√§hlt wird
                    const starClasses = ['pc_b_star', 'pc_a_star', 'pc_f_star', 'pc_g_star', 'pc_k_star', 'pc_m_star',
                                        'pc_black_hole', 'pc_neutron_star', 'pc_pulsar'];
                    if (starClasses.includes(newClass) && selectedPlanet.size < 30 && !selectedPlanet.isStar) {
                        showNotification('‚ö†Ô∏è Warnung: Stern-Klassen sind normalerweise nur f√ºr zentrale Sterne (Gr√∂√üe >30) gedacht. F√ºr Planeten w√§hle eine Planeten-Klasse.');
                    }
                    
                    selectedPlanet.class = newClass;
                    updatePlanetList();
                    updateOutput();
                    renderVisualizer();
                    
                    // Reset modifier selection when class changes as available modifiers change
                    elements.modifierCategory.value = '';
                    elements.modifierType.innerHTML = '<option value="">-- Erst Kategorie w√§hlen --</option>';
                    elements.modifierType.disabled = true;
                    elements.addModifierBtn.disabled = true;
                }
            });
            
            elements.celestialSize.addEventListener('input', (e) => {
                if (selectedPlanet) {
                    selectedPlanet.size = Math.max(1, Math.min(50, parseInt(e.target.value) || 1));
                    e.target.value = selectedPlanet.size;
                    updatePlanetList();
                    updateOutput();
                    renderVisualizer();
                }
            });
            
            elements.celestialOrbitDistance.addEventListener('input', (e) => {
                if (selectedPlanet) {
                    selectedPlanet.orbitDistance = Math.max(0, parseInt(e.target.value) || 0);
                    e.target.value = selectedPlanet.orbitDistance;
                    updatePlanetList();
                    updateOutput();
                    renderVisualizer();
                }
            });

            elements.celestialHasRing.addEventListener('change', (e) => {
                if (selectedPlanet) {
                    selectedPlanet.hasRing = e.target.checked;
                    updateOutput();
                    renderVisualizer();
                }
            });
            
            elements.celestialIsStartingPlanet.addEventListener('change', (e) => {
                if (selectedPlanet) {
                    selectedPlanet.isStartingPlanet = e.target.checked;
                    updateOutput();
                }
            });

            elements.addMoonBtn.addEventListener('click', addMoon);

            elements.deleteCelestialBtn.addEventListener('click', () => {
                if (!selectedPlanet) return;

                if (selectedPlanet.type === 'planet') {
                    solarSystem.planets = solarSystem.planets.filter(p => p.id !== selectedPlanet.id);
                } else if (selectedPlanet.type === 'moon') {
                    // Finde den Elternplaneten und entferne den Mond
                    solarSystem.planets.forEach(planet => {
                        if (planet.moons && planet.moons.length > 0) {
                            planet.moons = planet.moons.filter(m => m.id !== selectedPlanet.id);
                        }
                    });
                }

                deselectPlanet();
                updatePlanetList();
                updateOutput();
                renderVisualizer();
            });

            // Visualizer controls
            elements.zoomInBtn.addEventListener('click', () => {
                visualizerScale = Math.min(5.0, visualizerScale * 1.2);
                renderVisualizer();
            });
            elements.zoomOutBtn.addEventListener('click', () => {
                visualizerScale = Math.max(0.1, visualizerScale * 0.8);
                renderVisualizer();
            });
            elements.resetViewBtn.addEventListener('click', () => {
                visualizerScale = 0.3;
                renderVisualizer();
            });

            // Export buttons
            elements.downloadTxtBtn.addEventListener('click', () => {
                const enabledCount = Object.values(systemVariations).filter(v => v.enabled).length;
                const output = elements.exportTxt.value;
                
                if (enabledCount > 1) {
                    const filename = `${solarSystem.name}_${enabledCount}_variants.txt`;
                    downloadFile(output, filename, 'text/plain');
                    showNotification(`${enabledCount} Varianten exportiert!`);
                } else {
                    downloadFile(output, `${solarSystem.name}.txt`, 'text/plain');
                }
            });
            
            elements.downloadYmlBtn.addEventListener('click', () => {
                const bom = '\ufeff';
                downloadFile(bom + elements.exportYml.value, `${solarSystem.name}_l_german.yml`, 'text/plain;charset=utf-8');
            });
            
            // ============================================
            // V7 ADDITIONS - New Event Listeners
            // ============================================
            
            // System Flags
            const addSystemFlagBtn = document.getElementById('addSystemFlagBtn');
            if (addSystemFlagBtn) {
                addSystemFlagBtn.addEventListener('click', addSystemFlag);
            }
            
            const newSystemFlagInput = document.getElementById('newSystemFlag');
            if (newSystemFlagInput) {
                newSystemFlagInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') addSystemFlag();
                });
            }
            
            // Planet Flags
            const addPlanetFlagBtn = document.getElementById('addPlanetFlagBtn');
            if (addPlanetFlagBtn) {
                addPlanetFlagBtn.addEventListener('click', addPlanetFlag);
            }
            
            const newPlanetFlagInput = document.getElementById('newPlanetFlag');
            if (newPlanetFlagInput) {
                newPlanetFlagInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') addPlanetFlag();
                });
            }
            
            // Prevent Anomaly
            const preventAnomalyCheckbox = document.getElementById('celestialPreventAnomaly');
            if (preventAnomalyCheckbox) {
                preventAnomalyCheckbox.addEventListener('change', (e) => {
                    if (selectedPlanet) {
                        selectedPlanet.preventAnomaly = e.target.checked;
                        updateOutput();
                    }
                });
            }
            
            // Entity Override
            const entitySelect = document.getElementById('celestialEntity');
            if (entitySelect) {
                entitySelect.addEventListener('change', (e) => {
                    if (selectedPlanet) {
                        selectedPlanet.entityOverride = e.target.value || null;
                        updateOutput();
                        renderVisualizer();
                    }
                });
            }
            
            // Preview Variations Button
            const previewVariationsBtn = document.getElementById('previewVariationsBtn');
            if (previewVariationsBtn) {
                previewVariationsBtn.addEventListener('click', () => {
                    const enabledVariations = Object.values(systemVariations).filter(v => v.enabled);
                    const names = enabledVariations.map(v => `‚Ä¢ ${v.displayName}`).join('\n');
                    alert(`Aktivierte Varianten (${enabledVariations.length}):\n\n${names}\n\nBeim Export werden alle Varianten in einer kombinierten Datei generiert.`);
                });
            }
        
        // ============================================================
        // [SECTION-17] GLOBALE FUNKTIONEN & INITIALIZATION
        // ============================================================
        // HIER: Funktionen f√ºr window-Objekt und DOMContentLoaded
        // WICHTIG: Alle onclick-Handler im HTML brauchen window.*
        // √ÑNDERN: Neue onclick-Handler hier hinzuf√ºgen
        // 
        // INITIALISIERUNG:
        // 1. Event Listener registrieren
        // 2. Modifier System initialisieren
        // 3. UI-Listen aktualisieren
        // 4. Variationen rendern
        // 5. Output generieren

        // Make functions globally available
        window.selectPlanet = selectPlanet;
        window.removeModifier = removeModifier;
        window.removeAsteroidBelt = removeAsteroidBelt;
        window.removeNeighborSystem = removeNeighborSystem;
        window.editNeighborSystem = editNeighborSystem;
        window.addPlanetToNeighbor = addPlanetToNeighbor;
        window.removePlanetFromNeighbor = removePlanetFromNeighbor;
        window.removeNeighborPlanetDraft = removeNeighborPlanetDraft;
        window.collectCustomNeighborPlanets = collectCustomNeighborPlanets;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initializeEventListeners();
            initializeModifierSystem();
            initializeOriginMechanicsUI();  // ‚Üê NEUE ZEILE
            updateNeighborSystemsList();
            updateAsteroidBeltList();
            
            // V7 ADDITION - Initialize Variations and Flags
            initializeFilters();  // ‚Üê NEU HINZUF√úGEN
            renderVariationsList();
            updateSystemFlagsList();
            
            // Load default system
            elements.systemName.value = solarSystem.name;
            elements.systemDisplayName.value = solarSystem.displayName;
            elements.systemClass.value = solarSystem.class;
            elements.systemUsage.value = solarSystem.usage;
            
            updatePlanetList();
            updateOutput();
            renderVisualizer();
            
            showNotification('üöÄ V7 - System-Variationen & Erweiterte Kompatibilit√§t geladen!');
        });

        window.addEventListener('resize', () => {
            setTimeout(renderVisualizer, 100);
        });
        
        // ============================================================
        // [SECTION-17] GLOBALE FUNKTIONEN & INITIALIZATION
        // ============================================================
        // (Siehe Marker oben)
        
        // ============================================
        // V7 ADDITION - Global Functions for onclick handlers
        // ============================================
        window.removeSystemFlag = removeSystemFlag;
        window.removePlanetFlag = removePlanetFlag;
        window.toggleVariation = toggleVariation;
        window.quickAddSystemFlag = quickAddSystemFlag;

        /*
        ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
        ‚ïë              H√ÑUFIGE √ÑNDERUNGEN - QUICK REFERENCE                   ‚ïë
        ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
        
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ 1Ô∏è‚É£  NEUEN PLANETARY DIVERSITY MODIFIER HINZUF√úGEN                    ‚îÇ
        ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
        ‚îÇ WO:      [SECTION-02] ‚Üí MODIFIERS ‚Üí planetary_diversity             ‚îÇ
        ‚îÇ SUCHE:   "pc_continental:" (oder andere Planetenklasse)             ‚îÇ
        ‚îÇ AKTION:  F√ºge neuen Modifier nach diesem Muster hinzu:              ‚îÇ
        ‚îÇ                                                                      ‚îÇ
        ‚îÇ   "pd_dein_neuer_modifier": {                                       ‚îÇ
        ‚îÇ       name: "Dein Modifier Name",                                   ‚îÇ
        ‚îÇ       description: "Beschreibung was er macht"                      ‚îÇ
        ‚îÇ   }                                                                  ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ 2Ô∏è‚É£  NEUE PLANETENKLASSE HINZUF√úGEN                                   ‚îÇ
        ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
        ‚îÇ 1. HTML ‚Üí <select id="celestialClass"> ‚Üí Neue <option> hinzuf√ºgen  ‚îÇ
        ‚îÇ 2. [SECTION-15] ‚Üí getPlanetIcon() ‚Üí Icon hinzuf√ºgen                ‚îÇ
        ‚îÇ 3. [SECTION-15] ‚Üí getClassDisplayName() ‚Üí Namen hinzuf√ºgen         ‚îÇ
        ‚îÇ 4. [SECTION-15] ‚Üí getColorForClass() ‚Üí Farbe hinzuf√ºgen            ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ 3Ô∏è‚É£  NEUE ORIGIN-VARIANTE HINZUF√úGEN                                  ‚îÇ
        ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
        ‚îÇ WO:      [SECTION-03] ‚Üí systemVariations                            ‚îÇ
        ‚îÇ AKTION:  Kopiere eine bestehende Variante (z.B. commonwealth)      ‚îÇ
        ‚îÇ          und √§ndere:                                                 ‚îÇ
        ‚îÇ   - id: eindeutiger Bezeichner                                      ‚îÇ
        ‚îÇ   - suffix: wird an Systemnamen angeh√§ngt                           ‚îÇ
        ‚îÇ   - displayName: Anzeigename f√ºr User                               ‚îÇ
        ‚îÇ   - icon: Emoji f√ºr die Card                                        ‚îÇ
        ‚îÇ   - modifications: Welche √Ñnderungen am System                      ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ 4Ô∏è‚É£  STANDARD-PLANET-WERTE √ÑNDERN                                     ‚îÇ
        ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
        ‚îÇ WO:      [SECTION-08] ‚Üí addPlanet()                                 ‚îÇ
        ‚îÇ SUCHE:   "const newPlanet = {"                                      ‚îÇ
        ‚îÇ √ÑNDERE:  - class: Standard-Planetenklasse                           ‚îÇ
        ‚îÇ          - size: Standard-Gr√∂√üe                                     ‚îÇ
        ‚îÇ          - orbitDistance: Anfangsabstand                            ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ 5Ô∏è‚É£  STELLARIS CODE-OUTPUT ANPASSEN                                   ‚îÇ
        ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
        ‚îÇ WO:      [SECTION-12] ‚Üí generateSingleVariant()                     ‚îÇ
        ‚îÇ TIPP:    Suche nach bestimmten Stellaris-Befehlen (z.B. "flags =") ‚îÇ
        ‚îÇ WICHTIG: Achte auf korrekte Tab-Einr√ºckung (\t)                    ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ 6Ô∏è‚É£  NEUE BUTTON/INPUT HINZUF√úGEN                                     ‚îÇ
        ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
        ‚îÇ 1. HTML ‚Üí Neues Element mit eindeutiger id="" erstellen            ‚îÇ
        ‚îÇ 2. [SECTION-04] ‚Üí elements ‚Üí getElementById hinzuf√ºgen              ‚îÇ
        ‚îÇ 3. [SECTION-16] ‚Üí initializeEventListeners() ‚Üí Event hinzuf√ºgen    ‚îÇ
        ‚îÇ 4. Bei onclick im HTML: Funktion in window.* verf√ºgbar machen      ‚îÇ
        ‚îÇ    (siehe [SECTION-17] ‚Üí window.deineFunktion = ...)               ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ 7Ô∏è‚É£  VISUALIZER ANPASSEN (FARBEN, GR√ñSSEN)                            ‚îÇ
        ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
        ‚îÇ WO:      [SECTION-14] ‚Üí renderVisualizer() & drawCelestial()       ‚îÇ
        ‚îÇ √ÑNDERN:                                                              ‚îÇ
        ‚îÇ   - Planetengr√∂√üe: Suche "size * visualizerScale"                  ‚îÇ
        ‚îÇ   - Orbit-Ringe: Suche ".orbit-indicator"                           ‚îÇ
        ‚îÇ   - Zoom-Stufe: √Ñndere "visualizerScale = 0.3" am Anfang          ‚îÇ
        ‚îÇ   - Stern-Gr√∂√üe: Suche "const starSize = 30"                       ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ 8Ô∏è‚É£  DEBUGGING-TIPPS                                                  ‚îÇ
        ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
        ‚îÇ ‚Ä¢ Browser-Konsole √∂ffnen: F12 ‚Üí Console Tab                        ‚îÇ
        ‚îÇ ‚Ä¢ Fehler bei Button-Klick: Pr√ºfe ob Funktion in window.* ist      ‚îÇ
        ‚îÇ ‚Ä¢ Daten nicht gespeichert: Pr√ºfe updateOutput() Aufrufe           ‚îÇ
        ‚îÇ ‚Ä¢ UI aktualisiert nicht: Pr√ºfe update...() Funktionsaufrufe       ‚îÇ
        ‚îÇ ‚Ä¢ Export falsch: console.log(solarSystem) vor Export ausf√ºhren    ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ 9Ô∏è‚É£  SUCHTIPPS F√úR STRG+F                                             ‚îÇ
        ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
        ‚îÇ ‚Ä¢ [SECTION-XX]    ‚Üí Springe zu Hauptbereichen                      ‚îÇ
        ‚îÇ ‚Ä¢ function add    ‚Üí Finde alle add..() Funktionen                  ‚îÇ
        ‚îÇ ‚Ä¢ function update ‚Üí Finde alle update..() Funktionen               ‚îÇ
        ‚îÇ ‚Ä¢ addEventListener ‚Üí Finde alle Event-Registrierungen              ‚îÇ
        ‚îÇ ‚Ä¢ window.         ‚Üí Finde alle globalen Funktionen                 ‚îÇ
        ‚îÇ ‚Ä¢ txt +=          ‚Üí Finde Code-Generierung                         ‚îÇ
        ‚îÇ ‚Ä¢ getElementById  ‚Üí Finde HTML-Element-Verkn√ºpfungen              ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        
        ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
        ‚ïë  Bei Fragen: Suche nach dem relevanten [SECTION-XX] Marker oder    ‚ïë
        ‚ïë  durchsuche die Kommentare mit "HIER:", "√ÑNDERN:", "WICHTIG:"      ‚ïë
        ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
        */
    </script>
</body>
</html>
